import{a1 as Z,r as v,j as C,d as J,M as q,o as Q,v as r,x as c,A as N,y as s,C as V,z as d,S as o,I as S,T as X,a3 as Y,$ as B,N as M,V as x,_ as ee,L as F,K as te,H as m}from"./HfdH-K36.js";import{S as se,_ as ae}from"./CnXDUYsJ.js";import{u as oe}from"./BUsOIeYI.js";import{_ as le}from"./DlAUqK2U.js";import"./CMF1m4mw.js";const ne="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='24'%20height='24'%20viewBox='0%200%2024%2024'%20fill='none'%3e%3cpath%20d='M21%2021L16.7%2016.7M19%2011C19%2015.4183%2015.4183%2019%2011%2019C6.58172%2019%203%2015.4183%203%2011C3%206.58172%206.58172%203%2011%203C15.4183%203%2019%206.58172%2019%2011Z'%20stroke='%231BA39B'%20stroke-width='2'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e",A="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='24'%20height='24'%20viewBox='0%200%2024%2024'%20fill='none'%3e%3cpath%20d='M22%203H2L10%2012.46V19L14%2021V12.46L22%203Z'%20stroke='%231BA39B'%20stroke-width='2'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e",R="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='24'%20height='24'%20viewBox='0%200%2024%2024'%20fill='none'%3e%3cpath%20d='M6%209L12%2015L18%209'%20stroke='%231BA39B'%20stroke-width='2'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e",ie="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='24'%20height='24'%20viewBox='0%200%2024%2024'%20fill='none'%3e%3cpath%20d='M10.9134%2013.0853C10.7223%2012.8945%2010.4945%2012.7444%2010.2438%2012.6441L2.31381%209.46406C2.21912%209.42606%202.13833%209.36002%202.08226%209.27478C2.0262%209.18955%201.99755%209.0892%202.00016%208.98722C2.00278%208.88523%202.03652%208.78648%202.09688%208.70423C2.15723%208.62197%202.2413%208.56015%202.33781%208.52706L21.3378%202.02706C21.4264%201.99505%2021.5223%201.98894%2021.6143%202.00945C21.7062%202.02995%2021.7904%202.07622%2021.857%202.14283C21.9236%202.20945%2021.9699%202.29366%2021.9904%202.38561C22.0109%202.47756%2022.0048%202.57345%2021.9728%202.66206L15.4728%2021.6621C15.4397%2021.7586%2015.3779%2021.8426%2015.2956%2021.903C15.2134%2021.9633%2015.1146%2021.9971%2015.0126%2021.9997C14.9107%2022.0023%2014.8103%2021.9737%2014.7251%2021.9176C14.6398%2021.8615%2014.5738%2021.7807%2014.5358%2021.6861L11.3558%2013.7541C11.255%2013.5036%2011.1045%2013.2761%2010.9134%2013.0853ZM10.9134%2013.0853L21.8538%202.14706'%20stroke='%23F5F7FA'%20stroke-width='2'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e",de=Z("memberList",()=>{const _=v([]),f=v(""),a=v(!1),b=v(""),u=v(null),p=v(""),g=v(""),i=v(1),t=10,e=C(()=>_.value.filter(l=>{const k=b.value.trim(),T=!k||[l.name,l.phone,l.birthday].some(h=>h.includes(k)),y=!p.value||l.product===p.value,P=!g.value||l.memType===g.value;let n=!0;if(Array.isArray(u.value)&&u.value[0]&&u.value[1]){const[h,I]=u.value,w=new Date(l.registerDate.replace(/-/g,"/"));n=w>=h&&w<=I}return T&&y&&P&&n})),D=C(()=>e.value.length),L=C(()=>Math.ceil(D.value/t)),H=C(()=>{const l=(i.value-1)*t;return e.value.slice(l,l+t)});async function O(){if(!a.value)try{const l=localStorage.getItem("backendToken")||sessionStorage.getItem("backendToken"),k=localStorage.getItem("adminID")||sessionStorage.getItem("adminID");if(!l||!k)throw new Error("缺少 token 或 adminID");const T={AdminID:k,Token:l,Keyword:b.value,StartDate:"",EndDate:"",ProductName:p.value,memType:g.value},y=await fetch("https://23700999.com:8081/HMA/API_Home.jsp",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(T)});if(!y.ok)throw new Error(y.statusText);const{MemberList:P}=await y.json();_.value=P.map(n=>{var w;const h=((w=n.HomeOrder)==null?void 0:w[0])??{},I=n.TDate.includes("/")?n.TDate:`${n.TDate.slice(0,4)}/${n.TDate.slice(4,6)}/${n.TDate.slice(6,8)}`;return{id:n.MID,name:n.Name,birthday:n.Birthday,phone:n.Mobile,level:n.GradeName,product:h.ProductName??"",usageDays:Number(h.Used??0),remainingDays:Number(h.Still??0),hrv:n.HRV,ans:n.DSPR,isAbnormal:Number(n.HRV)<40,registerDate:I,memType:n.memType,score:n.Score?Number(n.Score):null,totalScore:n.TotalScore?Number(n.TotalScore):null}}),f.value=new Date().toLocaleString("zh-TW"),a.value=!0}catch(l){console.error("讀取 MemberList 失敗：",l)}}function j(){_.value=[],f.value="",a.value=!1,i.value=1}function U(l){b.value=l,i.value=1}function W(l){u.value=l,i.value=1}function $(l){p.value=l,i.value=1}function z(l){g.value=l,i.value=1}function E(l){i.value=l}function K(){i.value>1&&i.value--}function G(){i.value<L.value&&i.value++}return{members:_,lastUpdated:f,hasFetched:a,keyword:b,dateRange:u,productFilter:p,statusFilter:g,page:i,pageSize:t,filteredMembers:e,total:D,totalPages:L,paginatedMembers:H,fetchMembers:O,clear:j,setKeyword:U,setDateRange:W,setProductFilter:$,setStatusFilter:z,gotoPage:E,prevPage:K,nextPage:G}}),re={class:"dashboard"},ce={class:"content"},ue={class:"page-header"},ve={class:"title"},pe={class:"count"},ge={class:"meta"},he={class:"updated-time"},me={class:"toolbar"},be={class:"toolbar-inner"},_e={class:"search-wrapper"},fe={class:"toolbarTime-wrapper"},ke={class:"selectWrapper"},ye=["value"],we={class:"selectWrapper"},De=["value"],Ce={class:"member-table"},Se={class:"table-list"},Me={class:"cell name","data-label":"會員名稱"},xe={class:"cell level","data-label":"等級"},Te={class:"cell birth","data-label":"生日"},Pe={class:"cell phone","data-label":"電話"},Ie={class:"sub"},Ve={class:"cellProduct"},Le={key:0,class:"chip chip--success"},Ne={key:1,class:"chip chip--danger"},Be={class:"cell health","data-label":"健康指數"},Fe={key:0},Ae={key:1},Re={key:2},He={class:"chipWrap"},Oe={key:0,class:"chip chip--warning"},je={class:"cell reg-date","data-label":"註冊時間"},Ue={class:"cell action"},We={class:"tagsGroup"},$e={key:0,class:"cellTag cellTagSuccess"},ze=["onClick"],Ee={class:"pagination"},Ke=["disabled"],Ge=["disabled"],Ze=["onClick"],Je=["disabled"],qe=["disabled"],Qe=J({__name:"index",setup(_){oe({title:"",description:"NeuroPlus神經調節家提供專業的自律神經檢測服務，運用FDA認證AI技術，透過人臉辨識快速分析HRV數據，幫助您了解自律神經狀態。",url:"https://neuroplus.com.tw"});const f=q(),a=de(),b=[{label:"雙效紅光活力衣",value:"雙效紅光活力衣"},{label:"三效深眠衣",value:"三效深眠衣"},{label:"全效調節衣",value:"全效調節衣"},{label:"居家治療儀",value:"居家治療儀"}],u=["忠誠用戶","當前活躍","經常使用","正常使用","偶爾使用","待關注","解約","高風險","未歸還","退費","奧客"].map(i=>({label:i,value:i}));Q(()=>{a.fetchMembers()});function p(i){localStorage.setItem("selectedMember",JSON.stringify({MID:i.id,Mobile:i.phone})),f.push("/raphaelBackend/member/memberContent")}function g(){a.clear(),a.fetchMembers()}return(i,t)=>(c(),r("div",re,[N(se),s("main",ce,[s("header",ue,[s("h2",ve,[t[11]||(t[11]=V(" 會員清單 ")),s("span",pe,"("+d(o(a).total)+"人)",1)]),s("div",ge,[s("button",{class:"btn refresh",onClick:g},t[12]||(t[12]=[s("i",{class:"i-refresh"},null,-1),V(" 資料更新 ")])),s("span",he,"最後更新: "+d(o(a).lastUpdated),1)])]),s("section",me,[s("div",be,[s("div",_e,[S(s("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>o(a).keyword=e),class:"search",type:"text",placeholder:"請輸入關鍵字",onInput:t[1]||(t[1]=e=>o(a).setKeyword(e.target.value))},null,544),[[X,o(a).keyword]]),t[13]||(t[13]=s("img",{src:ne,alt:""},null,-1))]),s("div",fe,[N(o(Y),{modelValue:o(a).dateRange,"onUpdate:modelValue":[t[2]||(t[2]=e=>o(a).dateRange=e),o(a).setDateRange],range:"","enable-time-picker":!1,format:"yyyy/MM/dd","min-date":new Date(2024,0,1),placeholder:"註冊日期區間","prepend-icon":"i-calendar"},null,8,["modelValue","min-date","onUpdate:modelValue"])]),s("div",ke,[t[15]||(t[15]=s("img",{class:"selectWrapperIcon1",src:A,alt:""},null,-1)),S(s("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>o(a).productFilter=e),onChange:t[4]||(t[4]=e=>o(a).setProductFilter(e.target.value))},[t[14]||(t[14]=s("option",{value:""},"全部產品",-1)),(c(),r(M,null,x(b,e=>s("option",{key:e.value,value:e.value},d(e.label),9,ye)),64))],544),[[B,o(a).productFilter]]),t[16]||(t[16]=s("img",{class:"selectWrapperIcon2",src:R,alt:""},null,-1))]),s("div",we,[t[18]||(t[18]=s("img",{class:"selectWrapperIcon1",src:A,alt:""},null,-1)),S(s("select",{"onUpdate:modelValue":t[5]||(t[5]=e=>o(a).statusFilter=e),onChange:t[6]||(t[6]=e=>o(a).setStatusFilter(e.target.value))},[t[17]||(t[17]=s("option",{value:""},"全部狀態",-1)),(c(!0),r(M,null,x(o(u),e=>(c(),r("option",{key:e.value,value:e.value},d(e.label),9,De))),128))],544),[[B,o(a).statusFilter]]),t[19]||(t[19]=s("img",{class:"selectWrapperIcon2",src:R,alt:""},null,-1))])])]),s("section",Ce,[t[22]||(t[22]=ee('<div class="table-row table-header" data-v-6fdeb926><div class="name" data-v-6fdeb926>會員名稱</div><div class="level" data-v-6fdeb926>等級</div><div class="birth" data-v-6fdeb926>生日</div><div class="phone" data-v-6fdeb926>電話</div><div class="product" data-v-6fdeb926>產品資訊</div><div class="health" data-v-6fdeb926>健康指標</div><div class="reg-date" data-v-6fdeb926>註冊時間</div></div>',1)),s("div",Se,[(c(!0),r(M,null,x(o(a).paginatedMembers,e=>(c(),r("div",{key:e.id,class:"table-row"},[s("div",Me,d(e.name),1),s("div",xe,d(e.level),1),s("div",Te,d(e.birthday),1),s("div",Pe,d(e.phone),1),s("div",{class:F(["cell product",{"no-data":!(e.usageDays||e.remainingDays)}]),"data-label":"產品資訊"},[s("p",Ie,d(e.product),1),S(s("div",Ve,[e.usageDays?(c(),r("p",Le," 已使用 "+d(e.usageDays)+" 天 ",1)):m("",!0),e.remainingDays?(c(),r("p",Ne," 剩餘 "+d(e.remainingDays)+" 天 ",1)):m("",!0)],512),[[te,e.usageDays||e.remainingDays]])],2),s("div",Be,[e.hrv?(c(),r("p",Fe,"HRV "+d(e.hrv)+" ms",1)):m("",!0),e.totalScore!==null?(c(),r("p",Ae," 自律神經 "+d(e.totalScore)+" 分 ",1)):m("",!0),e.score!==null?(c(),r("p",Re,"生活自律 "+d(e.score)+" 分",1)):m("",!0),s("div",He,[e.isAbnormal?(c(),r("p",Oe," 已超時,請盡快提醒 ")):m("",!0),t[20]||(t[20]=s("button",{class:"healthBtn"},[s("img",{src:ie,alt:""}),V(" 立即推播 ")],-1))])]),s("div",je,[s("p",null,d(e.registerDate),1)]),s("div",Ue,[s("div",We,[e.memType&&e.product?(c(),r("div",$e,d(e.memType),1)):m("",!0)])]),s("div",{class:"goInfo",onClick:D=>p(e),role:"button",tabindex:"0"},t[21]||(t[21]=[s("img",{src:ae,alt:"詳細"},null,-1)]),8,ze)]))),128))]),s("nav",Ee,[s("button",{class:"btn-page",disabled:o(a).page===1,onClick:t[7]||(t[7]=e=>o(a).gotoPage(1))}," << ",8,Ke),s("button",{class:"btn-page",disabled:o(a).page===1,onClick:t[8]||(t[8]=(...e)=>o(a).prevPage&&o(a).prevPage(...e))}," < ",8,Ge),(c(!0),r(M,null,x(o(a).totalPages,e=>(c(),r("button",{key:e,class:F(["btn-page btn-page-number",{active:o(a).page===e}]),onClick:D=>o(a).gotoPage(e)},d(e),11,Ze))),128)),s("button",{class:"btn-page",disabled:o(a).page===o(a).totalPages,onClick:t[9]||(t[9]=(...e)=>o(a).nextPage&&o(a).nextPage(...e))}," > ",8,Je),s("button",{class:"btn-page",disabled:o(a).page===o(a).totalPages,onClick:t[10]||(t[10]=e=>o(a).gotoPage(o(a).totalPages))}," >> ",8,qe)])])])]))}}),at=le(Qe,[["__scopeId","data-v-6fdeb926"]]);export{at as default};
