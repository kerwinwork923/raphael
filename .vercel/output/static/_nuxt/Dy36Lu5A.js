import{_ as it}from"./-OuEz4cf.js";import{_ as ct}from"./C4EKiFTB.js";import{a as x}from"./CCb-kr4I.js";import{J as bt,r as c,i as nt,F as wt,g as Ft,M as Vt,v as n,K as y,z,x as e,O as V,B as R,L as k,U as T,Q as Gt,R as Et,y as i,W as Yt,t as a,N as rt}from"./D70xjexz.js";import{_ as Ot}from"./B0rTVoH9.js";import{_ as G}from"./CR27s-ts.js";import{_ as It,a as Ut,b as Wt,c as zt,d as Jt}from"./D0XVPD9N.js";import{_ as Kt}from"./DlAUqK2U.js";function qt(g){const t=[];if(!g||!Array.isArray(g))return t;for(const v of g)if(v.ProductNameTT&&Array.isArray(v.ProductNameTT))for(const o of v.ProductNameTT)t.push({Dates:o.HolidayDate||[],HolidayDays:o.Period||"",HolidayNote:o.HolidayNote||""});else t.push({Dates:v.HolidayDate||[],HolidayDays:v.Period||"",HolidayNote:v.HolidayNote||""});return t}function Qt(g){const t=[];if(!g||!Array.isArray(g))return t;for(const v of g)if(v.ProductNameTT&&Array.isArray(v.ProductNameTT))for(const o of v.ProductNameTT)t.push({ProductName:v.ProductName||"",TT:v.TT||"",HDays:o.HolidayDate||[],HolidayDays:o.Period||"",HolidayNote:o.HolidayNote||""});else t.push({ProductName:v.ProductName||"",TT:v.TT||"",HDays:v.HolidayDate||[],HolidayDays:v.Period||"",HolidayNote:v.HolidayNote||""});return t}const Xt={components:{RaphaelLoading:it,TitleMenu:ct},setup(){const g=bt(),t=c(!1),v=localStorage.getItem("userData"),{MID:o,Token:h,MAID:P,Mobile:D}=v?JSON.parse(v):{};if(!o||!h||!P||!D){localStorage.removeItem("userData"),g.push("/");return}const B=c("contractList"),S=c([]),l=c(!1),u=c(!1),p=c(null),A=c(null),dt=["雙效紅光活力衣","三效深眠衣","全效調節衣","居家治療儀"],ut=["進行中","已到期"];function vt(){l.value=!l.value,u.value=!1}function yt(){u.value=!u.value,l.value=!1}function ft(s){p.value=s,l.value=!1}function pt(s){A.value=s,u.value=!1}async function gt(){try{t.value=!0;const s=await x.post("https://23700999.com:8081/HMA/API_Contract.jsp",{MID:o,Token:h,MAID:P,Mobile:D});s.status===200&&(S.value=s.data.ContractList||[])}catch(s){console.error(s)}finally{t.value=!1}}gt();const mt=nt(()=>S.value.filter(s=>{const r=!p.value||s.ProductName===p.value;let d=!0;return A.value==="進行中"?d=s.Still>0:A.value==="已到期"&&(d=s.Still<=0),r&&d})),J=c(!1),K=c([]);async function Ht(s){try{t.value=!0;const r=await x.post("https://23700999.com:8081/HMA/api/fr/HolidayRec",{MID:o,Token:h,MAID:P,Mobile:D,HID:s.HID,TT:s.TT,ProductName:s.ProductName});r.data.Result==="OK"?(K.value=qt(r.data.RetHoliday),J.value=!0):alert("後端回傳錯誤："+JSON.stringify(r.data.Result))}catch(r){console.error(r),alert("取得請假紀錄失敗")}finally{t.value=!1}}const E=c([]);wt(()=>B.value,s=>{s==="leaveHistoryRecord"&&q()});async function q(){try{t.value=!0;const s=await x.post("https://23700999.com:8081/HMA/api/fr/ALLHolidayRec",{MID:o,Token:h,MAID:P,Mobile:D});s.data.Result==="OK"?E.value=Qt(s.data.RetHoliday):alert("後端回傳錯誤："+JSON.stringify(s.data.Result))}catch(s){console.error(s),alert("取得歷史紀錄失敗")}finally{t.value=!1}}const Q=c(!1),b=c("");function kt(s){b.value=s||"",Q.value=!1}const Y=c(!1),N=c(null),X=c(""),Z=c(""),j=c(""),$=c(null),C=c([]),L=c(""),O=new Date,Tt=new Date(O.getFullYear(),O.getMonth()+2,0),tt=c(null);function Dt(){w.value=!0,Yt(()=>{var r,d;const s=(d=(r=tt.value)==null?void 0:r.$el)==null?void 0:d.querySelector("input");s&&s.click()})}const w=c(!1),I=c([]);function Rt(){w.value=!w.value}const ht=nt(()=>{let s=E.value;if(b.value&&(s=s.filter(r=>r.ProductName===b.value)),I.value.length===2){const[r,d]=I.value;s=s.filter(m=>m.HDays.some(f=>{const H=+f.slice(0,4),_=+f.slice(4,6)-1,U=+f.slice(6,8),M=new Date(H,_,U);return M>=r&&M<=d}))}return s});function Pt(s){if(!s)return"";if(typeof s=="string"&&/^\d{8}$/.test(s)){const f=+s.slice(0,4),H=+s.slice(4,6)-1,_=+s.slice(6,8);s=new Date(f,H,_)}if(Object.prototype.toString.call(s)!=="[object Date]"||isNaN(s))return"";const r=s.getFullYear(),d=String(s.getMonth()+1).padStart(2,"0"),m=String(s.getDate()).padStart(2,"0");return`${r}/${d}/${m}`}function At(){var r,d;const s=(d=(r=$.value)==null?void 0:r.$el)==null?void 0:d.querySelector("input");s&&s.click()}function Ct(s){s.length>10?(C.value=s.slice(0,10),alert("已超過可請假天數")):C.value=s}const et=c(!1),ot=c([]);async function _t(s){try{t.value=!0;const r=new Date,d=r.getFullYear(),m=String(r.getMonth()+1).padStart(2,"0"),f=`${d}${m}`,H=new Date(r.getFullYear(),r.getMonth()+1,1),_=H.getFullYear(),U=String(H.getMonth()+1).padStart(2,"0"),M=`${_}${U}`,[xt,Lt]=await Promise.all([x.post("https://23700999.com:8081/HMA/api/fr/CanHolidayInfo",{MID:o,Token:h,MAID:P,Mobile:D,HID:s.HID,TT:s.TT,ProductName:s.ProductName,YrMn:f}),x.post("https://23700999.com:8081/HMA/api/fr/CanHolidayInfo",{MID:o,Token:h,MAID:P,Mobile:D,HID:s.HID,TT:s.TT,ProductName:s.ProductName,YrMn:M})]),F=xt.data,W=Lt.data;if(F.Result!=="OK"&&W.Result!=="OK"){alert("後端回傳錯誤："+JSON.stringify(F));return}const Mt=Number((F.YrMn||f).slice(4)),Bt=Number((W.YrMn||M).slice(4)),st=Number(F.CanHolidays)||0,at=Number(W.CanHolidays)||0;if(ot.value=[{monthLabel:`${Mt}月`,canDays:st},{monthLabel:`${Bt}月`,canDays:at}],st<1&&at<1){et.value=!0;return}N.value=s,X.value=s.RentStart||"",Z.value=s.RentEnd||"",j.value=s.RentFinish||"",Y.value=!0,C.value=[],L.value=""}catch(r){console.error(r),alert("取得可請假資訊失敗，請稍後再試")}finally{t.value=!1}}function lt(){Y.value=!1,C.value=[],L.value=""}async function St(){if(!N.value){alert("尚未指定要請假的合約");return}if(C.value.length===0){alert("尚未選擇請假日期！");return}if(!L.value.trim()){alert("請填寫請假原因！");return}const s={};for(const d of C.value){const m=d.getFullYear(),f=String(d.getMonth()+1).padStart(2,"0"),H=`${m}${f}`;s[H]||(s[H]=[]);const _=String(d.getDate()).padStart(2,"0");s[H].push(`${m}${f}${_}`)}const r=Object.keys(s);if(r.length===0){alert("日期格式錯誤");return}try{t.value=!0;for(const d of r){const m=s[d],f=await x.post("https://23700999.com:8081/HMA/api/fr/AddContratctHoliday",{MID:o,Token:h,MAID:P,Mobile:D,HID:N.value.HID,TT:N.value.TT,ProductName:N.value.ProductName,Holiday:m,HolidayNote:L.value});if(f.data.Result!=="OK"){alert("後端回傳錯誤："+JSON.stringify(f.data.Result));return}}alert("已送出請假申請！")}catch(d){console.error(d),alert("請假申請失敗")}finally{t.value=!1,lt()}}function Nt(s){return s?s.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","):"0"}return{loading:t,activeTab:B,contractList:S,productBoxVisible:l,stateBoxVisible:u,selectedProduct:p,selectedState:A,productOptions:dt,stateOptions:ut,toggleProductBox:vt,toggleStateBox:yt,selectContractProduct:ft,selectContractState:pt,filteredContracts:mt,leaveRecordAlertShow:J,singleHolidayRecord:K,getSingleHolidayRecord:Ht,allHolidayRecords:E,getAllHolidayRecords:q,leaveProductBoxVisible:Q,selectedHistoryProduct:b,selectHistoryProduct:kt,leaveApplicationAlertShow:Y,selectedContract:N,contractStart:X,contractEnd:Z,contractExpire:j,myHiddenPicker:$,selectedDates:C,leaveReason:L,today:O,endOfNextMonth:Tt,openMyDatePicker:At,handleDateChange:Ct,openLeaveApplicationAlert:_t,closeLeaveApplicationAlert:lt,submitLeaveApplication:St,canHolidayMonthList:ot,overLimitAlertShow:et,showHistoryDateRangePicker:w,historyDateRange:I,toggleHistoryDateFilter:Rt,filteredHistoryRecords:ht,historyRangePicker:tt,openHistoryRangePicker:Dt,formatDate:Pt,toThousands:Nt}}},Zt={key:1,class:"contractWrap"},jt={key:0,class:"contractCover"},$t={class:"typeChangeTag"},te={key:1,class:"leaveLimitAlert"},ee={class:"leaveLimitAlertBtnGroup"},oe={key:2,class:"leaveRecordAlert"},le={class:"leaveListWrap"},se={class:"leaveListTag"},ae={class:"leaveList1"},ne={class:"leaveList1Content"},re={class:"leaveList2"},ie={class:"leaveList1Content"},ce={class:"leaveList3"},de={class:"leaveList1Content"},ue={key:0,class:"notDetectData"},ve={class:"leaveRecordAlertOptionGroup"},ye={key:3,class:"leaveApplicationAlert"},fe={class:"leaveDateGroup"},pe={key:0,class:"limitError"},ge={class:"contractStartToEnd"},me={class:"leaveApplicationAlertBtnGroup"},He={key:4,class:"contractListWrap"},ke={class:"contractTopMenu"},Te={class:"contractTopMenuItem",style:{"border-radius":"12px 0 0 12px"}},De={key:0,class:"productBox"},Re=["onClick"],he={class:"contractTopMenuItem",style:{"border-radius":"0 12px 12px 0"}},Pe={key:0,class:"stateBox"},Ae=["onClick"],Ce={class:"contractContentGroup"},_e={class:"contractContentTitleGroup"},Se={class:"contractContentTitleTag"},Ne={class:"contractPrice"},xe={class:"linkGroup"},Le=["href"],Me={class:"contractDayGroup"},Be={class:"startTimeGroup"},be={class:"endTimeGroup"},we={key:0,class:"rentFinishGroup"},Fe={class:"progressGroup"},Ve={class:"contractProgress"},Ge={class:"contractProgressTextGroup"},Ee={class:"contractProgressBarGroup"},Ye={key:0,src:zt,alt:"contract time"},Oe={key:1,src:Jt,alt:"contract warning"},Ie={class:"leaveGroup"},Ue=["onClick"],We=["onClick"],ze={key:5,class:"leaveHistoryRecordWrap"},Je={class:"leaveHistoryRecordFilterGroup"},Ke={class:"leaveHistoryRecordFilter"},qe={key:0,class:"leaveHistoryRecordTopProduct"},Qe=["onClick"],Xe={key:0,class:"historyDateRangePicker"},Ze={class:"leaveHistoryRecordSubTitle"},je={class:"leaveHistoryRecordContentGroup"},$e={class:"leaveHistoryRecordRow"},to={class:"leaveHistoryRecordRow"},eo={class:"leaveHistoryRecordRow"};function oo(g,t,v,o,h,P){const D=it,B=ct,S=Ft("VueDatePicker");return o.loading?(a(),Vt(D,{key:0})):(a(),n("div",Zt,[o.leaveApplicationAlertShow||o.leaveRecordAlertShow||o.overLimitAlertShow?(a(),n("div",jt)):y("",!0),z(B,{Text:"合約|請假",link:"/user"}),e("div",$t,[e("h2",{class:V({typeChangeTagActive:o.activeTab==="contractList"}),onClick:t[0]||(t[0]=l=>o.activeTab="contractList")}," 合約列表 ",2),e("h2",{class:V({typeChangeTagActive:o.activeTab==="leaveHistoryRecord"}),onClick:t[1]||(t[1]=l=>o.activeTab="leaveHistoryRecord")}," 請假歷史紀錄 ",2)]),o.overLimitAlertShow?(a(),n("div",te,[t[18]||(t[18]=e("p",null,[R(" 您已超過請假天數"),e("br"),R(" 請立即聯絡諮詢師0800 000 760 ")],-1)),e("div",ee,[e("div",{class:"leaveLimitAlertCloseBtn",onClick:t[2]||(t[2]=l=>o.overLimitAlertShow=!1)}," 關閉 "),t[17]||(t[17]=e("a",{class:"leaveLimitAlertContactBtn",href:"tel:0800000760"},"立即聯絡",-1))])])):y("",!0),o.leaveRecordAlertShow?(a(),n("div",oe,[t[23]||(t[23]=e("h3",null,"請假紀錄",-1)),e("div",le,[(a(!0),n(k,null,T(o.singleHolidayRecord,(l,u)=>(a(),n("div",{class:"leaveListGroup",key:u},[e("div",se,"#"+i(u+1),1),e("div",ae,[t[19]||(t[19]=e("h6",null,"請假日期",-1)),e("div",ne,[(a(!0),n(k,null,T(l.Dates,(p,A)=>(a(),n("div",{key:A},i(p),1))),128))])]),e("div",re,[t[20]||(t[20]=e("h6",null,"請假天數",-1)),e("div",ie,i(l.HolidayDays),1)]),e("div",ce,[t[21]||(t[21]=e("h6",null,"請假原因",-1)),e("div",de,i(l.HolidayNote),1)]),t[22]||(t[22]=e("hr",null,null,-1))]))),128)),o.singleHolidayRecord.length===0?(a(),n("div",ue," 無請假資料 ")):y("",!0)]),e("div",ve,[e("div",{class:"optionCloseBtn",onClick:t[3]||(t[3]=l=>o.leaveRecordAlertShow=!1)}," 關閉 ")])])):y("",!0),o.leaveApplicationAlertShow?(a(),n("div",ye,[t[27]||(t[27]=e("h3",null,"請假申請",-1)),t[28]||(t[28]=e("div",{class:"leaveApplicationAlertHR"},null,-1)),t[29]||(t[29]=e("h4",null,"請假日期",-1)),z(S,{ref:"myHiddenPicker",modelValue:o.selectedDates,"onUpdate:modelValue":[t[4]||(t[4]=l=>o.selectedDates=l),o.handleDateChange],"min-date":o.today,"max-date":o.endOfNextMonth,"multi-dates":"",teleport:"body","cancel-text":"取消","select-text":"確定",locale:"zh-TW","no-today":"","enable-time-picker":!1,class:"invisibleDatePicker"},null,8,["modelValue","min-date","max-date","onUpdate:modelValue"]),e("div",{class:"leaveDates",onClick:t[5]||(t[5]=(...l)=>o.openMyDatePicker&&o.openMyDatePicker(...l))},[t[24]||(t[24]=e("img",{src:Ot,alt:""},null,-1)),e("div",fe,[(a(!0),n(k,null,T(o.selectedDates,(l,u)=>(a(),n("div",{class:"leaveDate",key:u},i(o.formatDate(l)),1))),128))])]),t[30]||(t[30]=e("hr",null,null,-1)),o.selectedDates.length>10?(a(),n("div",pe," 超過請假天數 ")):y("",!0),t[31]||(t[31]=e("h4",null,"請假原因",-1)),Gt(e("textarea",{"onUpdate:modelValue":t[6]||(t[6]=l=>o.leaveReason=l),class:"noResizeTextarea",placeholder:"請簡短說明..."},null,512),[[Et,o.leaveReason]]),e("p",null,[t[25]||(t[25]=R(" 合約起迄日：")),e("span",ge,i(o.contractStart)+" ~ "+i(o.contractEnd),1)]),e("p",null,"合約到期日："+i(o.contractExpire),1),e("p",null,"請假申請天數："+i(o.selectedDates.length)+" 天",1),e("p",null,[t[26]||(t[26]=R(" 剩餘請假天數 : ")),(a(!0),n(k,null,T(o.canHolidayMonthList,(l,u)=>(a(),n("span",{key:u,class:"monthRemainItem"},i(l.canDays)+"天("+i(l.monthLabel)+") ",1))),128))]),e("div",me,[e("div",{class:"leaveApplicationAlertBackBtn",onClick:t[7]||(t[7]=(...l)=>o.closeLeaveApplicationAlert&&o.closeLeaveApplicationAlert(...l))}," 返回 "),e("div",{class:"leaveApplicationAlertSumbitBtn",onClick:t[8]||(t[8]=(...l)=>o.submitLeaveApplication&&o.submitLeaveApplication(...l))}," 送出 ")])])):y("",!0),o.activeTab==="contractList"?(a(),n("div",He,[e("div",ke,[e("div",Te,[e("div",{class:"contractTopMenuTextBox",onClick:t[9]||(t[9]=(...l)=>o.toggleProductBox&&o.toggleProductBox(...l))},[t[32]||(t[32]=e("img",{src:G,alt:""},null,-1)),e("h4",null,i(o.selectedProduct?o.selectedProduct:"所有產品"),1)]),o.productBoxVisible?(a(),n("div",De,[e("div",{class:"contractTopProduct",onClick:t[10]||(t[10]=l=>o.selectContractProduct(null))}," 所有產品 "),(a(!0),n(k,null,T(o.productOptions,(l,u)=>(a(),n("div",{class:"contractTopProduct",key:u,onClick:p=>o.selectContractProduct(l)},i(l),9,Re))),128))])):y("",!0)]),e("div",he,[e("div",{class:"contractTopMenuTextBox",onClick:t[11]||(t[11]=(...l)=>o.toggleStateBox&&o.toggleStateBox(...l))},[t[33]||(t[33]=e("img",{src:G,alt:""},null,-1)),e("h4",null,i(o.selectedState?o.selectedState:"所有狀態"),1)]),o.stateBoxVisible?(a(),n("div",Pe,[e("div",{class:"contractTopState",onClick:t[12]||(t[12]=l=>o.selectContractState(null))}," 所有狀態 "),(a(!0),n(k,null,T(o.stateOptions,(l,u)=>(a(),n("div",{class:"contractTopState",key:u,onClick:p=>o.selectContractState(l)},i(l),9,Ae))),128))])):y("",!0)])]),e("div",Ce,[(a(!0),n(k,null,T(o.filteredContracts,(l,u)=>(a(),n("div",{class:"contractContent",key:u},[e("div",_e,[e("h3",null,i(l.ProductName),1),e("div",Se,[t[34]||(t[34]=e("img",{src:It,alt:""},null,-1)),e("div",Ne,i(o.toThousands(l.TotalFee)),1)])]),e("div",xe,[l.PdfFileName?(a(),n("a",{key:0,href:l.PdfFileName,target:"_blank",rel:"noopener noreferrer"},t[35]||(t[35]=[R(" 查看合約 "),e("span",null,null,-1)]),8,Le)):y("",!0)]),e("main",{class:V({contractEndMain:l.Still<=0})},[e("div",Me,[e("div",Be,[t[36]||(t[36]=e("h6",null,"合約開始",-1)),e("h5",null,i(l.RentStart),1)]),e("div",be,[t[37]||(t[37]=e("h6",null,"合約結束",-1)),e("h5",null,i(l.RentEnd),1)]),l.RentFinish?(a(),n("div",we,[t[38]||(t[38]=e("h6",null,"合約到期",-1)),e("h5",null,i(l.RentFinish),1)])):y("",!0)]),e("div",Fe,[e("div",Ve,[e("div",Ge,[l.Still>0&&l.UsedRatio>0&&l.UsedRatio<100?(a(),n("div",{key:0,class:"todayIcon",style:rt({left:l.UsedRatio+"%"})}," 今天 ",4)):y("",!0)]),e("div",Ee,[e("div",{class:"contractProgressBar",style:rt({width:l.UsedRatio+"%",backgroundColor:l.Still>0?"#1FBCB3":"#EC4F4F"})},null,4)])])]),e("div",{class:V(["contractDayWarn",{contractDayWarn2:l.Still<=0}])},[l.Still>0?(a(),n("img",Ye)):(a(),n("img",Oe)),e("h5",null,i(l.Info),1)],2)],2),e("div",Ie,[e("div",{class:"leaveRecordBtn",onClick:p=>o.getSingleHolidayRecord(l)},t[39]||(t[39]=[e("img",{src:Ut,alt:""},null,-1),R(" 請假紀錄 ")]),8,Ue),l.Still>0?(a(),n("div",{key:0,class:"leaveApplication",onClick:p=>o.openLeaveApplicationAlert(l)},t[40]||(t[40]=[e("img",{src:Wt,alt:""},null,-1),R(" 請假申請 ")]),8,We)):y("",!0)])]))),128))])])):y("",!0),o.activeTab==="leaveHistoryRecord"?(a(),n("div",ze,[e("div",Je,[e("div",Ke,[t[41]||(t[41]=e("img",{src:G,alt:""},null,-1)),e("h4",{onClick:t[13]||(t[13]=l=>o.leaveProductBoxVisible=!o.leaveProductBoxVisible)},i(o.selectedHistoryProduct||"所有產品"),1),o.leaveProductBoxVisible?(a(),n("div",qe,[e("div",{onClick:t[14]||(t[14]=l=>o.selectHistoryProduct(""))},"所有產品"),(a(!0),n(k,null,T(o.productOptions,(l,u)=>(a(),n("div",{key:u,onClick:p=>o.selectHistoryProduct(l)},i(l),9,Qe))),128))])):y("",!0)]),e("div",{class:"leaveHistoryRecordFilter",onClick:t[15]||(t[15]=(...l)=>o.openHistoryRangePicker&&o.openHistoryRangePicker(...l))},t[42]||(t[42]=[e("img",{src:G,alt:""},null,-1),e("h4",null,"查詢請假日期或區間",-1)]))]),o.showHistoryDateRangePicker?(a(),n("div",Xe,[z(S,{ref:"historyRangePicker",modelValue:o.historyDateRange,"onUpdate:modelValue":t[16]||(t[16]=l=>o.historyDateRange=l),range:!0,"no-today":"",locale:"zh-TW","enable-time-picker":!1,teleport:"body","close-on-auto-apply":!1,"close-on-scroll":!1,format:l=>o.formatDate(l),class:"invisibleDatePicker"},null,8,["modelValue","format"])])):y("",!0),e("div",Ze,[t[43]||(t[43]=R(" 總共 ")),e("span",null,i(o.filteredHistoryRecords.length),1),t[44]||(t[44]=R(" 筆紀錄 "))]),e("div",je,[(a(!0),n(k,null,T(o.filteredHistoryRecords,(l,u)=>(a(),n("div",{class:"leaveHistoryRecordContent",key:u},[e("h3",null,i(l.ProductName)+" 第"+i(l.TT)+"期",1),e("div",$e,[t[45]||(t[45]=e("h4",null,"請假日期",-1)),e("ul",null,[(a(!0),n(k,null,T(l.HDays,(p,A)=>(a(),n("li",{key:A},i(p),1))),128))])]),e("div",to,[t[46]||(t[46]=e("h4",null,"請假天數",-1)),e("p",null,i(l.HolidayDays),1)]),e("div",eo,[t[47]||(t[47]=e("h4",null,"請假原因",-1)),e("p",null,i(l.HolidayNote),1)])]))),128))])])):y("",!0)]))}const vo=Kt(Xt,[["render",oo]]);export{vo as default};
