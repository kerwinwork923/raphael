# 生產管理功能說明

## 功能概述

生產管理功能已成功串接 `/api/bk/MakeQry` API，提供完整的生產流程管理。

## API 規格

### 查詢生產資料 API (`/api/bk/MakeQry`)

#### 請求格式
```json
{
  "AdminID": "mushen",
  "Token": "kRwzQVDP8T4XQVcBBF8llJVMOirIxvf7",
  "Name": "搜尋關鍵字"
}
```

#### 回應格式
```json
{
  "RetMake": [
    {
      "SID": "訂單編號",
      "Name": "訂購姓名",
      "ProductID": "商品ID",
      "ProductName": "商品名稱",
      "PdtSize": "商品尺寸",
      "BodySize": "身材尺寸",
      "State": "狀態代碼",
      "StateName": "狀態名稱"
    }
  ],
  "Result": "OK"
}
```

### 開始製作 API (`/api/bk/MakeBegin`)

#### 請求格式
```json
{
  "AdminID": "mushen",
  "Token": "kRwzQVDP8T4XQVcBBF8llJVMOirIxvf7",
  "SALEID": "訂單編號",
  "ProductID": "商品ID"
}
```

#### 回應格式
```json
{
  "Result": "OK"
}
```

### 製作完成 API (`/api/bk/MakeComplete`)

#### 請求格式
```json
{
  "AdminID": "mushen",
  "Token": "kRwzQVDP8T4XQVcBBF8llJVMOirIxvf7",
  "SALEID": "訂單編號",
  "ProductID": "商品ID"
}
```

#### 回應格式
```json
{
  "Result": "OK"
}
```

### 商品篩選 API (`/api/bk/Home_CProduct`)

#### 請求格式
```json
{
  "AdminID": "mushen",
  "Token": "kRwzQVDP8T4XQVcBBF8llJVMOirIxvf7"
}
```

#### 回應格式
```json
{
  "RetMaProduct": [
    {
      "ProductID": "商品ID",
      "ProductName": "商品名稱",
      "Price": "價格",
      "Feature": "商品特色",
      "Label": "七天保障標籤"
    }
  ],
  "Result": "OK"
}
```

## 功能特色

### 1. 資料顯示
- 訂單編號（SID）
- 訂購姓名（Name）
- 商品名稱（ProductName）
- 商品尺寸（PdtSize）
- 身材比例（BodySize）
- 目前進度（State/StateName）

### 2. 搜尋功能
- 支援關鍵字搜尋（訂單編號、訂購姓名、商品名稱）
- 支援商品篩選（從 API 動態載入商品選項）
- 支援狀態篩選
- 按最新訂單排序（SID 數字越大越新）

### 3. 狀態管理
- **個人化資訊**（State: "1"）：顯示「開始製作」按鈕
- **待製作**（State: "3"）：顯示「開始製作」按鈕
- **製作中**（State: "4"）：顯示「製作完成」按鈕
- **待出貨**（State: "5"）：已製作完成，等待出貨

### 4. 操作流程
1. **開始製作**：
   - 點擊按鈕後調用 `/api/bk/MakeBegin` API
   - API 成功後狀態從「個人化資訊」或「待製作」變更為「製作中」
   - 顯示開始製作確認彈窗
2. **製作完成**：
   - 點擊按鈕後調用 `/api/bk/MakeComplete` API
   - API 成功後該筆資料從生產管理頁面移除
   - 顯示製作完成確認彈窗

### 5. 統計功能
- 顯示可開始製作項目數量（個人化資訊 + 待製作）
- 顯示製作中項目數量
- 顯示總計項目數量
- 即時更新統計數據

### 6. 快速篩選功能
- 一鍵篩選可製作項目（個人化資訊 + 待製作）
- 一鍵篩選製作中項目
- 支援多狀態篩選

### 7. 分頁功能
- 每頁顯示 10 筆資料
- 支援頁碼導航
- 支援首頁/末頁快速跳轉

## 檔案結構

```
stores/
├── useProductionStore.ts    # 生產管理 Store
pages/raphaelBackend/production/
├── index.vue               # 生產管理主頁面
└── test.vue               # API 測試頁面
```

## 使用方式

### 1. 基本使用
```javascript
import { useProductionStore } from '~/stores/useProductionStore'

const store = useProductionStore()
await store.fetchProductionData()
```

### 2. 搜尋功能
```javascript
// 設定關鍵字搜尋
store.setKeyword("王先生")
await store.fetchProductionData()

// 設定狀態篩選
store.setStatusFilter("1") // 個人化資訊
await store.fetchProductionData()

store.setStatusFilter("3") // 待製作
await store.fetchProductionData()

// 設定商品篩選
store.setProductFilter("護您穩1型")
await store.fetchProductionData()
```

### 3. 狀態更新
```javascript
// 開始製作（調用 API 並更新狀態，成功後顯示彈窗）
const success = await store.startProductionAPI("00000001", "1")
if (success) {
  store.updateProductionStatus("00000001", "4")
  // 顯示開始製作彈窗
}

// 製作完成（調用 API 並移除項目，成功後顯示彈窗）
const success = await store.completeProductionAPI("00000001", "1")
if (success) {
  store.removeProductionItem("00000001")
  // 顯示製作完成彈窗
}

// 載入商品選項
await store.fetchProductOptions()
```

## 狀態代碼對應

| 代碼 | 狀態名稱 | 顏色 |
|------|----------|------|
| "0" | 未付款 | 紅色 |
| "1" | 個人化資訊 | 綠色 |
| "3" | 待製作 | 紅色 |
| "4" | 製作中 | 綠色 |
| "5" | 待出貨 | 綠色 |
| "6" | 已出貨 | 藍色 |
| "7" | 已簽收 | 藍色 |
| "8" | 退貨申請 | 紅色 |
| "9" | 退貨處理 | 紅色 |
| "A" | 退貨完成 | 紅色 |
| "B" | 退款完成 | 紅色 |

## 測試功能

訪問 `/raphaelBackend/production/test` 可以測試：
- API 直接調用測試
- Store 功能測試
- 資料顯示測試

## 注意事項

1. **權限驗證**：需要有效的 `backendToken` 和 `adminID`
2. **錯誤處理**：已實作完整的錯誤處理和用戶提示
3. **載入狀態**：提供載入中狀態顯示
4. **響應式設計**：支援桌面和移動端顯示
5. **無障礙功能**：按鈕提供 title 提示

## 未來擴充

1. **後端篩選**：可將篩選邏輯移至後端 API
2. **批量操作**：支援批量開始製作/完成製作
3. **歷史記錄**：記錄操作歷史
4. **通知功能**：製作完成時發送通知
5. **匯出功能**：支援資料匯出 