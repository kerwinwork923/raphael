import{R as L}from"./4pesoUdL.js";import{_ as j}from"./-OuEz4cf.js";import{r,J as ee,F as se,o as oe,W as R,g as ae,v as c,M as E,K as p,x as a,y as b,Q as V,R as F,z as te,A as H,L as D,U as le,B as M,$ as K,t as d}from"./D70xjexz.js";import{e as re,a as ne,_ as ie,b as de,c as U}from"./CpRiLZbI.js";import{a as N}from"./CCb-kr4I.js";import{s as ue}from"./Di88QSaI.js";import{_ as ce}from"./DlAUqK2U.js";const ve={components:{Alert:L},setup(){const n=r(!1),s=ee(),C=r("忘記密碼"),e=r(!1),v=r(!1),w=r(""),A=r(""),I=r(!1),m=r("forgetPassword"),t=r(!1),f=r(!1),l=r(["","","","",""]),g=r([]),y=r(60),S=r(null),_=r(""),T=r(""),G=r(""),B=r("");se(l,o=>{o.every(i=>i!=="")&&O()});const J=()=>{v.value=!1},W=()=>{I.value=!I.value},z=()=>{e.value=!e.value},Q=()=>{_.value.length<8?G.value="密碼長度必須至少 8 位":G.value=""},q=()=>{T.value!==_.value?B.value="兩次輸入的密碼不一致":B.value=""},x=()=>{y.value=60,t.value=!1,S.value=ue(()=>{y.value>0?(y.value--,f.value=!1):(clearInterval(S.value),y.value="驗證碼已失效，請重新發送",t.value=!0,f.value=!0,l.value=["","","","",""])},1e3)},X=async()=>{n.value=!0;try{const o=await N.post("https://23700999.com:8081/HMA/API_ForgetPassword.jsp",{Mobile:A.value});o.status===200&&(console.log(o.data),n.value=!1,o.data?(localStorage.setItem("userData",JSON.stringify({MID:o.data.MID,Mobile:A.value})),x(),m.value!="verify"&&(m.value="verify",C.value="輸入驗證碼")):n.value=!1)}catch(o){v.value=!0,w.value=o}finally{n.value=!1}},O=async()=>{n.value=!0;const o=l.value.join(""),i=localStorage.getItem("userData"),{MID:h,Mobile:u}=i?JSON.parse(i):{};y.value>0?(await N.post("https://23700999.com:8081/HMA/API_doExamAuthPassword.jsp",{Mobile:u,MID:h,D1:o[0],D2:o[1],D3:o[2],D4:o[3],D5:o[4]})).data.PASS==="OK"?(m.value="resetPassword",C.value="重新設定密碼"):(l.value=["","","","",""],R(()=>{var k;(k=g.value[0])==null||k.focus()}),v.value=!0,w.value="驗證碼輸入錯誤"):(l.value=["","","","",""],R(()=>{var P;(P=g.value[0])==null||P.focus()}),v.value=!0,w.value="驗證碼時間已過"),n.value=!1},Y=async()=>{const o=localStorage.getItem("userData"),{MID:i,Mobile:h}=o?JSON.parse(o):{};if(_.value.length<8){v.value=!0,w.value="密碼小於8位數";return}if(_.value!==T.value){v.value=!0,w.value="密碼不一致";return}n.value=!0;try{const u=await N.post("https://23700999.com:8081/HMA/API_ChangePassword.jsp",{MID:i,Mobile:h,Password:_.value});u.status===200&&(console.log(u.data),n.value=!1,u.data.Result=="OK"&&(v.value=!0,w.value="密碼重新設定完成，請用新密碼登入",s.push("/")))}catch(u){alert(u)}finally{n.value=!1}},Z=(o,i)=>{var u,P;if((i==null?void 0:i.key)==="Backspace"&&l.value[o]===""&&o>0){(u=g.value[o-1])==null||u.focus();return}(l.value[o]<0||l.value[o]>9)&&(l.value[o]=""),l.value[o]!==""&&o<l.value.length-1&&((P=g.value[o+1])==null||P.focus()),l.value.every(k=>k!=="")&&O()},$=o=>{const i=String.fromCharCode(o.which);/[0-9]/.test(i)||o.preventDefault()};return oe(()=>{R(()=>{g.value=g.value.slice(0,l.value.length)})}),{loading:n,router:s,mobile:A,passwordVisible:I,currentStep:m,verificationTitle:C,API_ForgetPassword:X,API_doExamAuthPassword:O,handleClose:J,alertVisable:v,verificationCodes:l,verificationInput:g,countdownTime:y,countdownInterval:S,handleInput:Z,allowOnlyNumbers:$,startCountdown:x,isReSend:t,isDisabled:f,passwordAgainVisible:e,RaphaelLoading:j,eyesCloseGreen:re,eyesOpenGreen:ne,togglePasswordVisibility:W,togglePasswordAgainVisibility:z,validatePassword:Q,validatePasswordAgain:q,password:_,passwordAgain:T,passwordError:G,passwordAgainError:B,API_reset:Y,alertContent:w}}},fe={class:"forgetPassword"},we={class:"forgetPasswordGroup"},ge={key:0,class:"forgetPasswordWrap"},pe={class:"forgetPasswordBox"},me={class:"phoneGroup"},ye=["disabled"],_e={class:"returnLogin"},Pe={key:1,class:"verfifyWrap"},be={class:"verificationCodeGroup"},Ae=["onUpdate:modelValue","onInput","onKeydown","disabled"],Ie={class:"verificationCodeHintText"},Ce={class:"reSendTextGroup"},he=["disabled"],ke={key:2,class:"resetPasswordWrap"},Ve={class:"resetPasswordBox"},De={class:"passwordGroup"},Me=["type"],Se=["src"],Te={key:0,class:"passwordHintText"},Ge={class:"passwordAgainGroup"},Be=["type"],Oe=["src"],Re={key:1,class:"passwordAgainHintText"};function Ne(n,s,C,e,v,w){const A=L,I=j,m=ae("router-link");return d(),c(D,null,[e.alertVisable===!0?(d(),E(A,{key:0,showRedirectButton:!1,redirectTarget:n.handleRedirect,onClose:e.handleClose},{default:H(()=>[a("span",null,b(e.alertContent),1)]),_:1},8,["redirectTarget","onClose"])):p("",!0),a("div",fe,[e.loading?(d(),E(I,{key:0})):p("",!0),a("div",we,[s[17]||(s[17]=a("div",{class:"raphaelIconImgGroup"},[a("img",{class:"raphaelIcon",src:ie,alt:""})],-1)),a("h1",null,b(e.verificationTitle),1),e.currentStep==="forgetPassword"?(d(),c("div",ge,[a("div",pe,[a("div",me,[V(a("input",{type:"tel","onUpdate:modelValue":s[0]||(s[0]=t=>e.mobile=t),placeholder:"請輸入您的手機號碼"},null,512),[[F,e.mobile]]),s[11]||(s[11]=a("img",{class:"icon1",src:de,alt:""},null,-1))])]),a("button",{class:"vertificationBtn",onClick:s[1]||(s[1]=(...t)=>e.API_ForgetPassword&&e.API_ForgetPassword(...t)),disabled:!e.mobile}," 取得驗證碼 ",8,ye),a("div",_e,[te(m,{to:"/"},{default:H(()=>s[12]||(s[12]=[M("返回")])),_:1})])])):p("",!0),e.currentStep==="verify"?(d(),c("div",Pe,[a("div",be,[(d(!0),c(D,null,le(e.verificationCodes,(t,f)=>V((d(),c("input",{key:f,ref_for:!0,ref:"verificationInput",type:"number",maxlength:"1",class:"vertifyCode","onUpdate:modelValue":l=>e.verificationCodes[f]=l,onInput:l=>e.handleInput(f),onKeydown:l=>e.handleInput(f,l),onKeypress:s[2]||(s[2]=(...l)=>e.allowOnlyNumbers&&e.allowOnlyNumbers(...l)),disabled:e.isDisabled},null,40,Ae)),[[F,e.verificationCodes[f]]])),128))]),a("div",Ie,[typeof e.countdownTime=="number"?(d(),c(D,{key:0},[s[13]||(s[13]=M(" 驗證碼已傳送至您的裝置，請輸入驗證碼 ")),s[14]||(s[14]=a("br",null,null,-1)),M(" ("+b(e.countdownTime)+"秒後失效) ",1)],64)):(d(),c(D,{key:1},[M(b(e.countdownTime),1)],64))]),a("div",Ce,[a("button",{class:"reSendText",disabled:!e.isReSend,onClick:s[3]||(s[3]=(...t)=>e.API_ForgetPassword&&e.API_ForgetPassword(...t))}," 重新發送 ",8,he)])])):p("",!0),e.currentStep==="resetPassword"?(d(),c("div",ke,[a("div",Ve,[a("div",De,[V(a("input",{type:e.passwordVisible?"text":"password","onUpdate:modelValue":s[4]||(s[4]=t=>e.password=t),placeholder:"請輸入密碼",onInput:s[5]||(s[5]=(...t)=>e.validatePassword&&e.validatePassword(...t))},null,40,Me),[[K,e.password]]),s[15]||(s[15]=a("img",{class:"icon1",src:U,alt:""},null,-1)),a("img",{class:"icon2",src:e.passwordVisible?e.eyesOpenGreen:e.eyesCloseGreen,onClick:s[6]||(s[6]=(...t)=>e.togglePasswordVisibility&&e.togglePasswordVisibility(...t)),alt:""},null,8,Se)]),e.passwordError?(d(),c("div",Te,b(e.passwordError),1)):p("",!0),a("div",Ge,[V(a("input",{type:e.passwordAgainVisible?"text":"password","onUpdate:modelValue":s[7]||(s[7]=t=>e.passwordAgain=t),placeholder:"再次輸入您的密碼",onInput:s[8]||(s[8]=(...t)=>e.validatePasswordAgain&&e.validatePasswordAgain(...t))},null,40,Be),[[K,e.passwordAgain]]),s[16]||(s[16]=a("img",{class:"icon1",src:U,alt:""},null,-1)),a("img",{class:"icon2",src:e.passwordAgainVisible?e.eyesOpenGreen:e.eyesCloseGreen,onClick:s[9]||(s[9]=(...t)=>e.togglePasswordAgainVisibility&&e.togglePasswordAgainVisibility(...t)),alt:""},null,8,Oe)]),e.passwordAgainError?(d(),c("div",Re,b(e.passwordAgainError),1)):p("",!0)]),a("button",{class:"resetPasswordBtn",onClick:s[10]||(s[10]=(...t)=>e.API_reset&&e.API_reset(...t))},"確定")])):p("",!0)])])],64)}const je=ce(ve,[["render",Ne]]);export{je as default};
