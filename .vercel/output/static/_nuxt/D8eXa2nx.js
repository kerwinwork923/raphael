import{a as oe}from"./CCb-kr4I.js";import{u as ue}from"./t-MFjoUR.js";import{_ as we}from"./DNAPM-2u.js";import{_ as W}from"./DlAUqK2U.js";import{t as h,v as _,K as N,x as r,y as x,B as te,L as ae,r as I,o as de,z as ve,A as Ue,M as ie,a3 as ye,g as Ne,O as $e,Q as pe,R as Ie,J as ge,i as j,N as z}from"./D70xjexz.js";import{_ as He}from"./-OuEz4cf.js";import{_ as be}from"./B0rTVoH9.js";import{_ as Ve}from"./fh2N3Yhm.js";import{s as De}from"./Di88QSaI.js";const Me={props:{showCloseButton:{type:Boolean,default:!0}},setup(){const R=ue(),m=async(A,a)=>{try{return(await oe.post(A,a)).data}catch(p){throw console.error("API Request Error:",p),p}},b=localStorage.getItem("userData"),{MID:i,Token:u,MAID:c,Mobile:l}=b?JSON.parse(b):{},d=()=>{R.showHRVForUseAlert=!1},n=A=>{const[a,p,f]=A.split("/").map(Number);return new Date().getFullYear()-(1911+a)},g=async A=>{if(A==="abandon"){await $(),d(),location.reload();return}const a=JSON.parse(localStorage.getItem("userData"));if(!a){alert("å°šæœªç™»å…¥ã€‚"),d();return}const p=E=>Number.isInteger(parseInt(E,10));if(!p(a.Height)||parseInt(a.Height)<=0){alert("æ‚¨çš„èº«é«˜æ ¼å¼ä¸æ­£ç¢ºï¼Œè«‹ä¿®æ”¹æœƒå“¡è³‡æ–™"),window.location.href="/changeMember";return}if(!p(a.Weight)||parseInt(a.Weight)<=0){alert("æ‚¨çš„é«”é‡æ ¼å¼ä¸æ­£ç¢ºï¼Œè«‹ä¿®æ”¹æœƒå“¡è³‡æ–™"),window.location.href="/changeMember";return}const f=a.Birthday.split("/");if(f.length!==3||parseInt(f[0])<=0||parseInt(f[1])<1||parseInt(f[1])>12||parseInt(f[2])<1||parseInt(f[2])>31||isNaN(n(a.Birthday))){alert("ç”Ÿæ—¥æ ¼å¼ä¸æ­£ç¢ºæˆ–åŒ…å«ç„¡æ•ˆæ—¥æœŸï¼Œè«‹ä¿®æ”¹æœƒå“¡è³‡æ–™ã€‚"),window.location.href="/changeMember";return}let S=parseInt(a.Sex);if(S!==1&&S!==2&&S!==0){alert("æ€§åˆ¥æ ¼å¼ä¸æ­£ç¢ºï¼Œè«‹ä¿®æ”¹æœƒå“¡è³‡æ–™ã€‚"),window.location.href="/changeMember";return}if(S===2&&(S=0),!["normal","prehypertension","hypertension"].includes(a.DSPR)){R.showDSPRSelect=!0,d();return}const U={age:n(a.Birthday),bp_group:a.DSPR,bp_mode:"ternary",facing_mode:"user",height:parseInt(a.Height),sex:S,weight:parseInt(a.Weight),time:parseInt(a.HRVCalTime)||2};sessionStorage.setItem("data",JSON.stringify(U));const y=R.detectUID,V=R.detectFlag,M=R.detectForm;let T="/vital/scan.html";V&&(T+=`?UID=${y}&flag=${V}&form=${M}`),window.location.href=T},$=async()=>{if(!confirm("ç¢ºå®šè¦æ”¾æ£„æª¢æ¸¬å—ï¼Ÿ"))return;let a="N",p="N";R.detectFlag==="1"?a="Y":R.detectFlag==="2"&&(p="Y");try{const f={MID:i,Token:u,MAID:c,Mobile:l,UID:R.detectUID,BeforeHRVAbandon:a,AfterHRVAbandon:p},S=await m("https://23700999.com:8081/HMA/API_Use_Set_Abandon.jsp",f);console.log("âœ… æ”¾æ£„æˆåŠŸ",S)}catch(f){console.error("âŒ æ”¾æ£„å¤±æ•—ï¼š",f)}};return{store:R,handleCloseHRVAlert:d,convertAndSaveUserData:g}}},Ee={key:0,class:"cover"},Pe={key:1,class:"HRVAlert"},ke={class:"HRVAlertForUseBtnGroup"};function Fe(R,m,b,i,u,c){return h(),_(ae,null,[i.store.showHRVForUseAlert?(h(),_("div",Ee)):N("",!0),i.store.showHRVForUseAlert?(h(),_("div",Pe,[R.showHRVForUseAlert?(h(),_("img",{key:0,class:"HRVAlertClose",onClick:m[0]||(m[0]=(...l)=>i.handleCloseHRVAlert&&i.handleCloseHRVAlert(...l)),src:we,alt:"close"})):N("",!0),r("h3",null,x(i.store.HRVAlertTitle),1),m[3]||(m[3]=r("ul",null,[r("li",null,[te(" æ¸¬é‡æ™‚é–“"),r("span",{class:"point"},"ç´„1åˆ†é˜"),te("ã€‚æ¸¬é‡æ™‚è«‹ä¿æŒå®‰éœèˆ‡ç©©å®šï¼Œé¿å…æ™ƒå‹•ã€äº¤è«‡ã€æ†‹æ°£æˆ–æ·±å‘¼å¸ã€‚ ")]),r("li",null,[te(" å»ºè­°åœ¨"),r("span",{class:"point"},"å…‰ç·šå……è¶³ã€å®‰éœç„¡å¹²æ“¾"),te("çš„ç¨ç«‹ç©ºé–“é€²è¡Œæ¸¬é‡ï¼Œä¸¦ç¢ºä¿å…¨ç¨‹è‡‰éƒ¨ä½æ–¼ç•«é¢ä¸­ã€‚ ")]),r("li",null,"æ¸¬é‡çµæŸå¾Œï¼Œç¶²é æœƒè‡ªå‹•è·³è½‰è‡³ ã€Œæª¢æ¸¬çµæœã€é é¢ã€‚"),r("li",null," æœ¬å·¥å…·æä¾›çš„å¿ƒè·³ã€å¿ƒç‡è®Šç•°ç‡ã€è¡€å£“ã€è¡€æ°§ã€å‘¼å¸èˆ‡å£“åŠ›æŒ‡æ•¸ç­‰è³‡è¨Šï¼Œåƒ…ä¾›ä¿å¥åƒè€ƒï¼Œä¸å…·é†«ç™‚è¨ºæ–·ç”¨é€”ã€‚è«‹å‹¿ä¾æ“šæœ¬æ•¸æ“šè‡ªè¡Œè¨ºæ–·æˆ–èª¿æ•´è—¥ç‰©ï¼Œæ‡‰éµå¾ªé†«å¸«æŒ‡ç¤ºã€‚ "),r("li",null," æœ¬å·¥å…·ä¸å°å› æ¸¬é‡çµæœå¼•ç™¼çš„å¥åº·æˆ–æ³•å¾‹å•é¡Œè² è²¬ï¼Œè«‹æ–¼åšå‡ºä»»ä½•å¥åº·æ±ºç­–å‰ï¼Œè«®è©¢é†«ç™‚å°ˆæ¥­äººå“¡ã€‚ ")],-1)),r("div",ke,[r("button",{class:"HRVAlertBtn HRVAlertBtnAbandon",onClick:m[1]||(m[1]=l=>i.convertAndSaveUserData("abandon"))}," æ”¾æ£„æª¢æ¸¬ "),r("button",{class:"HRVAlertBtn",onClick:m[2]||(m[2]=l=>i.convertAndSaveUserData("confirm"))}," å‰å¾€æª¢æ¸¬ ")])])):N("",!0)],64)}const Dt=W(Me,[["render",Fe],["__scopeId","data-v-0e205824"]]),Be=""+new URL("hrvBefore.fqQc3z7K.png",import.meta.url).href,Ce=""+new URL("hrvAfter.CyOPneNf.png",import.meta.url).href,xe={key:0},Oe={class:"chooseHRVUseMethod"},Ge={class:"hrvMethodGroup"},Ye={__name:"ChooseHRVUseMethod",emits:["selectHRVMethod"],setup(R,{emit:m}){const b=m,i=I(!0),u=()=>{const l=document.querySelectorAll(".chooseHRVUseMethod img");let d=0;l.forEach(n=>{n.complete?d++:(n.onload=()=>{d++,d===l.length&&setTimeout(()=>{i.value=!1},300)},n.onerror=()=>{console.warn(`åœ–ç‰‡è¼‰å…¥å¤±æ•—: ${n.src}`),d++,d===l.length&&setTimeout(()=>{i.value=!1},300)})}),d===l.length&&setTimeout(()=>{i.value=!1},300)};de(()=>{u()});const c=l=>{b("selectHRVMethod",l)};return(l,d)=>(h(),_(ae,null,[d[5]||(d[5]=r("div",{class:"cover"},null,-1)),ve(ye,{name:"fade"},{default:Ue(()=>[i.value?N("",!0):(h(),_("div",xe,[i.value?(h(),ie(He,{key:0})):N("",!0),r("div",Oe,[d[4]||(d[4]=r("h6",null,"è«‹é¸æ“‡",-1)),r("div",Ge,[r("div",{class:"hrvMethod",onClick:d[0]||(d[0]=n=>c("before"))},d[2]||(d[2]=[r("img",{src:Be,alt:""},null,-1),r("h3",null,"ç©¿è¡£å‰æª¢æ¸¬",-1)])),r("div",{class:"hrvMethod",onClick:d[1]||(d[1]=n=>c("after"))},d[3]||(d[3]=[r("img",{src:Ce,alt:""},null,-1),r("h3",null,"ç©¿è¡£å¾Œæª¢æ¸¬",-1),r("small",null,"è£œæ¸¬",-1)]))])])]))]),_:1})],64))}},je=W(Ye,[["__scopeId","data-v-624c7fa7"]]),Le={class:"timeHRVUseAlert"},Je={class:"HRVUseDateGroup"},Ke={key:0},qe={key:0,class:"timeHRVUseAlertSubHint"},ze={__name:"TimeHRVUseAlert",emits:["update:startTime","update:localDate","submit"],setup(R,{emit:m}){const b=m,i=I(""),u=I(""),c=I(""),l=()=>{b("update:localDate",i.value)},d=I(null),n=()=>{d.value&&d.value.showPicker()},g=()=>{if(!u.value){c.value="";return}const[A,a]=u.value.split(":").map(Number),p=new Date;p.setHours(A,a,0),p.setHours(p.getHours());const f=String(p.getHours()).padStart(2,"0"),S=String(p.getMinutes()).padStart(2,"0");c.value=`${f}:${S}`,b("update:startTime",u.value)},$=()=>{if(!i.value||!u.value){alert("è«‹å¡«å¯«å®Œæ•´æ—¥æœŸèˆ‡æ™‚é–“ï¼");return}const A=new Date,[a,p]=u.value.split(":").map(Number),f=new Date(i.value);if(f.setHours(a,p,0),f>A){alert("é–‹å§‹æ™‚é–“ä¸èƒ½è¶…éç•¶å‰æ™‚é–“ï¼Œè«‹é‡æ–°é¸æ“‡ï¼");return}c.value=u.value,b("submit",{date:i.value,startTime:u.value,endTime:c.value})};return(A,a)=>{const p=Ne("VueDatePicker");return h(),_(ae,null,[a[6]||(a[6]=r("div",{class:"cover"},null,-1)),r("div",Le,[a[4]||(a[4]=r("h3",null,"è«‹å¡«å¯«é–‹å§‹ç©¿è¡£çš„æ™‚é–“",-1)),a[5]||(a[5]=r("hr",null,null,-1)),r("div",Je,[a[2]||(a[2]=r("img",{class:"icon1",src:be,alt:"æ—¥æœŸé¸æ“‡"},null,-1)),ve(p,{modelValue:i.value,"onUpdate:modelValue":[a[0]||(a[0]=f=>i.value=f),l],"model-type":"format",format:"yyyy/MM/dd",locale:"zh-TW","enable-time-picker":!1,"cancel-text":"å–æ¶ˆ","select-text":"ç¢ºå®š","max-date":new Date,placeholder:"å¹´/æœˆ/æ—¥",teleport:"body","no-today":"","hide-input-icon":""},null,8,["modelValue","max-date"])]),r("div",{class:"HRVUseTimeGroup",onClick:n},[a[3]||(a[3]=r("img",{class:"icon1",src:Ve,alt:"æ™‚é–“é¸æ“‡"},null,-1)),u.value?N("",!0):(h(),_("span",Ke,"è«‹é¸æ“‡é–‹å§‹ç©¿è¡£çš„æ™‚é–“")),r("span",{class:$e({selected:u.value})},x(u.value?u.value:""),3),pe(r("input",{ref_key:"timeInput",ref:d,"onUpdate:modelValue":a[1]||(a[1]=f=>u.value=f),type:"time",onInput:g},null,544),[[Ie,u.value]])]),r("button",{onClick:$},"é€å‡º"),i.value&&c.value?(h(),_("h6",qe," â€» æ‚¨é¸æ“‡çš„é–‹å§‹æ™‚é–“ï¼š"+x(i.value)+" "+x(c.value),1)):N("",!0)])],64)}}},We=W(ze,[["__scopeId","data-v-77712c07"]]),Qe={class:"progress-container"},Xe={class:"content"},Ze={class:"timerButtonGroup"},et={key:0,class:"expired-options"},tt={key:0,class:"TimeRingForgetBox"},ot={__name:"TimeRing2",props:{productName:{type:String},hasDetectRecord:{type:Boolean},hasDetectTime:{type:String,default:"00:00:00"}},setup(R){const m=R,b=ge(),i=I(!1),u=I(!1),c=I(0),l=I(null),d=I(!1),n={BEFORE:"before",RUNNING:"running",AFTER:"after"},g=I(n.BEFORE),$=j(()=>{switch(g.value){case n.BEFORE:return"é–‹å§‹ç´€éŒ„";case n.RUNNING:return"çµæŸç´€éŒ„";case n.AFTER:return"HRVæª¢æ¸¬(ä½¿ç”¨å¾Œ)";default:return"æœªçŸ¥ç‹€æ…‹"}}),A=j(()=>{if(c.value<=0&&ee.value)return ee.value;const e=Math.floor(c.value/3600),o=Math.floor(c.value%3600/60),s=c.value%60;return`${String(e).padStart(2,"0")}:${String(o).padStart(2,"0")}:${String(s).padStart(2,"0")}`}),a=I(null),p=I(null),f=ue(),S=I(null),J=I(!1),U=I(null),y=I(!1),V=j(()=>{switch(g.value){case n.BEFORE:return{backgroundColor:"#74BC1F",color:"#fff"};case n.RUNNING:return{backgroundColor:"#1FBCB3",color:"#fff"};case n.AFTER:return{backgroundColor:"#74BC1F",color:"#fff"};default:return{backgroundColor:"#E0E0E0",color:"#000"}}}),M=localStorage.getItem("userData"),{MID:T,Token:E,MAID:P,Mobile:k}=M?JSON.parse(M):{};(!T||!E||!P||!k)&&b.push("/");const F=I(null),G=()=>{if(F.value){console.log("â³ è¨ˆæ™‚å™¨å·²ç¶“å•Ÿå‹•ï¼Œä¸é‡è¤‡å•Ÿå‹•");return}if(!l.value){console.warn("âš ï¸ startTimestamp ç‚ºç©ºï¼Œç„¡æ³•å•Ÿå‹•è¨ˆæ™‚å™¨");return}console.log("ğŸš€ è¨ˆæ™‚é–‹å§‹ï¼ŒstartTimestamp =",new Date(l.value).toLocaleString()),g.value!==n.RUNNING&&(console.log("ğŸ”„ ä¿®æ­£ currentDetectionState ç‚º RUNNING"),g.value=n.RUNNING),F.value=De(()=>{const e=Date.now();c.value=Math.floor((e-l.value)/1e3),console.log("â³ è¨ˆæ™‚ä¸­ï¼Œå·²éæ™‚é–“ï¼š",c.value,"ç§’")},1e3)},K=async e=>{console.log("â¹ åœæ­¢è¨ˆæ™‚å™¨ï¼Œæº–å‚™æª¢æŸ¥æ˜¯å¦å¯ä»¥çµæŸ"),F.value&&(clearInterval(F.value),F.value=null),d.value=!1;const o=await v("1",a.value);if(console.log("ğŸ” ä½¿ç”¨å‰æª¢æ¸¬å®Œæˆç‹€æ…‹:",o),o==="N"){alert("å°šæœªå®Œæˆä½¿ç”¨å‰æª¢æ¸¬ï¼Œç„¡æ³•çµæŸï¼"),g.value=n.RUNNING,console.log("âš ï¸ ä¿æŒ `RUNNING` ç‹€æ…‹ï¼Œè¨ˆæ™‚æ•¸å€¼ä¸è®Š:",c.value);return}console.log("âœ… ä½¿ç”¨å‰æª¢æ¸¬å·²å®Œæˆï¼Œæ›´æ–°ç‹€æ…‹ç‚º `AFTER`"),g.value=n.AFTER;try{await B(),console.log("âœ… è¨ˆæ™‚å·²çµæŸï¼ŒAPI èª¿ç”¨æˆåŠŸ"),e!=!1&&O(a.value)}catch(s){console.error("âŒ çµæŸ API èª¿ç”¨å¤±æ•—ï¼š",s)}},L=e=>{f.detectFlag="1",f.detectUID=e,f.detectForm=m.productName,f.showHRVForUseAlert=!0,f.HRVAlertTitle="(ä½¿ç”¨å‰)-HRVé‡æ¸¬"},O=e=>{f.detectFlag="2",f.detectUID=e,f.detectForm=`*${m.productName}`,f.showHRVForUseAlert=!0,f.HRVAlertTitle="(ä½¿ç”¨å¾Œ)-HRVé‡æ¸¬",console.log("ä½¿ç”¨å¾Œæª¢æ¸¬å·²å•Ÿå‹•",{UIDVal:e,productName:m.productName})},ne=async()=>{if(!i.value){i.value=!0;try{switch(g.value){case n.BEFORE:if(a.value){console.log("å·²æœ‰ UIDï¼Œå¾ API æ™‚é–“é–‹å§‹ HRV æª¢æ¸¬");const e=await Z();if(e!=null&&e.StartTime)l.value=new Date(`${e.StartTime.slice(0,4)}-${e.StartTime.slice(4,6)}-${e.StartTime.slice(6,8)}T${e.StartTime.slice(8,10)}:${e.StartTime.slice(10,12)}:${e.StartTime.slice(12)}`).getTime(),c.value=Math.floor((Date.now()-l.value)/1e3);else{l.value=Date.now(),console.warn("èˆŠçš„ UID å¯èƒ½å·²å¤±æ•ˆï¼Œå‰µå»ºæ–°çš„ UID");const o=await w();if(o!=null&&o.UID)L(o.UID);else{console.error("å‰µå»º UID å¤±æ•—");return}}G()}else{const e=await w();e!=null&&e.UID?(y.value=!0,l.value=Date.now(),G()):console.error("å‰µå»º UID å¤±æ•—")}break;case n.RUNNING:console.log("çµæŸ HRV æª¢æ¸¬"),await K();break;case n.AFTER:O(a.value);break;default:console.error("æœªçŸ¥æª¢æ¸¬ç‹€æ…‹")}}finally{i.value=!1}}},se=async()=>{if(!U.value){alert("è«‹é¸æ“‡çµæŸæ™‚é–“");return}const e=Q(U.value);console.log("é¸æ“‡çš„çµæŸæ™‚é–“:",e);try{await B(e),J.value=!1,S.value=!1,g.value=n.AFTER,console.log("æª¢æ¸¬å·²æ‰‹å‹•çµæŸ")}catch(o){console.error("çµæŸæª¢æ¸¬æ™‚ç™¼ç”ŸéŒ¯èª¤:",o)}},Q=e=>{const o=new Date(e),s=o.getFullYear(),D=String(o.getMonth()+1).padStart(2,"0"),H=String(o.getDate()).padStart(2,"0"),q=String(o.getHours()).padStart(2,"0"),le=String(o.getMinutes()).padStart(2,"0"),ce=String(o.getSeconds()).padStart(2,"0");return`${s}${D}${H}${q}${le}${ce}`},X=async()=>{console.log("æ­£åœ¨è™•ç†çµæŸé‚è¼¯..."),F.value&&(clearInterval(F.value),F.value=null),d.value=!1;const o=Q(new Date);try{await B(o),console.log("çµæŸ API èª¿ç”¨æˆåŠŸ"),g.value=n.AFTER,S.value=!1,O(a.value)}catch(s){console.error("çµæŸ API èª¿ç”¨å¤±æ•—:",s)}},C=async(e,o)=>{try{return(await oe.post(e,o)).data}catch(s){throw s}},Z=async()=>{try{const e=await C("https://23700999.com:8081/HMA/API_MID_ProductName_UIDInfo.jsp",{MID:T,Token:E,MAID:P,Mobile:k,ProductName:m.productName});if(console.log("ğŸ“¡ API_MID_ProductName_UIDInfo å›æ‡‰:",e),(e==null?void 0:e.Result)!=="OK")return console.error("âŒ ç„¡æ³•ç²å–æœ‰æ•ˆçš„ UID è³‡è¨Šï¼š",e),null;if(e.BeforeHRVAbandon==="Y"&&console.warn("å·²æ”¾æ£„å‰æ¸¬ (BeforeHRVAbandon=Y)ã€‚"),!e.UID)return console.warn("âš ï¸ UID ç‚º nullï¼Œç„¡æ³•ç¹¼çºŒå¾ŒçºŒæ“ä½œ"),null;if(e.StartTime){const s=new Date(`${e.StartTime.slice(0,4)}-${e.StartTime.slice(4,6)}-${e.StartTime.slice(6,8)}T${e.StartTime.slice(8,10)}:${e.StartTime.slice(10,12)}:${e.StartTime.slice(12)}`).getTime();l.value=s;const D=Date.now();return c.value=Math.floor((D-s)/1e3),console.log(`â³ StartTime è¨­å®šç‚º: ${new Date(l.value).toLocaleString()}`),console.log(`â³ ç¶“éæ™‚é–“è¨ˆç®—çµæœ: ${c.value} ç§’`),e}else console.warn("âš ï¸ ç„¡æ³•è§£æ StartTimeï¼Œå¯èƒ½å¾Œç«¯æ²’æœ‰è¿”å›")}catch(e){console.error("âŒ API èª¿ç”¨å¤±æ•—ï¼š",e)}return null},t=async e=>{try{const o=await C("https://23700999.com:8081/HMA/API_UIDInfo.jsp",{MID:T,Token:E,MAID:P,Mobile:k,UID:e});if((o==null?void 0:o.Result)==="OK")return o}catch{}},v=async(e,o)=>{if(!o)return console.error("âŒ UID ç‚º nullï¼Œç„¡æ³•èª¿ç”¨ API_HRV2_UID_Flag_Info"),null;try{const s=await C("https://23700999.com:8081/HMA/API_HRV2_UID_Flag_Info.jsp",{MID:T,Token:E,MAID:P,Mobile:k,UID:o,Flag:e});if((s==null?void 0:s.Result)==="OK"){console.log("âœ… æˆåŠŸç²å– HRV2 æª¢æ¸¬è³‡æ–™ç‹€æ…‹ï¼š",s);const D=s.IsExit,H=s.IsAbandon,q=await t(o);return e==="1"&&D==="N"&&q.BeforeHRVAbandon!=="Y"&&(y.value=!0,me()),{isExit:D,isAbandon:H}}else return console.error("âŒ ç„¡æ³•ç²å– HRV2 è³‡æ–™ç‹€æ…‹ï¼š",s),null}catch(s){return console.error("âŒ API èª¿ç”¨å¤±æ•—ï¼š",s),null}},w=async()=>{try{const e=await C("https://23700999.com:8081/HMA/API_UseStart.jsp",{MID:T,Token:E,MAID:P,Mobile:k,ProductName:m.productName});return e!=null&&e.UID?(a.value=e.UID,console.log("æˆåŠŸå‰µå»ºæ–°çš„ UIDï¼š",a.value)):console.error("å‰µå»ºæ–°çš„ UID å¤±æ•—ï¼Œè«‹æª¢æŸ¥ API éŸ¿æ‡‰"),e}catch(e){return console.error("å‰µå»ºæ–°çš„ UID API èª¿ç”¨å¤±æ•—ï¼š",e),null}},B=async(e="")=>{if(!a.value){console.error("ç„¡æ³•çµæŸï¼Œå› ç‚º UID ä¸å­˜åœ¨");return}const o={MID:T,Token:E,MAID:P,Mobile:k,UID:a.value,EndTime:e||""};try{const s=await C("https://23700999.com:8081/HMA/API_UseEnd.jsp",o);console.log("çµæŸ API èª¿ç”¨æˆåŠŸ",s)}catch(s){console.error("çµæŸ API èª¿ç”¨å¤±æ•—:",s)}},Y=I(!1),ee=I(null),re=e=>new Date(`${e.slice(0,4)}-${e.slice(4,6)}-${e.slice(6,8)}T${e.slice(8,10)}:${e.slice(10,12)}:${e.slice(12)}`),he=e=>{const o=Math.floor(e/3600),s=Math.floor(e%3600/60),D=e%60;return`${String(o).padStart(2,"0")}:${String(s).padStart(2,"0")}:${String(D).padStart(2,"0")}`},Re=async()=>{try{const e=await C("https://23700999.com:8081/HMA/API_UIDInfo_Search12.jsp",{MID:T,Token:E,MAID:P,Mobile:k,ProductName:m.productName,BeforeHRVDetect:"N"});if(e&&e.Result!=="NOData"){if(e.AfterHRVAbandon==="Y")return;const o=e.CheckTime?re(e.CheckTime):null;if(o&&(new Date-o)/(1e3*60*60)>24){console.log("è¶…é 24 å°æ™‚ï¼Œä¸é€²è¡Œå¾ŒçºŒåˆ¤æ–·");return}if(a.value=e.UID,console.log("ğŸ” å–å¾— UID:",a.value),e.StartTime&&e.EndTime){const s=re(e.StartTime),D=re(e.EndTime),H=Math.floor((D-s)/1e3);ee.value=he(H),O(a.value),console.log("ä¸Šæ¬¡æ¸¬è©¦æŒçºŒæ™‚é–“:",ee.value)}Y.value=!0,console.log("âœ… å·²å®Œæˆ HRV ä½¿ç”¨å¾Œæª¢æ¸¬ï¼Œä¸å†é¡¯ç¤ºã€çµæŸã€æŒ‰éˆ•")}else console.log("âŒ æ²’æœ‰æ‰¾åˆ°å°æ‡‰çš„æ•¸æ“šï¼Œå¯èƒ½æœªé€²è¡Œæ¸¬è©¦")}catch(e){console.log("âŒ API_UIDInfo_Search12 èª¿ç”¨å¤±æ•—:",e)}},me=async e=>{if(e==="before")L(a.value);else if(e==="after"){if(!a.value){console.error("âŒ UID ä¸å­˜åœ¨ï¼Œç„¡æ³•é€²è¡ŒçµæŸé‚è¼¯");return}await K(!1),y.value=!1,u.value=!0}},Te=async({date:e,startTime:o,endTime:s})=>{try{const D=new Date(`${e} ${o}`),H=D.getFullYear(),q=String(D.getMonth()+1).padStart(2,"0"),le=String(D.getDate()).padStart(2,"0"),ce=String(D.getHours()).padStart(2,"0"),Ae=String(D.getMinutes()).padStart(2,"0"),Se=String(D.getSeconds()).padStart(2,"0"),fe=`${H}${q}${le}${ce}${Ae}${Se}`;console.log("æ¬²è¨­å®šçš„é–‹å§‹æ™‚é–“:",fe),await _e(fe),u.value=!1,O(a.value)}catch(D){console.error("æ›´æ–°é–‹å§‹æ™‚é–“å¤±æ•—ï¼š",D)}},_e=async e=>{const o={MID:T,Token:E,MAID:P,Mobile:k,UID:a.value,StartTime:e};try{const{data:s}=await oe.post("https://23700999.com:8081/HMA/API_UIDStartEndTime.jsp",o);if((s==null?void 0:s.Result)==="OK")console.log("é–‹å§‹æ™‚é–“æ›´æ–°æˆåŠŸï¼š",s);else throw new Error(JSON.stringify(s))}catch(s){throw console.error("API_UIDStartEndTime å‘¼å«å¤±æ•—",s),s}};return de(async()=>{p.value=null,console.log("ğŸ” onMounted å•Ÿå‹•ï¼Œé–‹å§‹åˆå§‹åŒ– HRV ç‹€æ…‹...");try{const e=await Z();if(e){a.value=e.UID,e.BeforeHRVAbandon==="Y"?console.warn("å·²æ”¾æ£„å‰æ¸¬ (BeforeHRVAbandon=Y)ã€‚"):e.AfterHRVAbandon==="Y"&&console.warn("å·²æ”¾æ£„å¾Œæ¸¬ (AfterHRVAbandon=Y)ã€‚"),console.log("âœ… æˆåŠŸç²å–æœ‰æ•ˆçš„ UIDï¼š",a.value);const o=await v("1",a.value);if(console.log("ğŸ” HRV å‰æ¸¬ç´€éŒ„:",o),o==="Y"?(console.log("âœ… HRV å‰æ¸¬å·²å®Œæˆï¼Œé€²å…¥ RUNNING ç‹€æ…‹"),g.value=n.RUNNING,G()):(console.log("âš ï¸ HRV å‰æ¸¬æœªå®Œæˆï¼Œå›åˆ° BEFORE ç‹€æ…‹"),g.value=n.BEFORE),e.StartTime){console.log("â³ ç²å– StartTimeï¼Œæ¢å¾©è¨ˆæ™‚..."),l.value=new Date(`${e.StartTime.slice(0,4)}-${e.StartTime.slice(4,6)}-${e.StartTime.slice(6,8)}T${e.StartTime.slice(8,10)}:${e.StartTime.slice(10,12)}:${e.StartTime.slice(12)}`).getTime();const s=Date.now();c.value=Math.floor((s-l.value)/1e3),console.log(`â³ StartTime è¨­å®šç‚º: ${new Date(l.value).toLocaleString()}`),console.log(`â³ è¨ˆæ™‚å™¨æ¢å¾©ï¼Œå·²éæ™‚é–“: ${c.value} ç§’`),c.value>0&&(console.log("ğŸ”„ è‡ªå‹•åˆ‡æ›è‡³ RUNNING ç‹€æ…‹"),g.value=n.RUNNING,G())}else console.warn("âš ï¸ StartTime ä¸å­˜åœ¨ï¼Œè¨ˆæ™‚å™¨å°‡å¾ 0 é–‹å§‹")}else{console.warn("âŒ ç„¡æ³•ç²å–ä½¿ç”¨è€…è³‡æ–™ï¼Œæª¢æŸ¥ API_ UIDInfo_Search12()");const o=await Re();if(o&&o.StartTime){console.log("â³ API_UIDInfo_Search12() å–å¾— StartTimeï¼Œæ¢å¾©è¨ˆæ™‚..."),l.value=new Date(`${o.StartTime.slice(0,4)}-${o.StartTime.slice(4,6)}-${o.StartTime.slice(6,8)}T${o.StartTime.slice(8,10)}:${o.StartTime.slice(10,12)}:${o.StartTime.slice(12)}`).getTime();const s=Date.now();c.value=Math.floor((s-l.value)/1e3),console.log(`â³ StartTime è¨­å®šç‚º: ${new Date(l.value).toLocaleString()}`),console.log(`â³ è¨ˆæ™‚å™¨æ¢å¾©ï¼Œå·²éæ™‚é–“: ${c.value} ç§’`),c.value>0&&(console.log("ğŸ”„ è‡ªå‹•åˆ‡æ›è‡³ RUNNING ç‹€æ…‹"),g.value=n.RUNNING,G())}else console.warn("âŒ ç„¡æ³•å–å¾—æœ‰æ•ˆçš„æ™‚é–“è³‡è¨Šï¼Œå°‡ä¸ä½¿ç”¨é è¨­æ™‚é–“"),c.value=0}}catch(e){console.error("âŒ åˆå§‹åŒ–å¤±æ•—ï¼š",e)}}),(e,o)=>{const s=je,D=We;return h(),_(ae,null,[y.value?(h(),ie(s,{key:0,onSelectHRVMethod:me})):N("",!0),u.value?(h(),ie(D,{key:1,startTime:e.selectedTime,"onUpdate:startTime":o[0]||(o[0]=H=>e.selectedTime=H),localDate:e.selectedDate,"onUpdate:localDate":o[1]||(o[1]=H=>e.selectedDate=H),onSubmit:Te},null,8,["startTime","localDate"])):N("",!0),r("div",Qe,[r("div",{class:"progress-border",style:z({background:e.progressGradient})},[r("div",Xe,x(A.value),1)],4),r("div",Ze,[S.value?(h(),_("div",et,[r("button",{style:{"background-color":"#74bc1f"},onClick:o[2]||(o[2]=H=>O(a.value))}," HRVæª¢æ¸¬(ä½¿ç”¨å¾Œ) "),Y.value?N("",!0):(h(),_("button",{key:0,style:{"background-color":"#1fbcb3"},onClick:X}," çµæŸ "))])):(h(),_("button",{key:1,style:z(V.value),onClick:ne},x($.value),5))]),J.value?(h(),_("div",tt,[o[4]||(o[4]=r("label",null,"é¸æ“‡çµæŸæ™‚é–“:",-1)),pe(r("input",{type:"datetime-local","onUpdate:modelValue":o[3]||(o[3]=H=>U.value=H)},null,512),[[Ie,U.value]]),r("button",{onClick:se},"ç¢ºèª")])):N("",!0)])],64)}}},ht=W(ot,[["__scopeId","data-v-67a4c370"]]),at={class:"progress-container"},nt={class:"content"},st={key:0,class:"completion-message"},rt={key:1,class:"flex"},lt=["disabled"],ct={__name:"TimeRing",props:{totalTime:{type:Number,default:3600},productName:{type:String,default:""},hasTodayRecord:{type:String,default:3e3}},setup(R){const m=R,b=ge(),i=ue(),u={BEFORE:"before",RUNNING:"running",AFTER:"after"},c=I(u.BEFORE),l=I(m.totalTime*1e3),d=I(!1),n=I(""),g=I(!1);let $=null,A=0;const a=j(()=>{switch(c.value){case u.BEFORE:return"é–‹å§‹ç´€éŒ„";case u.RUNNING:return"é‡æ–°ç´€éŒ„";case u.AFTER:return"çµæŸç´€éŒ„";default:return"æœªçŸ¥ç‹€æ…‹"}}),p=j(()=>{switch(c.value){case u.BEFORE:case u.RUNNING:case u.AFTER:return{backgroundColor:"#74BC1F",color:"#fff"};default:return{backgroundColor:"#E0E0E0",color:"#000"}}}),f=j(()=>{const t=m.totalTime*1e3-l.value,v=Math.min(t/(m.totalTime*1e3)*100,100);return{background:`conic-gradient(#74BC1F 0% ${v}%, #ffffff ${v}% 100%)`,transition:"background 0.1s linear"}}),S=j(()=>{const t=Math.floor(l.value/1e3),v=Math.floor(t/3600),w=Math.floor(t%3600/60),B=t%60;return`${String(v).padStart(2,"0")}:${String(w).padStart(2,"0")}:${String(B).padStart(2,"0")}`}),J=JSON.parse(localStorage.getItem("userData")||"{}"),{MID:U="",Token:y="",MAID:V="",Mobile:M=""}=J;(!U||!y||!V||!M)&&(console.error("ç”¨æˆ¶è³‡æ–™ä¸å®Œæ•´ï¼Œè·³å›ç™»å…¥"),b.push("/"));async function T(t,v){try{const{data:w}=await oe.post(t,v);return w}catch(w){return console.error(`[APIå¤±æ•—] ${t}`,w),null}}async function E(){const t=await T("https://23700999.com:8081/HMA/API_UseStart.jsp",{MID:U,Token:y,MAID:V,Mobile:M,ProductName:m.productName});return!t||!t.UID?(console.warn("useStartAPI => ç„¡æ³•å»ºç«‹ UID"),null):t}async function P(){n.value&&await T("https://23700999.com:8081/HMA/API_UseEnd.jsp",{MID:U,Token:y,MAID:V,Mobile:M,UID:n.value})}async function k(){n.value&&await T("https://23700999.com:8081/HMA/API_DeleteStart.jsp",{MID:U,Token:y,MAID:V,Mobile:M,UID:n.value,ProductName:m.productName})}async function F(t,v){if(!v)return null;const w=await T("https://23700999.com:8081/HMA/API_HRV2_UID_Flag_Info.jsp",{MID:U,Token:y,MAID:V,Mobile:M,UID:v,Flag:t});if(w){const B=w.IsExit,Y=await O(v);B==="N"&&Y.BeforeHRVAbandon!=="Y"&&K(v)}return w==null?void 0:w.IsExit}async function G(){return T("https://23700999.com:8081/HMA/API_MID_ProductName_UIDInfo.jsp",{MID:U,Token:y,MAID:V,Mobile:M,ProductName:m.productName})}function K(t){i.detectFlag="1",i.detectUID=t,i.detectForm=m.productName,i.showHRVForUseAlert=!0,i.HRVAlertTitle="(ä½¿ç”¨å‰)-HRVé‡æ¸¬",console.log("å·²å‘¼å« 'ä½¿ç”¨å‰æª¢æ¸¬' => UID:",t)}function L(t){i.detectFlag="2",i.detectUID=t,i.detectForm=`*${m.productName}`,i.showHRVForUseAlert=!0,i.HRVAlertTitle="(ä½¿ç”¨å¾Œ)-HRVé‡æ¸¬",console.log("å·²å‘¼å« 'ä½¿ç”¨å¾Œæª¢æ¸¬' => UID:",t)}const O=async t=>{try{const v=await T("https://23700999.com:8081/HMA/API_UIDInfo.jsp",{MID:U,Token:y,MAID:V,Mobile:M,UID:t});if((v==null?void 0:v.Result)==="OK")return v}catch{}};function ne(){console.log("é–‹å§‹å€’æ•¸ => å‰©é¤˜ç§’æ•¸:",l.value/1e3),d.value=!0,A=Date.now(),$&&clearInterval($),$=De(async()=>{const t=Date.now(),v=t-A;A=t,l.value=Math.max(l.value-v,0),l.value<=0&&(clearInterval($),$=null,d.value=!1,await P(),L(n.value))},1e3)}const se=t=>new Date(`${t.slice(0,4)}-${t.slice(4,6)}-${t.slice(6,8)}T${t.slice(8,10)}:${t.slice(10,12)}:${t.slice(12)}`),Q=async()=>{try{const t=await T("https://23700999.com:8081/HMA/API_UIDInfo_Search12.jsp",{MID:U,Token:y,MAID:V,Mobile:M,ProductName:m.productName,BeforeHRVDetect:"N"});if(t&&t.Result!=="NOData"){if(t.AfterHRVAbandon==="Y")return;const v=t.CheckTime?se(t.CheckTime):null;if(v&&(new Date-v)/(1e3*60*60)>24){console.log("è¶…é 24 å°æ™‚ï¼Œä¸é€²è¡Œå¾ŒçºŒåˆ¤æ–·");return}n.value=t.UID,console.log("ğŸ” å–å¾— UID:",n.value),l.value=0,L(n.value)}else console.log("âŒ æ²’æœ‰æ‰¾åˆ°å°æ‡‰çš„æ•¸æ“šï¼Œå¯èƒ½æœªé€²è¡Œæ¸¬è©¦")}catch(t){console.log("âŒ API_UIDInfo_Search12 èª¿ç”¨å¤±æ•—:",t)}};async function X(){if(!g.value){g.value=!0;try{switch(console.log("æŒ‰éˆ•é»æ“Š => ç‹€æ…‹:",c.value),c.value){case u.BEFORE:{if(!n.value){const t=await E();if(t!=null&&t.UID)n.value=t.UID;else{console.error("ç„¡æ³•å»ºç«‹ UIDï¼Œç„¡æ³•ç¹¼çºŒ");return}}K(n.value);break}case u.RUNNING:{confirm("ç¢ºå®šè¦é‡æ–°æª¢æ¸¬å—ï¼Ÿé€™æœƒæ¸…é™¤æœ¬æ¬¡å€’æ•¸è¨˜éŒ„ã€‚")&&(await k(),C());break}case u.AFTER:{L(n.value);break}default:console.warn("æœªçŸ¥ç‹€æ…‹:",c.value)}}finally{g.value=!1}}}function C(){$&&(clearInterval($),$=null),c.value=u.BEFORE,l.value=m.totalTime*1e3,d.value=!1,n.value="",console.log("å·²é‡ç½® => å›åˆ° BEFORE ç‹€æ…‹")}de(async()=>{try{const t=await G();if(t!=null&&t.UID){n.value=t.UID;const v=await F("1",n.value);if(console.log("ğŸ” HRV å‰æ¸¬ç´€éŒ„:",v),t.StartTime){const w=Z(t.StartTime),B=Date.now()-w.getTime(),Y=m.totalTime*1e3-B;Y>0?(l.value=Y,c.value=u.RUNNING,ne()):(await P(),C())}}else await Q()}catch(t){console.error("onMounted åˆå§‹åŒ–å¤±æ•—:",t)}});function Z(t){return!t||t.length<14?new Date:new Date(`${t.slice(0,4)}-${t.slice(4,6)}-${t.slice(6,8)}T${t.slice(8,10)}:${t.slice(10,12)}:${t.slice(12,14)}`)}return(t,v)=>(h(),_("div",at,[r("div",{class:"progress-border",style:z(f.value)},[r("div",nt,x(S.value),1)],4),R.hasTodayRecord?(h(),_("div",st,"æ„Ÿè¬æ‚¨çš„ä½¿ç”¨")):N("",!0),R.hasTodayRecord?N("",!0):(h(),_("div",rt,[c.value!==u.AFTER?(h(),_("button",{key:0,style:z(p.value),onClick:X,disabled:g.value},x(a.value),13,lt)):N("",!0),c.value===u.AFTER?(h(),_("button",{key:1,style:z(p.value),onClick:X},x(a.value),5)):N("",!0)]))]))}},Rt=W(ct,[["__scopeId","data-v-98a06ae2"]]);export{Rt as _,ht as a,Dt as b};
