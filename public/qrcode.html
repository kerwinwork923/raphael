<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>æ™ºå¹³è¡¡è¨‚è£½å¥åº·å…±å‰µæœªä¾†ç™¼è¡¨æœƒï½œå“¡å·¥å ±åˆ°æƒæ</title>

  <!-- QRcode æƒæå‡½å¼åº«ï¼ˆCDNï¼‰ -->
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>

  <style>
    :root {
      --deep: #0f3b3b;
      --ink: #1f2a37;
      --gold: #c9a14a;
      --muted: #6b7280;
      --bg: #ffffff;
      --chip: #f8f4ea;
      --accent: #22c55e; /* æƒææŒ‰éˆ•ç”¨ä¸€é»ç¶ è‰²å‘¼æ‡‰å¥åº·æ„Ÿ */
      --danger: #ef4444;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: "PingFang TC","Microsoft JhengHei",sans-serif;
      background: var(--bg);
      color: var(--ink);
      line-height: 1.7;
      overflow-x: hidden;
    }

    .gold-bg {
      position: relative;
      isolation: isolate;
    }

    .gold-svg {
      position: absolute;
      inset: 0;
      z-index: -1;
      opacity: .85;
      pointer-events: none;
    }

    header {
      text-align: center;
      padding: 40px 16px 20px;
    }

    .logo {
      width: 120px;
      margin-bottom: 16px;
      border-radius: 50%;
      box-shadow: 0 0 8px rgba(201,161,74,.3);
    }

    h1 {
      font-size: clamp(24px,4vw,32px);
      font-weight: 800;
      color: var(--deep);
      margin-bottom: 8px;
    }

    .subtitle {
      color: #8b6a2d;
      font-weight: 500;
      font-size: clamp(14px,2.5vw,16px);
      line-height: 1.8;
      margin: 0 auto;
      max-width: 640px;
    }

    .section {
      padding: 32px 20px 40px;
    }

    .container {
      max-width: 1100px;
      margin: 0 auto;
    }

    .title {
      font-size: clamp(20px,3vw,26px);
      text-align: center;
      color: var(--deep);
      margin-bottom: 20px;
      position: relative;
    }

    .title::after {
      content: "";
      display: block;
      width: 100px;
      height: 3px;
      background: linear-gradient(90deg,transparent,var(--gold),transparent);
      margin: 10px auto 0;
      border-radius: 2px;
    }

    .card {
      background: #fff;
      border-radius: 16px;
      padding: 24px;
      border: 1px solid rgba(201,161,74,.35);
      box-shadow: 0 12px 36px rgba(17,24,39,.06);
    }

    .hint {
      font-size: 0.9rem;
      color: var(--muted);
      margin-bottom: 12px;
      line-height: 1.7;
    }

    .scanner-layout {
      display: grid;
      grid-template-columns: minmax(260px, 380px) minmax(0, 1fr);
      gap: 20px;
      align-items: flex-start;
    }

    /* å¤–å±¤æ®¼ï¼šæ±ºå®šå¤§å°ã€åœ“è§’èˆ‡è£åˆ‡ï¼Œé¿å…ç•«é¢æº¢å‡º */
    .reader-wrap {
      width: 100%;
      max-width: 360px;
      margin: 0 auto;
      border-radius: 16px;
      overflow: hidden; /* é—œéµï¼šè¶…å‡ºçš„ç›¸æ©Ÿç•«é¢æœƒè¢«è£æ‰ */
      box-shadow: 0 8px 24px rgba(0,0,0,.12);
      background: #000;
    }

    /* å…§å±¤çµ¦ html5-qrcode ä½¿ç”¨ï¼Œå¡«æ»¿å®¹å™¨å³å¯ */
    #reader {
      width: 100%;
      height: 100%;
    }

    .controls {
      margin-top: 12px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
    }

    button {
      border: none;
      border-radius: 999px;
      padding: 8px 14px;
      font-size: 0.9rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
    }

    button.primary {
      background: var(--accent);
      color: #fff;
      font-weight: 600;
    }

    button.secondary {
      background: #e5e7eb;
      color: #111827;
    }

    button.danger {
      background: var(--danger);
      color: #fff;
      font-weight: 600;
    }

    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .status {
      font-size: 0.85rem;
      color: var(--muted);
      margin-top: 6px;
    }

    .status span.ok {
      color: var(--accent);
      font-weight: 600;
    }

    .status span.err {
      color: var(--danger);
      font-weight: 600;
    }

    .muted {
      color: var(--muted);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.9rem;
      margin-top: 10px;
    }

    thead {
      background: #f9fafb;
    }

    th, td {
      padding: 8px 6px;
      border-bottom: 1px solid #e5e7eb;
      text-align: left;
    }

    th:nth-child(1),
    td:nth-child(1) {
      width: 40px;
      text-align: center;
    }

    th:nth-child(3),
    td:nth-child(3) {
      width: 160px;
      white-space: nowrap;
    }

    .badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 999px;
      background: #e5f8eb;
      color: var(--accent);
      font-size: 0.75rem;
    }

    .badge.dup {
      background: #fef2f2;
      color: var(--danger);
    }

    footer {
      border-top: 1px solid rgba(201,161,74,.3);
      padding: 18px;
      text-align: center;
      color: var(--muted);
      background: linear-gradient(135deg,rgba(201,161,74,.08),rgba(255,255,255,0));
      font-size: 0.85rem;
    }

    @media (max-width: 768px) {
      header {
        padding: 28px 12px 12px;
      }

      .section {
        padding: 24px 14px 32px;
      }

      .scanner-layout {
        grid-template-columns: 1fr;
      }

      /* æ‰‹æ©Ÿæ™‚è®“ç›¸æ©Ÿå¯¬åº¦åƒæ»¿å¡ç‰‡ */
      .reader-wrap {
        max-width: 100%;
      }

      th:nth-child(3),
      td:nth-child(3) {
        width: auto;
      }
    }
  </style>
</head>
<body class="gold-bg">
  <!-- èƒŒæ™¯é‡‘è‰²ç·šæ¢ -->
  <svg class="gold-svg" viewBox="0 0 1200 800" preserveAspectRatio="none" aria-hidden="true">
    <defs>
      <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
        <stop offset="0%" stop-color="#e9d9b0" stop-opacity="0"/>
        <stop offset="40%" stop-color="#d9c491" stop-opacity=".55"/>
        <stop offset="100%" stop-color="#c9a14a" stop-opacity=".9"/>
      </linearGradient>
    </defs>
    <g fill="none" stroke="url(#g)" stroke-width="3">
      <path d="M-50,60 L600,420 L1250,-10" />
      <path d="M-100,720 L740,260 L1250,500" />
      <path d="M-50,380 L420,10 L1250,260" />
      <path d="M-10,560 L380,280 L1200,720" />
    </g>
  </svg>

  <!-- é é¦–ï¼šæ²¿ç”¨ç™¼è¡¨æœƒå“ç‰Œ -->
  <header>
    <img src="https://i.pinimg.com/736x/89/6d/93/896d9311bb3fb31441530bc508b16f73.jpg" class="logo" alt="WiseBalance Logo" />
    <h1>æ™ºå¹³è¡¡è¨‚è£½å¥åº·å…±å‰µæœªä¾†ç™¼è¡¨æœƒ</h1>
  </header>

  <!-- æƒæä¸»é«” -->
  <section class="section">
    <div class="container">
      <h2 class="title">ä¾†è³“å ±åˆ°æƒæå°ˆå€</h2>
      <div class="card">
        <p class="hint">
          ä½¿ç”¨èªªæ˜ï¼š<br>
          1ï¸âƒ£ å°‡ä¾†è³“æ‰‹æ©Ÿä¸Šçš„ QRcode å°æº–ç•«é¢ä¸­å¤®ï¼Œç³»çµ±æœƒè‡ªå‹•è¾¨è­˜<br>
        </p>

        <div class="scanner-layout">
          <!-- å·¦å´ï¼šç›¸æ©Ÿæƒæ -->
          <div>
            <div class="reader-wrap">
              <div id="reader"></div>
            </div>
            <div class="controls">
              <button id="startBtn" class="primary">â–¶ é–‹å§‹æƒæ</button>
              <button id="stopBtn" class="secondary" disabled>â¹ æš«åœæƒæ</button>
              <button id="switchCamBtn" class="secondary" disabled>ğŸ”„ åˆ‡æ›é¡é ­</button>
              <button id="clearBtn" class="danger">ğŸ—‘ æ¸…é™¤ç´€éŒ„</button>
            </div>
            <div class="status" id="statusText">
              ç‹€æ…‹ï¼š<span>å°šæœªé–‹å§‹æƒæ</span>
            </div>
          </div>

          <!-- å³å´ï¼šå ±åˆ°ç´€éŒ„ -->
          <div>
            <p class="muted" style="margin-bottom:6px;">
              æƒæçµæœç´€éŒ„ï¼ˆæœ€æ–°æœƒé¡¯ç¤ºåœ¨æœ€ä¸Šæ–¹ï¼‰ï¼š
            </p>
            <table>
              <thead>
                <tr>
                  <th>#</th>
                  <th>QRcode å…§å®¹</th>
                  <th>æƒææ™‚é–“</th>
                  <th>ç‹€æ…‹</th>
                </tr>
              </thead>
              <tbody id="logBody">
                <!-- æƒæç´€éŒ„æœƒè‡ªå‹•æ’å…¥ -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </section>

  <footer>
    Â© 2025 æ™ºå¹³è¡¡å¥åº·é›†åœ˜ WiseBalance â€” å“¡å·¥å¾Œå°å ±åˆ°ç³»çµ±ï¼ˆåƒ…ä¾›ç¾å ´å·¥ä½œäººå“¡ä½¿ç”¨ï¼‰
  </footer>

  <script>
    // ====== å ±åˆ°æƒæé‚è¼¯ ======
    const startBtn = document.getElementById("startBtn");
    const stopBtn = document.getElementById("stopBtn");
    const clearBtn = document.getElementById("clearBtn");
    const switchCamBtn = document.getElementById("switchCamBtn");
    const statusText = document.getElementById("statusText");
    const logBody = document.getElementById("logBody");
    const EventType = "qrcode";
  
    let scanner = null;              // Html5Qrcode ç‰©ä»¶
    let isScanning = false;          // æ˜¯å¦æ­£åœ¨æƒæ
    let logs = [];                   // æƒæç´€éŒ„
    let scannedSet = new Set();      // ç”¨ä¾†åˆ¤æ–·æ˜¯å¦é‡è¤‡æƒæ
  
    let cameras = [];                // å¯ç”¨é¡é ­åˆ—è¡¨
    let currentCameraIndex = 0;      // ç›®å‰ä½¿ç”¨çš„é¡é ­ index
  
    let isProcessingScan = false;    // é¿å…åŒä¸€å¼µ QR è¢«é‡è¤‡è§¸ç™¼å ±åˆ°æµç¨‹
  
    const CHECKIN_API = "https://23700999.com:8081/HMA/000TTELOG_EVENT.jsp";
  
    const scanConfig = {
      fps: 10,
      aspectRatio: 1.0,
      qrbox: { width: 320, height: 320 } // æ­£æ–¹å½¢æƒææ¡†
    };
  
    function initScanner() {
      if (scanner) return;
      scanner = new Html5Qrcode("reader", false);
    }
  
    function nowString() {
      const d = new Date();
      const pad = (n) => n.toString().padStart(2, "0");
      const yyyy = d.getFullYear();
      const mm = pad(d.getMonth() + 1);
      const dd = pad(d.getDate());
      const hh = pad(d.getHours());
      const mi = pad(d.getMinutes());
      const ss = pad(d.getSeconds());
      return `${yyyy}-${mm}-${dd} ${hh}:${mi}:${ss}`;
    }
  
    function cameraFacingText() {
      if (!cameras.length) return "";
      const label = (cameras[currentCameraIndex].label || "").toLowerCase();
      if (label.includes("back") || label.includes("environment")) return "å¾Œé¡é ­";
      if (label.includes("front") || label.includes("user")) return "å‰é¡é ­";
      return `é¡é ­ ${currentCameraIndex + 1}`;
    }
  
    function updateStatus(prefix = "æ­£åœ¨æƒæä¸­") {
      const facing = cameraFacingText();
      statusText.innerHTML =
        `ç‹€æ…‹ï¼š<span class="ok">${prefix}ï¼ˆ${facing}ï¼‰â€¦</span>`;
    }
  
    function renderLogs() {
      logBody.innerHTML = "";
      logs.forEach((item, idx) => {
        const tr = document.createElement("tr");
  
        const tdIndex = document.createElement("td");
        tdIndex.textContent = idx + 1;
  
        const tdText = document.createElement("td");
        tdText.textContent = item.text;
  
        const tdTime = document.createElement("td");
        tdTime.textContent = item.time;
  
        const tdStatus = document.createElement("td");
        const badge = document.createElement("span");
        badge.classList.add("badge");
        if (item.duplicate) {
          badge.classList.add("dup");
          badge.textContent = "é‡è¤‡";
        } else {
          badge.textContent = "æˆåŠŸ";
        }
        tdStatus.appendChild(badge);
  
        tr.appendChild(tdIndex);
        tr.appendChild(tdText);
        tr.appendChild(tdTime);
        tr.appendChild(tdStatus);
  
        // æœ€æ–°ä¸€ç­†æ”¾æœ€ä¸Šé¢
        logBody.insertBefore(tr, logBody.firstChild);
      });
    }
  
    // è§£æ vip=11087&name=é™³å¨ç©
    function extractFields(decodedText) {
      let vip = null;
      let name = null;
  
      // 1) è‹¥ç‚º URL
      try {
        const url = new URL(decodedText);
        vip = url.searchParams.get("vip") || url.searchParams.get("VIP");
        name = url.searchParams.get("name");
      } catch (e) {
        // Not URL â†’ fallback
      }
  
      // 2) ç”¨æ­£å‰‡è§£æ vip=
      if (!vip) {
        const vipMatch = decodedText.match(/vip=([^&]+)/i);
        if (vipMatch) vip = vipMatch[1];
      }
  
      // 3) ç”¨æ­£å‰‡è§£æ name=
      if (!name) {
        const nameMatch = decodedText.match(/name=([^&]+)/i);
        if (nameMatch) name = decodeURIComponent(nameMatch[1]);
      }
  
      return { vip, name };
    }
  
    async function logEvent(vip, name, Event, EventType) {
      const payload = { SafeKey: "qrt897hpmd", VIP: vip, Event, EventType };
      console.log("payload1=" + JSON.stringify(payload, null, 1));
  
      // 1) sendBeacon
      try {
        const ok = navigator.sendBeacon(
          CHECKIN_API,
          new Blob([JSON.stringify(payload)], { type: "text/plain;charset=UTF-8" })
        );
        if (ok) {
          console.info("[logEvent] sendBeacon sent");
          return true;
        }
      } catch (e) {
        console.warn("[logEvent] sendBeacon failed, fallback to fetch no-cors", e);
      }
  
      // 2) fetch no-cors
      try {
        await fetch(CHECKIN_API, {
          method: "POST",
          mode: "no-cors",
          headers: { "Content-Type": "text/plain;charset=UTF-8" },
          body: new Blob([JSON.stringify(payload)], { type: "text/plain;charset=UTF-8" }),
          keepalive: true
        });
        console.info("[logEvent] fetch(no-cors) sent (opaque response)");
        return true;
      } catch (err) {
        console.error("[logEvent] still failed:", err);
        return false;
      }
    }
  
    // ï¼ˆç›®å‰æ²’ç”¨åˆ° JSON APIï¼Œå¦‚è¦æ”¹æˆ JSON å°±èª¿é€™å€‹ï¼‰
    async function sendCheckin(vip, name, time, rawText) {
      const payload = {
        VIP: vip,
        Name: name,
        ts: time,
        qrRaw: rawText
      };
  
      const res = await fetch(CHECKIN_API, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });
  
      if (!res.ok) throw new Error("HTTP " + res.status);
      return true;
    }
  
    // æƒææˆåŠŸæ™‚
    async function onScanSuccess(decodedText, decodedResult) {
      if (isProcessingScan) return;
      isProcessingScan = true;
  
      // ğŸ”´ å…ˆåœæ­¢æƒæï¼Œé¿å…åŒä¸€å¼µ QR è¢«é€£çºŒè®€å–
      if (scanner && isScanning) {
        try {
          await scanner.stop();
        } catch (e) {
          console.warn("stop error:", e);
        }
        isScanning = false;
        startBtn.disabled = true;
        stopBtn.disabled = true;
      }
  
      const time = nowString();
      const isDup = scannedSet.has(decodedText);
  
      logs.push({
        text: decodedText,
        time,
        duplicate: isDup
      });
      if (!isDup) scannedSet.add(decodedText);
  
      renderLogs();
  
      // è§£æ vip èˆ‡ name
      const { vip, name } = extractFields(decodedText);
  
      if (!vip) {
        alert("QRCode å…§å®¹ä¸­æ‰¾ä¸åˆ° vip=xxxxï¼Œè«‹ç¢ºèªæ˜¯å¦ç‚ºæ­£ç¢ºå ±åˆ° QRcodeã€‚");
        statusText.innerHTML =
          `ç‹€æ…‹ï¼š<span class="err">æ‰¾ä¸åˆ° VIP ç·¨è™Ÿ</span>`;
        isProcessingScan = false;
        // å¤±æ•—ä¸€æ¨£å˜—è©¦é‡æ–°å•Ÿå‹•æƒæ
        restartScanAfterDialog();
        return;
      }
  
      const displayName = name || "ä¾†è³“";
  
      statusText.innerHTML =
        `ç‹€æ…‹ï¼š<span class="ok">å·²æƒæï¼šVIP=${vip}ï¼ˆ${displayName}ï¼‰ï¼Œé€å‡ºå ±åˆ°ä¸­â€¦</span>`;
  
      try {
        // ä¾ä½ ç¾åœ¨å¯¦ä½œä½¿ç”¨ logEvent
        await logEvent(vip, name, "QrcodeCheckin", EventType);
  
        // ğŸ‰ å ±åˆ°æˆåŠŸï¼Œé¡¯ç¤ºä¸­æ–‡åå­—
        alert(`å ±åˆ°æˆåŠŸï¼\n${displayName} å·²å®Œæˆå ±åˆ° âœ”`);
        statusText.innerHTML =
          `ç‹€æ…‹ï¼š<span class="ok">${displayName} å ±åˆ°æˆåŠŸï¼Œè«‹æƒæä¸‹ä¸€ä½ã€‚</span>`;
      } catch (e) {
        console.error("[checkin] error:", e);
        alert("å ±åˆ°å¤±æ•—ï¼Œè«‹å†æƒä¸€æ¬¡æˆ–æ”¹ç”¨äººå·¥ç™»è¨˜ã€‚");
        statusText.innerHTML =
          `ç‹€æ…‹ï¼š<span class="err">API å‘¼å«å¤±æ•—</span>`;
      } finally {
        isProcessingScan = false;
        // âœ… ä½¿ç”¨è€…æŒ‰ä¸‹ alert çš„ã€Œç¢ºå®šã€å¾Œï¼Œæ‰æœƒè·‘åˆ°é€™è£¡ â†’ å†é‡æ–°é–‹å§‹æƒæ
        restartScanAfterDialog();
      }
    }
  
    // æŒ‰ä¸‹ alertã€Œç¢ºå®šã€å¾Œé‡æ–°å•Ÿå‹•æƒæ
    async function restartScanAfterDialog() {
      if (!scanner) return;
      try {
        await ensureCameras();
        const cameraId = cameras[currentCameraIndex].id;
        await scanner.start(cameraId, scanConfig, onScanSuccess, onScanFailure);
  
        isScanning = true;
        startBtn.disabled = true;               // å·²åœ¨æƒæä¸­ï¼Œä¸éœ€è¦å†æŒ‰
        stopBtn.disabled = false;
        switchCamBtn.disabled = cameras.length < 2;
        updateStatus("æ­£åœ¨æƒæä¸­");
      } catch (e) {
        console.error("[restartScanAfterDialog] error:", e);
        statusText.innerHTML =
          `ç‹€æ…‹ï¼š<span class="err">é‡æ–°å•Ÿå‹•æƒæå¤±æ•—ï¼Œè«‹æŒ‰ã€Œé–‹å§‹æƒæã€å†è©¦ä¸€æ¬¡ã€‚</span>`;
        // è®“ä½¿ç”¨è€…å¯ä»¥æ‰‹å‹•é‡æ–°æŒ‰é–‹å§‹
        startBtn.disabled = false;
        stopBtn.disabled = true;
      }
    }
  
    function onScanFailure(error) {
      // ç‚ºé¿å…æ´—ç‰ˆï¼Œä¸åœ¨é€™è£¡è¼¸å‡º console
    }
  
    async function ensureCameras() {
      if (cameras.length) return;
      cameras = await Html5Qrcode.getCameras();
      if (!cameras || cameras.length === 0) {
        throw new Error("æ‰¾ä¸åˆ°ç›¸æ©Ÿ");
      }
  
      // å„ªå…ˆæ‰¾ã€Œå¾Œé¡é ­ã€
      let backIndex = cameras.findIndex(c =>
        (c.label || "").toLowerCase().includes("back") ||
        (c.label || "").toLowerCase().includes("environment")
      );
      if (backIndex === -1) backIndex = 0;
      currentCameraIndex = backIndex;
  
      // å¦‚æœæœ‰å…©é¡†ä»¥ä¸Šé¡é ­ï¼Œæ‰é–‹æ”¾åˆ‡æ›æŒ‰éˆ•
      switchCamBtn.disabled = cameras.length < 2;
    }
  
    async function startScan() {
      if (isScanning) return;
      initScanner();
  
      try {
        await ensureCameras();
  
        const cameraId = cameras[currentCameraIndex].id;
        await scanner.start(cameraId, scanConfig, onScanSuccess, onScanFailure);
  
        isScanning = true;
        startBtn.disabled = true;
        stopBtn.disabled = false;
        switchCamBtn.disabled = cameras.length < 2;
        updateStatus("æ­£åœ¨æƒæä¸­");
      } catch (e) {
        console.error(e);
        statusText.innerHTML =
          `ç‹€æ…‹ï¼š<span class="err">å•Ÿå‹•ç›¸æ©Ÿå¤±æ•—ï¼Œè«‹ç¢ºèªç›¸æ©Ÿæ¬Šé™èˆ‡ HTTPS</span>`;
      }
    }
  
    async function stopScan() {
      if (!isScanning || !scanner) return;
      try {
        await scanner.stop();
        isScanning = false;
        startBtn.disabled = false;
        stopBtn.disabled = true;
        statusText.innerHTML = `ç‹€æ…‹ï¼š<span>å·²æš«åœæƒæ</span>`;
      } catch (e) {
        console.error(e);
        statusText.innerHTML =
          `ç‹€æ…‹ï¼š<span class="err">åœæ­¢æƒææ™‚ç™¼ç”ŸéŒ¯èª¤</span>`;
      }
    }
  
    async function switchCamera() {
      if (!scanner || !cameras.length) return;
      if (!isScanning) {
        statusText.innerHTML =
          `ç‹€æ…‹ï¼š<span class="err">è«‹å…ˆæŒ‰ã€Œé–‹å§‹æƒæã€ï¼Œå†åˆ‡æ›é¡é ­</span>`;
        return;
      }
  
      try {
        await scanner.stop();
        isScanning = false;
  
        currentCameraIndex = (currentCameraIndex + 1) % cameras.length;
        const cameraId = cameras[currentCameraIndex].id;
  
        await scanner.start(cameraId, scanConfig, onScanSuccess, onScanFailure);
  
        isScanning = true;
        startBtn.disabled = true;
        stopBtn.disabled = false;
        switchCamBtn.disabled = cameras.length < 2;
        updateStatus("å·²åˆ‡æ›é¡é ­ï¼Œæ­£åœ¨æƒæä¸­");
      } catch (e) {
        console.error(e);
        statusText.innerHTML =
          `ç‹€æ…‹ï¼š<span class="err">åˆ‡æ›é¡é ­å¤±æ•—ï¼Œè«‹å†è©¦ä¸€æ¬¡</span>`;
      }
    }
  
    function clearLogs() {
      logs = [];
      scannedSet.clear();
      renderLogs();
      statusText.innerHTML = `ç‹€æ…‹ï¼š<span>æƒæç´€éŒ„å·²æ¸…é™¤</span>`;
    }
  
    startBtn.addEventListener("click", startScan);
    stopBtn.addEventListener("click", stopScan);
    clearBtn.addEventListener("click", clearLogs);
    switchCamBtn.addEventListener("click", switchCamera);
  
    // è‹¥æƒ³ä¸€é–‹é å°±è‡ªå‹•å•Ÿå‹•æƒæï¼Œå¯é–‹å•Ÿä¸‹è¡Œï¼š
    // window.addEventListener("load", startScan);
  </script>
  
  
  
</body>
</html>
