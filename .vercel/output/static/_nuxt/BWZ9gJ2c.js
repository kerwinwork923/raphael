import{r as v,t as P,v as R,x as s,K as I,Q as u,a9 as S}from"./D70xjexz.js";import{u as y}from"./t-MFjoUR.js";import{a as h}from"./CCb-kr4I.js";import{_ as b}from"./DNAPM-2u.js";import{_ as w}from"./DlAUqK2U.js";const x={props:{showCloseButton:{type:Boolean,default:!0}},setup(){const a=y(),e=v(""),i=()=>{a.showDSPRSelect=!1},o=async()=>{const n=["normal","prehypertension","hypertension"];if(e.value&&n.includes(e.value)){const t=JSON.parse(localStorage.getItem("userData"))||{};if(t.DSPR=e.value,!D(t)){alert("會員資料格式有誤，請修改您的資料！");return}t.Sex=="2"&&(t.Sex="0");const l={age:r(t.Birthday),bp_group:t.DSPR,bp_mode:"ternary",facing_mode:"user",height:parseInt(t.Height),sex:parseInt(t.Sex),weight:parseInt(t.Weight),time:parseInt(t.HRVCalTime)||2};try{if((await h.post("https://23700999.com:8081/HMA/API_AA5.jsp",{...t})).status===200){sessionStorage.setItem("data",JSON.stringify(l)),localStorage.setItem("userData",JSON.stringify(t)),i();const p=a.detectUID,m=a.detectFlag,c=a.detectForm;let f="/vital/scan.html";m&&(f+=`?UID=${p}&flag=${m}&form=${c}`),window.location.href=f}else alert("伺服器回應失敗，請稍後再試。")}catch(d){console.error("API 儲存失敗：",d),alert("資料儲存失敗，請稍後再試。")}}else alert("請選擇一個有效的血壓範圍！")},D=n=>{const t=l=>Number.isInteger(parseInt(l,10));return t(n.Height)&&parseInt(n.Height)>0&&t(n.Weight)&&parseInt(n.Weight)>0&&g(n.Birthday)&&(n.Sex==="1"||n.Sex==="2")},g=n=>{const t=n.split("/");return t.length===3&&parseInt(t[0])>0&&parseInt(t[1])>=1&&parseInt(t[1])<=12&&parseInt(t[2])>=1&&parseInt(t[2])<=31},r=n=>{const[t,l,d]=n.split("/").map(Number),p=new Date(t+1911,l-1,d),m=Date.now()-p.getTime(),c=new Date(m);return Math.abs(c.getUTCFullYear()-1970)};return{store:a,closeComponent:i,submitData:o,selectedDSPR:e}}},B={key:0,class:"modal"},C={class:"DSPRSelect"},U={class:"inputGroup"},V={class:"inputGroup"},H={class:"inputGroup"};function N(a,e,i,o,D,g){return o.store.showDSPRSelect?(P(),R("div",B,[e[10]||(e[10]=s("div",{class:"cover"},null,-1)),s("div",C,[i.showCloseButton?(P(),R("img",{key:0,src:b,class:"closeBtn",alt:"",onClick:e[0]||(e[0]=(...r)=>o.closeComponent&&o.closeComponent(...r))})):I("",!0),e[8]||(e[8]=s("h3",null,"請選擇您的血壓",-1)),e[9]||(e[9]=s("hr",null,null,-1)),s("div",U,[u(s("input",{type:"radio",name:"DSPR",id:"DSPR1",value:"normal","onUpdate:modelValue":e[1]||(e[1]=r=>o.selectedDSPR=r)},null,512),[[S,o.selectedDSPR]]),e[5]||(e[5]=s("label",{for:"DSPR1"},"正常(120mmHg)",-1))]),s("div",V,[u(s("input",{type:"radio",name:"DSPR",id:"DSPR2",value:"prehypertension","onUpdate:modelValue":e[2]||(e[2]=r=>o.selectedDSPR=r)},null,512),[[S,o.selectedDSPR]]),e[6]||(e[6]=s("label",{for:"DSPR2"},"高血壓前期(120~139mmHg)",-1))]),s("div",H,[u(s("input",{type:"radio",name:"DSPR",id:"DSPR3",value:"hypertension","onUpdate:modelValue":e[3]||(e[3]=r=>o.selectedDSPR=r)},null,512),[[S,o.selectedDSPR]]),e[7]||(e[7]=s("label",{for:"DSPR3"},"高血壓(>=140mmHg)",-1))]),s("div",{class:"selectSendBtn",onClick:e[4]||(e[4]=(...r)=>o.submitData&&o.submitData(...r))},"送出")])])):I("",!0)}const G=w(x,[["render",N]]);export{G as D};
