import{a as te}from"./xsH4HHeE.js";import{u as ue}from"./Bf7E4ooc.js";import{_ as ye}from"./DNAPM-2u.js";import{_ as W}from"./DlAUqK2U.js";import{v as w,x as h,H as U,y as r,z as O,C as ve,N as ae,r as p,o as de,A as pe,B as Ne,O as oe,W as $e,g as He,L as ie,I as Ie,T as ge,M as De,j as L,J as z}from"./HfdH-K36.js";import{_ as he}from"./W3k4iq7y.js";import{_ as be}from"./B0rTVoH9.js";import{_ as Ve}from"./fh2N3Yhm.js";import{s as Re}from"./x_rD_Ya3.js";const Me={props:{showCloseButton:{type:Boolean,default:!0}},setup(){const _=ue(),m=async($,s)=>{try{return(await te.post($,s)).data}catch(T){throw console.error("API Request Error:",T),T}},b=localStorage.getItem("userData"),{MID:u,Token:d,MAID:i,Mobile:c}=b?JSON.parse(b):{},f=()=>{_.showHRVForUseAlert=!1},a=$=>{const[s,T,l]=$.split("/").map(Number);return new Date().getFullYear()-(1911+s)},g=async $=>{if($==="abandon"){await N(),f(),location.reload();return}const s=JSON.parse(localStorage.getItem("userData"));if(!s){alert("å°šæœªç™»å…¥ã€‚"),f();return}const T=E=>Number.isInteger(parseInt(E,10));if(!T(s.Height)||parseInt(s.Height)<=0){alert("æ‚¨çš„èº«é«˜æ ¼å¼ä¸æ­£ç¢ºï¼Œè«‹ä¿®æ”¹æœƒå“¡è³‡æ–™"),window.location.href="/changeMember";return}if(!T(s.Weight)||parseInt(s.Weight)<=0){alert("æ‚¨çš„é«”é‡æ ¼å¼ä¸æ­£ç¢ºï¼Œè«‹ä¿®æ”¹æœƒå“¡è³‡æ–™"),window.location.href="/changeMember";return}const l=s.Birthday.split("/");if(l.length!==3||parseInt(l[0])<=0||parseInt(l[1])<1||parseInt(l[1])>12||parseInt(l[2])<1||parseInt(l[2])>31||isNaN(a(s.Birthday))){alert("ç”Ÿæ—¥æ ¼å¼ä¸æ­£ç¢ºæˆ–åŒ…å«ç„¡æ•ˆæ—¥æœŸï¼Œè«‹ä¿®æ”¹æœƒå“¡è³‡æ–™ã€‚"),window.location.href="/changeMember";return}let I=parseInt(s.Sex);if(I!==1&&I!==2&&I!==0){alert("æ€§åˆ¥æ ¼å¼ä¸æ­£ç¢ºï¼Œè«‹ä¿®æ”¹æœƒå“¡è³‡æ–™ã€‚"),window.location.href="/changeMember";return}if(I===2&&(I=0),!["normal","prehypertension","hypertension"].includes(s.DSPR)){_.showDSPRSelect=!0,f();return}const D={age:a(s.Birthday),bp_group:s.DSPR,bp_mode:"ternary",facing_mode:"user",height:parseInt(s.Height),sex:I,weight:parseInt(s.Weight),time:parseInt(s.HRVCalTime)||2};sessionStorage.setItem("data",JSON.stringify(D));const y=_.detectUID,V=_.detectFlag,M=_.detectForm;let A="/HRV";V&&(A+=`?UID=${y}&flag=${V}&form=${M}`),window.location.href=A},N=async()=>{if(!confirm("ç¢ºå®šè¦æ”¾æ£„æª¢æ¸¬å—ï¼Ÿ"))return;let s="N",T="N";_.detectFlag==="1"?s="Y":_.detectFlag==="2"&&(T="Y");try{const l={MID:u,Token:d,MAID:i,Mobile:c,UID:_.detectUID,BeforeHRVAbandon:s,AfterHRVAbandon:T},I=await m("https://23700999.com:8081/HMA/API_Use_Set_Abandon.jsp",l);console.log("âœ… æ”¾æ£„æˆåŠŸ",I)}catch(l){console.error("âŒ æ”¾æ£„å¤±æ•—ï¼š",l)}};return{store:_,handleCloseHRVAlert:f,convertAndSaveUserData:g}}},Pe={key:0,class:"cover"},Ee={key:1,class:"HRVAlert"},ke={class:"HRVAlertForUseBtnGroup"};function Fe(_,m,b,u,d,i){return h(),w(ae,null,[u.store.showHRVForUseAlert?(h(),w("div",Pe)):U("",!0),u.store.showHRVForUseAlert?(h(),w("div",Ee,[_.showHRVForUseAlert?(h(),w("img",{key:0,class:"HRVAlertClose",onClick:m[0]||(m[0]=(...c)=>u.handleCloseHRVAlert&&u.handleCloseHRVAlert(...c)),src:ye,alt:"close"})):U("",!0),r("h3",null,O(u.store.HRVAlertTitle),1),m[3]||(m[3]=r("div",{class:"disclaimer"}," æ•¸æ“šåƒ…ä¾›å¥åº·åƒè€ƒï¼Œç„¡é†«ç™‚è¨ºæ–·æ•ˆåŠ›ï¼Œè«‹å‹¿è‡ªè¡Œè§£è®€æˆ–èª¿è—¥ï¼Œæ‡‰è«®è©¢é†«å¸« ",-1)),m[4]||(m[4]=r("ul",null,[r("li",null," æ™ºå¹³è¡¡AIç©¿æˆ´ç´€éŒ„ç³»çµ±é€ééæ¥è§¸å¼äººè‡‰HRVé‡æ¸¬ï¼ˆrPPGï¼‰ï¼Œæ¨ä¼°ä½¿ç”¨è€…è‡ªå¾‹ç¥ç¶“ã€ç–²å‹ã€è¡€ç®¡å£“åŠ›èˆ‡å¿ƒæƒ…ç·Šç¹ƒç‹€æ…‹ï¼Œä¸¦æä¾›å³æ™‚å€‹äººåŒ–å¥åº·å»ºè­°ã€‚ "),r("li",null," ç³»çµ±åŒæ­¥ç´€éŒ„ä¿å¥è¡£ç©¿æˆ´æ™‚é–“èˆ‡é »ç‡ï¼Œå”åŠ©é†«å¸«æŒæ¡èº«é«”è®ŠåŒ–ï¼Œå„ªåŒ–åˆºæ¿€é»é…ç½®ã€‚æ‰€è’é›†æ•¸æ“šäº¦å°‡ç”¨æ–¼AIæ¨¡å‹æŒçºŒå„ªåŒ–ï¼Œä½¿ç³»çµ±æ›´ç²¾æº–ã€‚ "),r("li",null,[ve(" æ¸¬é‡åƒ…éœ€"),r("span",{class:"point"},"20ç§’"),ve("ï¼Œè«‹ä¿æŒç©©å®šã€å®‰éœã€å…¨ç¨‹è‡‰éƒ¨å…¥é¡ã€‚ ")])],-1)),r("div",ke,[r("button",{class:"HRVAlertBtn HRVAlertBtnAbandon",onClick:m[1]||(m[1]=c=>u.convertAndSaveUserData("abandon"))}," æ”¾æ£„æª¢æ¸¬ "),r("button",{class:"HRVAlertBtn",onClick:m[2]||(m[2]=c=>u.convertAndSaveUserData("confirm"))}," å‰å¾€æª¢æ¸¬ ")])])):U("",!0)],64)}const Dt=W(Me,[["render",Fe],["__scopeId","data-v-782ee044"]]),Be=""+new URL("hrvBefore.fqQc3z7K.png",import.meta.url).href,Ce=""+new URL("hrvAfter.CyOPneNf.png",import.meta.url).href,xe={key:0},Oe={class:"chooseHRVUseMethod"},Ge={class:"hrvMethodGroup"},Ye={__name:"ChooseHRVUseMethod",emits:["selectHRVMethod"],setup(_,{emit:m}){const b=m,u=p(!0),d=()=>{const c=document.querySelectorAll(".chooseHRVUseMethod img");let f=0;c.forEach(a=>{a.complete?f++:(a.onload=()=>{f++,f===c.length&&setTimeout(()=>{u.value=!1},300)},a.onerror=()=>{console.warn(`åœ–ç‰‡è¼‰å…¥å¤±æ•—: ${a.src}`),f++,f===c.length&&setTimeout(()=>{u.value=!1},300)})}),f===c.length&&setTimeout(()=>{u.value=!1},300)};de(()=>{d()});const i=c=>{b("selectHRVMethod",c)};return(c,f)=>(h(),w(ae,null,[f[5]||(f[5]=r("div",{class:"cover"},null,-1)),pe($e,{name:"fade"},{default:Ne(()=>[u.value?U("",!0):(h(),w("div",xe,[u.value?(h(),oe(he,{key:0})):U("",!0),r("div",Oe,[f[4]||(f[4]=r("h6",null,"è«‹é¸æ“‡",-1)),r("div",Ge,[r("div",{class:"hrvMethod",onClick:f[0]||(f[0]=a=>i("before"))},f[2]||(f[2]=[r("img",{src:Be,alt:""},null,-1),r("h3",null,"ç©¿è¡£å‰æª¢æ¸¬",-1)])),r("div",{class:"hrvMethod",onClick:f[1]||(f[1]=a=>i("after"))},f[3]||(f[3]=[r("img",{src:Ce,alt:""},null,-1),r("h3",null,"ç©¿è¡£å¾Œæª¢æ¸¬",-1),r("small",null,"è£œæ¸¬",-1)]))])])]))]),_:1})],64))}},je=W(Ye,[["__scopeId","data-v-624c7fa7"]]),Le={class:"timeHRVUseAlert"},Je={class:"HRVUseDateGroup"},qe={key:0},Ke={key:0,class:"timeHRVUseAlertSubHint"},ze={__name:"TimeHRVUseAlert",emits:["update:startTime","update:localDate","submit"],setup(_,{emit:m}){const b=m,u=p(""),d=p(""),i=p(""),c=p(!1),f=p(!1),a=()=>{b("update:localDate",u.value)},g=p(null),N=()=>{g.value&&g.value.showPicker()},$=()=>{if(!d.value){i.value="";return}const[T,l]=d.value.split(":").map(Number),I=new Date;I.setHours(T,l,0),I.setHours(I.getHours());const P=String(I.getHours()).padStart(2,"0"),D=String(I.getMinutes()).padStart(2,"0");i.value=`${P}:${D}`,b("update:startTime",d.value)},s=()=>{if(!u.value||!d.value){alert("è«‹å¡«å¯«å®Œæ•´æ—¥æœŸèˆ‡æ™‚é–“ï¼");return}const T=new Date,[l,I]=d.value.split(":").map(Number),P=new Date(u.value);if(P.setHours(l,I,0),P>T){alert("é–‹å§‹æ™‚é–“ä¸èƒ½è¶…éç•¶å‰æ™‚é–“ï¼Œè«‹é‡æ–°é¸æ“‡ï¼");return}i.value=d.value,b("submit",{date:u.value,startTime:d.value,endTime:i.value})};return(T,l)=>{const I=he,P=He("VueDatePicker");return h(),w(ae,null,[T.loading?(h(),oe(I,{key:0})):U("",!0),l[6]||(l[6]=r("div",{class:"cover"},null,-1)),r("div",Le,[l[4]||(l[4]=r("h3",null,"è«‹å¡«å¯«é–‹å§‹ç©¿è¡£çš„æ™‚é–“",-1)),l[5]||(l[5]=r("hr",null,null,-1)),r("div",Je,[r("div",{class:ie(["icon-wrapper",{"is-loading":!c.value}])},[r("img",{class:"icon1",src:be,alt:"æ—¥æœŸé¸æ“‡",onLoad:l[0]||(l[0]=D=>c.value=!0)},null,32)],2),pe(P,{modelValue:u.value,"onUpdate:modelValue":[l[1]||(l[1]=D=>u.value=D),a],"model-type":"format",format:"yyyy/MM/dd",locale:"zh-TW","enable-time-picker":!1,"cancel-text":"å–æ¶ˆ","select-text":"ç¢ºå®š","max-date":new Date,placeholder:"å¹´/æœˆ/æ—¥",teleport:"body","no-today":"","hide-input-icon":""},null,8,["modelValue","max-date"])]),r("div",{class:"HRVUseTimeGroup",onClick:N},[r("div",{class:ie(["icon-wrapper",{"is-loading":!f.value}])},[r("img",{class:"icon1",src:Ve,alt:"æ™‚é–“é¸æ“‡",onLoad:l[2]||(l[2]=D=>f.value=!0)},null,32)],2),d.value?U("",!0):(h(),w("span",qe,"è«‹é¸æ“‡é–‹å§‹ç©¿è¡£çš„æ™‚é–“")),r("span",{class:ie({selected:d.value})},O(d.value?d.value:""),3),Ie(r("input",{ref_key:"timeInput",ref:g,"onUpdate:modelValue":l[3]||(l[3]=D=>d.value=D),type:"time",onInput:$},null,544),[[ge,d.value]])]),r("button",{onClick:s},"é€å‡º"),u.value&&i.value?(h(),w("h6",Ke," â€» æ‚¨é¸æ“‡çš„é–‹å§‹æ™‚é–“ï¼š"+O(u.value)+" "+O(i.value),1)):U("",!0)])],64)}}},We=W(ze,[["__scopeId","data-v-f10eec0c"]]),Qe={class:"progress-container"},Xe={class:"content"},Ze={class:"timerButtonGroup"},et={key:0,class:"expired-options"},tt={key:0,class:"TimeRingForgetBox"},ot={__name:"TimeRing2",props:{productName:{type:String},hasDetectRecord:{type:Boolean},hasDetectTime:{type:String,default:"00:00:00"}},setup(_){const m=_,b=De(),u=p(!1),d=p(!1),i=p(0),c=p(null),f=p(!1),a={BEFORE:"before",RUNNING:"running",AFTER:"after"},g=p(a.BEFORE),N=L(()=>{switch(g.value){case a.BEFORE:return"é–‹å§‹ç´€éŒ„";case a.RUNNING:return"çµæŸç´€éŒ„";case a.AFTER:return"HRVæª¢æ¸¬(ä½¿ç”¨å¾Œ)";default:return"æœªçŸ¥ç‹€æ…‹"}}),$=L(()=>{if(i.value<=0&&ee.value)return ee.value;const e=Math.floor(i.value/3600),o=Math.floor(i.value%3600/60),n=i.value%60;return`${String(e).padStart(2,"0")}:${String(o).padStart(2,"0")}:${String(n).padStart(2,"0")}`}),s=p(null),T=p(null),l=ue(),I=p(null),P=p(!1),D=p(null),y=p(!1),V=L(()=>{switch(g.value){case a.BEFORE:return{backgroundColor:"#74BC1F",color:"#fff"};case a.RUNNING:return{backgroundColor:"#1FBCB3",color:"#fff"};case a.AFTER:return{backgroundColor:"#74BC1F",color:"#fff"};default:return{backgroundColor:"#E0E0E0",color:"#000"}}}),M=localStorage.getItem("userData"),{MID:A,Token:E,MAID:k,Mobile:F}=M?JSON.parse(M):{};(!A||!E||!k||!F)&&b.push("/");const B=p(null),Y=()=>{if(B.value){console.log("â³ è¨ˆæ™‚å™¨å·²ç¶“å•Ÿå‹•ï¼Œä¸é‡è¤‡å•Ÿå‹•");return}if(!c.value){console.warn("âš ï¸ startTimestamp ç‚ºç©ºï¼Œç„¡æ³•å•Ÿå‹•è¨ˆæ™‚å™¨");return}console.log("ğŸš€ è¨ˆæ™‚é–‹å§‹ï¼ŒstartTimestamp =",new Date(c.value).toLocaleString()),g.value!==a.RUNNING&&(console.log("ğŸ”„ ä¿®æ­£ currentDetectionState ç‚º RUNNING"),g.value=a.RUNNING),B.value=Re(()=>{const e=Date.now();i.value=Math.floor((e-c.value)/1e3),console.log("â³ è¨ˆæ™‚ä¸­ï¼Œå·²éæ™‚é–“ï¼š",i.value,"ç§’")},1e3)},q=async e=>{console.log("â¹ åœæ­¢è¨ˆæ™‚å™¨ï¼Œæº–å‚™æª¢æŸ¥æ˜¯å¦å¯ä»¥çµæŸ"),B.value&&(clearInterval(B.value),B.value=null),f.value=!1;const o=await v("1",s.value);if(console.log("ğŸ” ä½¿ç”¨å‰æª¢æ¸¬å®Œæˆç‹€æ…‹:",o),o==="N"){alert("å°šæœªå®Œæˆä½¿ç”¨å‰æª¢æ¸¬ï¼Œç„¡æ³•çµæŸï¼"),g.value=a.RUNNING,console.log("âš ï¸ ä¿æŒ `RUNNING` ç‹€æ…‹ï¼Œè¨ˆæ™‚æ•¸å€¼ä¸è®Š:",i.value);return}console.log("âœ… ä½¿ç”¨å‰æª¢æ¸¬å·²å®Œæˆï¼Œæ›´æ–°ç‹€æ…‹ç‚º `AFTER`"),g.value=a.AFTER;try{await C(),console.log("âœ… è¨ˆæ™‚å·²çµæŸï¼ŒAPI èª¿ç”¨æˆåŠŸ"),e!=!1&&G(s.value)}catch(n){console.error("âŒ çµæŸ API èª¿ç”¨å¤±æ•—ï¼š",n)}},J=e=>{l.detectFlag="1",l.detectUID=e,l.detectForm=m.productName,l.showHRVForUseAlert=!0,l.HRVAlertTitle="(ä½¿ç”¨å‰)-HRVé‡æ¸¬"},G=e=>{l.detectFlag="2",l.detectUID=e,l.detectForm=`*${m.productName}`,l.showHRVForUseAlert=!0,l.HRVAlertTitle="(ä½¿ç”¨å¾Œ)-HRVé‡æ¸¬",console.log("ä½¿ç”¨å¾Œæª¢æ¸¬å·²å•Ÿå‹•",{UIDVal:e,productName:m.productName})},ne=async()=>{if(!u.value){u.value=!0;try{switch(g.value){case a.BEFORE:if(s.value){console.log("å·²æœ‰ UIDï¼Œå¾ API æ™‚é–“é–‹å§‹ HRV æª¢æ¸¬");const e=await Z();if(e!=null&&e.StartTime)c.value=new Date(`${e.StartTime.slice(0,4)}-${e.StartTime.slice(4,6)}-${e.StartTime.slice(6,8)}T${e.StartTime.slice(8,10)}:${e.StartTime.slice(10,12)}:${e.StartTime.slice(12)}`).getTime(),i.value=Math.floor((Date.now()-c.value)/1e3);else{c.value=Date.now(),console.warn("èˆŠçš„ UID å¯èƒ½å·²å¤±æ•ˆï¼Œå‰µå»ºæ–°çš„ UID");const o=await S();if(o!=null&&o.UID)J(o.UID);else{console.error("å‰µå»º UID å¤±æ•—");return}}Y()}else{const e=await S();e!=null&&e.UID?(y.value=!0,c.value=Date.now(),Y()):console.error("å‰µå»º UID å¤±æ•—")}break;case a.RUNNING:console.log("çµæŸ HRV æª¢æ¸¬"),await q();break;case a.AFTER:G(s.value);break;default:console.error("æœªçŸ¥æª¢æ¸¬ç‹€æ…‹")}}finally{u.value=!1}}},se=async()=>{if(!D.value){alert("è«‹é¸æ“‡çµæŸæ™‚é–“");return}const e=Q(D.value);console.log("é¸æ“‡çš„çµæŸæ™‚é–“:",e);try{await C(e),P.value=!1,I.value=!1,g.value=a.AFTER,console.log("æª¢æ¸¬å·²æ‰‹å‹•çµæŸ")}catch(o){console.error("çµæŸæª¢æ¸¬æ™‚ç™¼ç”ŸéŒ¯èª¤:",o)}},Q=e=>{const o=new Date(e),n=o.getFullYear(),R=String(o.getMonth()+1).padStart(2,"0"),H=String(o.getDate()).padStart(2,"0"),K=String(o.getHours()).padStart(2,"0"),le=String(o.getMinutes()).padStart(2,"0"),ce=String(o.getSeconds()).padStart(2,"0");return`${n}${R}${H}${K}${le}${ce}`},X=async()=>{console.log("æ­£åœ¨è™•ç†çµæŸé‚è¼¯..."),B.value&&(clearInterval(B.value),B.value=null),f.value=!1;const o=Q(new Date);try{await C(o),console.log("çµæŸ API èª¿ç”¨æˆåŠŸ"),g.value=a.AFTER,I.value=!1,G(s.value)}catch(n){console.error("çµæŸ API èª¿ç”¨å¤±æ•—:",n)}},x=async(e,o)=>{try{return(await te.post(e,o)).data}catch(n){throw n}},Z=async()=>{try{const e=await x("https://23700999.com:8081/HMA/API_MID_ProductName_UIDInfo.jsp",{MID:A,Token:E,MAID:k,Mobile:F,ProductName:m.productName});if(console.log("ğŸ“¡ API_MID_ProductName_UIDInfo å›æ‡‰:",e),(e==null?void 0:e.Result)!=="OK")return console.error("âŒ ç„¡æ³•ç²å–æœ‰æ•ˆçš„ UID è³‡è¨Šï¼š",e),null;if(e.BeforeHRVAbandon==="Y"&&console.warn("å·²æ”¾æ£„å‰æ¸¬ (BeforeHRVAbandon=Y)ã€‚"),!e.UID)return console.warn("âš ï¸ UID ç‚º nullï¼Œç„¡æ³•ç¹¼çºŒå¾ŒçºŒæ“ä½œ"),null;if(e.StartTime){const n=new Date(`${e.StartTime.slice(0,4)}-${e.StartTime.slice(4,6)}-${e.StartTime.slice(6,8)}T${e.StartTime.slice(8,10)}:${e.StartTime.slice(10,12)}:${e.StartTime.slice(12)}`).getTime();c.value=n;const R=Date.now();return i.value=Math.floor((R-n)/1e3),console.log(`â³ StartTime è¨­å®šç‚º: ${new Date(c.value).toLocaleString()}`),console.log(`â³ ç¶“éæ™‚é–“è¨ˆç®—çµæœ: ${i.value} ç§’`),e}else console.warn("âš ï¸ ç„¡æ³•è§£æ StartTimeï¼Œå¯èƒ½å¾Œç«¯æ²’æœ‰è¿”å›")}catch(e){console.error("âŒ API èª¿ç”¨å¤±æ•—ï¼š",e)}return null},t=async e=>{try{const o=await x("https://23700999.com:8081/HMA/API_UIDInfo.jsp",{MID:A,Token:E,MAID:k,Mobile:F,UID:e});if((o==null?void 0:o.Result)==="OK")return o}catch{}},v=async(e,o)=>{if(!o)return console.error("âŒ UID ç‚º nullï¼Œç„¡æ³•èª¿ç”¨ API_HRV2_UID_Flag_Info"),null;try{const n=await x("https://23700999.com:8081/HMA/API_HRV2_UID_Flag_Info.jsp",{MID:A,Token:E,MAID:k,Mobile:F,UID:o,Flag:e});if((n==null?void 0:n.Result)==="OK"){console.log("âœ… æˆåŠŸç²å– HRV2 æª¢æ¸¬è³‡æ–™ç‹€æ…‹ï¼š",n);const R=n.IsExit,H=n.IsAbandon,K=await t(o);return e==="1"&&R==="N"&&K.BeforeHRVAbandon!=="Y"&&(y.value=!0,me()),{isExit:R,isAbandon:H}}else return console.error("âŒ ç„¡æ³•ç²å– HRV2 è³‡æ–™ç‹€æ…‹ï¼š",n),null}catch(n){return console.error("âŒ API èª¿ç”¨å¤±æ•—ï¼š",n),null}},S=async()=>{try{const e=await x("https://23700999.com:8081/HMA/API_UseStart.jsp",{MID:A,Token:E,MAID:k,Mobile:F,ProductName:m.productName});return e!=null&&e.UID?(s.value=e.UID,console.log("æˆåŠŸå‰µå»ºæ–°çš„ UIDï¼š",s.value)):console.error("å‰µå»ºæ–°çš„ UID å¤±æ•—ï¼Œè«‹æª¢æŸ¥ API éŸ¿æ‡‰"),e}catch(e){return console.error("å‰µå»ºæ–°çš„ UID API èª¿ç”¨å¤±æ•—ï¼š",e),null}},C=async(e="")=>{if(!s.value){console.error("ç„¡æ³•çµæŸï¼Œå› ç‚º UID ä¸å­˜åœ¨");return}const o={MID:A,Token:E,MAID:k,Mobile:F,UID:s.value,EndTime:e||""};try{const n=await x("https://23700999.com:8081/HMA/API_UseEnd.jsp",o);console.log("çµæŸ API èª¿ç”¨æˆåŠŸ",n)}catch(n){console.error("çµæŸ API èª¿ç”¨å¤±æ•—:",n)}},j=p(!1),ee=p(null),re=e=>new Date(`${e.slice(0,4)}-${e.slice(4,6)}-${e.slice(6,8)}T${e.slice(8,10)}:${e.slice(10,12)}:${e.slice(12)}`),Te=e=>{const o=Math.floor(e/3600),n=Math.floor(e%3600/60),R=e%60;return`${String(o).padStart(2,"0")}:${String(n).padStart(2,"0")}:${String(R).padStart(2,"0")}`},_e=async()=>{try{const e=await x("https://23700999.com:8081/HMA/API_UIDInfo_Search12.jsp",{MID:A,Token:E,MAID:k,Mobile:F,ProductName:m.productName,BeforeHRVDetect:"N"});if(e&&e.Result!=="NOData"){if(e.AfterHRVAbandon==="Y")return;const o=e.CheckTime?re(e.CheckTime):null;if(o&&(new Date-o)/(1e3*60*60)>24){console.log("è¶…é 24 å°æ™‚ï¼Œä¸é€²è¡Œå¾ŒçºŒåˆ¤æ–·");return}if(s.value=e.UID,console.log("ğŸ” å–å¾— UID:",s.value),e.StartTime&&e.EndTime){const n=re(e.StartTime),R=re(e.EndTime),H=Math.floor((R-n)/1e3);ee.value=Te(H),G(s.value),console.log("ä¸Šæ¬¡æ¸¬è©¦æŒçºŒæ™‚é–“:",ee.value)}j.value=!0,console.log("âœ… å·²å®Œæˆ HRV ä½¿ç”¨å¾Œæª¢æ¸¬ï¼Œä¸å†é¡¯ç¤ºã€çµæŸã€æŒ‰éˆ•")}else console.log("âŒ æ²’æœ‰æ‰¾åˆ°å°æ‡‰çš„æ•¸æ“šï¼Œå¯èƒ½æœªé€²è¡Œæ¸¬è©¦")}catch(e){console.log("âŒ API_UIDInfo_Search12 èª¿ç”¨å¤±æ•—:",e)}},me=async e=>{if(e==="before")J(s.value);else if(e==="after"){if(!s.value){console.error("âŒ UID ä¸å­˜åœ¨ï¼Œç„¡æ³•é€²è¡ŒçµæŸé‚è¼¯");return}await q(!1),y.value=!1,d.value=!0}},Ae=async({date:e,startTime:o,endTime:n})=>{try{const R=new Date(`${e} ${o}`),H=R.getFullYear(),K=String(R.getMonth()+1).padStart(2,"0"),le=String(R.getDate()).padStart(2,"0"),ce=String(R.getHours()).padStart(2,"0"),Se=String(R.getMinutes()).padStart(2,"0"),Ue=String(R.getSeconds()).padStart(2,"0"),fe=`${H}${K}${le}${ce}${Se}${Ue}`;console.log("æ¬²è¨­å®šçš„é–‹å§‹æ™‚é–“:",fe),await we(fe),d.value=!1,G(s.value)}catch(R){console.error("æ›´æ–°é–‹å§‹æ™‚é–“å¤±æ•—ï¼š",R)}},we=async e=>{const o={MID:A,Token:E,MAID:k,Mobile:F,UID:s.value,StartTime:e};try{const{data:n}=await te.post("https://23700999.com:8081/HMA/API_UIDStartEndTime.jsp",o);if((n==null?void 0:n.Result)==="OK")console.log("é–‹å§‹æ™‚é–“æ›´æ–°æˆåŠŸï¼š",n);else throw new Error(JSON.stringify(n))}catch(n){throw console.error("API_UIDStartEndTime å‘¼å«å¤±æ•—",n),n}};return de(async()=>{T.value=null,console.log("ğŸ” onMounted å•Ÿå‹•ï¼Œé–‹å§‹åˆå§‹åŒ– HRV ç‹€æ…‹...");try{const e=await Z();if(e){s.value=e.UID,e.BeforeHRVAbandon==="Y"?console.warn("å·²æ”¾æ£„å‰æ¸¬ (BeforeHRVAbandon=Y)ã€‚"):e.AfterHRVAbandon==="Y"&&console.warn("å·²æ”¾æ£„å¾Œæ¸¬ (AfterHRVAbandon=Y)ã€‚"),console.log("âœ… æˆåŠŸç²å–æœ‰æ•ˆçš„ UIDï¼š",s.value);const o=await v("1",s.value);if(console.log("ğŸ” HRV å‰æ¸¬ç´€éŒ„:",o),o==="Y"?(console.log("âœ… HRV å‰æ¸¬å·²å®Œæˆï¼Œé€²å…¥ RUNNING ç‹€æ…‹"),g.value=a.RUNNING,Y()):(console.log("âš ï¸ HRV å‰æ¸¬æœªå®Œæˆï¼Œå›åˆ° BEFORE ç‹€æ…‹"),g.value=a.BEFORE),e.StartTime){console.log("â³ ç²å– StartTimeï¼Œæ¢å¾©è¨ˆæ™‚..."),c.value=new Date(`${e.StartTime.slice(0,4)}-${e.StartTime.slice(4,6)}-${e.StartTime.slice(6,8)}T${e.StartTime.slice(8,10)}:${e.StartTime.slice(10,12)}:${e.StartTime.slice(12)}`).getTime();const n=Date.now();i.value=Math.floor((n-c.value)/1e3),console.log(`â³ StartTime è¨­å®šç‚º: ${new Date(c.value).toLocaleString()}`),console.log(`â³ è¨ˆæ™‚å™¨æ¢å¾©ï¼Œå·²éæ™‚é–“: ${i.value} ç§’`),i.value>0&&(console.log("ğŸ”„ è‡ªå‹•åˆ‡æ›è‡³ RUNNING ç‹€æ…‹"),g.value=a.RUNNING,Y())}else console.warn("âš ï¸ StartTime ä¸å­˜åœ¨ï¼Œè¨ˆæ™‚å™¨å°‡å¾ 0 é–‹å§‹")}else{console.warn("âŒ ç„¡æ³•ç²å–ä½¿ç”¨è€…è³‡æ–™ï¼Œæª¢æŸ¥ API_ UIDInfo_Search12()");const o=await _e();if(o&&o.StartTime){console.log("â³ API_UIDInfo_Search12() å–å¾— StartTimeï¼Œæ¢å¾©è¨ˆæ™‚..."),c.value=new Date(`${o.StartTime.slice(0,4)}-${o.StartTime.slice(4,6)}-${o.StartTime.slice(6,8)}T${o.StartTime.slice(8,10)}:${o.StartTime.slice(10,12)}:${o.StartTime.slice(12)}`).getTime();const n=Date.now();i.value=Math.floor((n-c.value)/1e3),console.log(`â³ StartTime è¨­å®šç‚º: ${new Date(c.value).toLocaleString()}`),console.log(`â³ è¨ˆæ™‚å™¨æ¢å¾©ï¼Œå·²éæ™‚é–“: ${i.value} ç§’`),i.value>0&&(console.log("ğŸ”„ è‡ªå‹•åˆ‡æ›è‡³ RUNNING ç‹€æ…‹"),g.value=a.RUNNING,Y())}else console.warn("âŒ ç„¡æ³•å–å¾—æœ‰æ•ˆçš„æ™‚é–“è³‡è¨Šï¼Œå°‡ä¸ä½¿ç”¨é è¨­æ™‚é–“"),i.value=0}}catch(e){console.error("âŒ åˆå§‹åŒ–å¤±æ•—ï¼š",e)}}),(e,o)=>{const n=je,R=We;return h(),w(ae,null,[y.value?(h(),oe(n,{key:0,onSelectHRVMethod:me})):U("",!0),d.value?(h(),oe(R,{key:1,startTime:e.selectedTime,"onUpdate:startTime":o[0]||(o[0]=H=>e.selectedTime=H),localDate:e.selectedDate,"onUpdate:localDate":o[1]||(o[1]=H=>e.selectedDate=H),onSubmit:Ae},null,8,["startTime","localDate"])):U("",!0),r("div",Qe,[r("div",{class:"progress-border",style:z({background:e.progressGradient})},[r("div",Xe,O($.value),1)],4),r("div",Ze,[I.value?(h(),w("div",et,[r("button",{style:{"background-color":"#74bc1f"},onClick:o[2]||(o[2]=H=>G(s.value))}," HRVæª¢æ¸¬(ä½¿ç”¨å¾Œ) "),j.value?U("",!0):(h(),w("button",{key:0,style:{"background-color":"#1fbcb3"},onClick:X}," çµæŸ "))])):(h(),w("button",{key:1,style:z(V.value),onClick:ne},O(N.value),5))]),P.value?(h(),w("div",tt,[o[4]||(o[4]=r("label",null,"é¸æ“‡çµæŸæ™‚é–“:",-1)),Ie(r("input",{type:"datetime-local","onUpdate:modelValue":o[3]||(o[3]=H=>D.value=H)},null,512),[[ge,D.value]]),r("button",{onClick:se},"ç¢ºèª")])):U("",!0)])],64)}}},ht=W(ot,[["__scopeId","data-v-67a4c370"]]),at={class:"progress-container"},nt={class:"content"},st={key:0,class:"completion-message"},rt={key:1,class:"flex"},lt=["disabled"],ct={__name:"TimeRing",props:{totalTime:{type:Number,default:3600},productName:{type:String,default:""},hasTodayRecord:{type:String,default:3e3}},setup(_){const m=_,b=De(),u=ue(),d={BEFORE:"before",RUNNING:"running",AFTER:"after"},i=p(d.BEFORE),c=p(m.totalTime*1e3),f=p(!1),a=p(""),g=p(!1);let N=null,$=0;const s=L(()=>{switch(i.value){case d.BEFORE:return"é–‹å§‹ç´€éŒ„";case d.RUNNING:return"é‡æ–°ç´€éŒ„";case d.AFTER:return"çµæŸç´€éŒ„";default:return"æœªçŸ¥ç‹€æ…‹"}}),T=L(()=>{switch(i.value){case d.BEFORE:case d.RUNNING:case d.AFTER:return{backgroundColor:"#74BC1F",color:"#fff"};default:return{backgroundColor:"#E0E0E0",color:"#000"}}}),l=L(()=>{const t=m.totalTime*1e3-c.value,v=Math.min(t/(m.totalTime*1e3)*100,100);return{background:`conic-gradient(#74BC1F 0% ${v}%, #ffffff ${v}% 100%)`,transition:"background 0.1s linear"}}),I=L(()=>{const t=Math.floor(c.value/1e3),v=Math.floor(t/3600),S=Math.floor(t%3600/60),C=t%60;return`${String(v).padStart(2,"0")}:${String(S).padStart(2,"0")}:${String(C).padStart(2,"0")}`}),P=JSON.parse(localStorage.getItem("userData")||"{}"),{MID:D="",Token:y="",MAID:V="",Mobile:M=""}=P;(!D||!y||!V||!M)&&(console.error("ç”¨æˆ¶è³‡æ–™ä¸å®Œæ•´ï¼Œè·³å›ç™»å…¥"),b.push("/"));async function A(t,v){try{const{data:S}=await te.post(t,v);return S}catch(S){return console.error(`[APIå¤±æ•—] ${t}`,S),null}}async function E(){const t=await A("https://23700999.com:8081/HMA/API_UseStart.jsp",{MID:D,Token:y,MAID:V,Mobile:M,ProductName:m.productName});return!t||!t.UID?(console.warn("useStartAPI => ç„¡æ³•å»ºç«‹ UID"),null):t}async function k(){a.value&&await A("https://23700999.com:8081/HMA/API_UseEnd.jsp",{MID:D,Token:y,MAID:V,Mobile:M,UID:a.value})}async function F(){a.value&&await A("https://23700999.com:8081/HMA/API_DeleteStart.jsp",{MID:D,Token:y,MAID:V,Mobile:M,UID:a.value,ProductName:m.productName})}async function B(t,v){if(!v)return null;const S=await A("https://23700999.com:8081/HMA/API_HRV2_UID_Flag_Info.jsp",{MID:D,Token:y,MAID:V,Mobile:M,UID:v,Flag:t});if(S){const C=S.IsExit,j=await G(v);C==="N"&&j.BeforeHRVAbandon!=="Y"&&q(v)}return S==null?void 0:S.IsExit}async function Y(){return A("https://23700999.com:8081/HMA/API_MID_ProductName_UIDInfo.jsp",{MID:D,Token:y,MAID:V,Mobile:M,ProductName:m.productName})}function q(t){u.detectFlag="1",u.detectUID=t,u.detectForm=m.productName,u.showHRVForUseAlert=!0,u.HRVAlertTitle="(ä½¿ç”¨å‰)-HRVé‡æ¸¬",console.log("å·²å‘¼å« 'ä½¿ç”¨å‰æª¢æ¸¬' => UID:",t)}function J(t){u.detectFlag="2",u.detectUID=t,u.detectForm=`*${m.productName}`,u.showHRVForUseAlert=!0,u.HRVAlertTitle="(ä½¿ç”¨å¾Œ)-HRVé‡æ¸¬",console.log("å·²å‘¼å« 'ä½¿ç”¨å¾Œæª¢æ¸¬' => UID:",t)}const G=async t=>{try{const v=await A("https://23700999.com:8081/HMA/API_UIDInfo.jsp",{MID:D,Token:y,MAID:V,Mobile:M,UID:t});if((v==null?void 0:v.Result)==="OK")return v}catch{}};function ne(){console.log("é–‹å§‹å€’æ•¸ => å‰©é¤˜ç§’æ•¸:",c.value/1e3),f.value=!0,$=Date.now(),N&&clearInterval(N),N=Re(async()=>{const t=Date.now(),v=t-$;$=t,c.value=Math.max(c.value-v,0),c.value<=0&&(clearInterval(N),N=null,f.value=!1,await k(),J(a.value))},1e3)}const se=t=>new Date(`${t.slice(0,4)}-${t.slice(4,6)}-${t.slice(6,8)}T${t.slice(8,10)}:${t.slice(10,12)}:${t.slice(12)}`),Q=async()=>{try{const t=await A("https://23700999.com:8081/HMA/API_UIDInfo_Search12.jsp",{MID:D,Token:y,MAID:V,Mobile:M,ProductName:m.productName,BeforeHRVDetect:"N"});if(t&&t.Result!=="NOData"){if(t.AfterHRVAbandon==="Y")return;const v=t.CheckTime?se(t.CheckTime):null;if(v&&(new Date-v)/(1e3*60*60)>24){console.log("è¶…é 24 å°æ™‚ï¼Œä¸é€²è¡Œå¾ŒçºŒåˆ¤æ–·");return}a.value=t.UID,console.log("ğŸ” å–å¾— UID:",a.value),c.value=0,J(a.value)}else console.log("âŒ æ²’æœ‰æ‰¾åˆ°å°æ‡‰çš„æ•¸æ“šï¼Œå¯èƒ½æœªé€²è¡Œæ¸¬è©¦")}catch(t){console.log("âŒ API_UIDInfo_Search12 èª¿ç”¨å¤±æ•—:",t)}};async function X(){if(!g.value){g.value=!0;try{switch(console.log("æŒ‰éˆ•é»æ“Š => ç‹€æ…‹:",i.value),i.value){case d.BEFORE:{if(!a.value){const t=await E();if(t!=null&&t.UID)a.value=t.UID;else{console.error("ç„¡æ³•å»ºç«‹ UIDï¼Œç„¡æ³•ç¹¼çºŒ");return}}q(a.value);break}case d.RUNNING:{confirm("ç¢ºå®šè¦é‡æ–°æª¢æ¸¬å—ï¼Ÿé€™æœƒæ¸…é™¤æœ¬æ¬¡å€’æ•¸è¨˜éŒ„ã€‚")&&(await F(),x());break}case d.AFTER:{J(a.value);break}default:console.warn("æœªçŸ¥ç‹€æ…‹:",i.value)}}finally{g.value=!1}}}function x(){N&&(clearInterval(N),N=null),i.value=d.BEFORE,c.value=m.totalTime*1e3,f.value=!1,a.value="",console.log("å·²é‡ç½® => å›åˆ° BEFORE ç‹€æ…‹")}de(async()=>{try{const t=await Y();if(t!=null&&t.UID){a.value=t.UID;const v=await B("1",a.value);if(console.log("ğŸ” HRV å‰æ¸¬ç´€éŒ„:",v),t.StartTime){const S=Z(t.StartTime),C=Date.now()-S.getTime(),j=m.totalTime*1e3-C;j>0?(c.value=j,i.value=d.RUNNING,ne()):(await k(),x())}}else await Q()}catch(t){console.error("onMounted åˆå§‹åŒ–å¤±æ•—:",t)}});function Z(t){return!t||t.length<14?new Date:new Date(`${t.slice(0,4)}-${t.slice(4,6)}-${t.slice(6,8)}T${t.slice(8,10)}:${t.slice(10,12)}:${t.slice(12,14)}`)}return(t,v)=>(h(),w("div",at,[r("div",{class:"progress-border",style:z(l.value)},[r("div",nt,O(I.value),1)],4),_.hasTodayRecord?(h(),w("div",st,"æ„Ÿè¬æ‚¨çš„ä½¿ç”¨")):U("",!0),_.hasTodayRecord?U("",!0):(h(),w("div",rt,[i.value===d.BEFORE?(h(),w("button",{key:0,style:z(T.value),onClick:X,disabled:g.value},O(s.value),13,lt)):U("",!0),i.value===d.AFTER?(h(),w("button",{key:1,style:z(T.value),onClick:X},O(s.value),5)):U("",!0)]))]))}},Rt=W(ct,[["__scopeId","data-v-eece2aff"]]);export{Dt as _,ht as a,Rt as b};
