import{_ as te}from"./C4EKiFTB.js";import{B as Pe,a as Ie,b as _e,I as Te,_ as oe,c as ae,S as we,d as ke,u as Re}from"./DfZsC12R.js";import{J as pe,o as Ne,r as I,i as r,g as p,v as b,z as _,K as G,x as l,B as W,L as X,M as Z,N as $,y as g,O as ee,t as c}from"./D70xjexz.js";import{a as L}from"./CCb-kr4I.js";import{_ as Me}from"./DlAUqK2U.js";import"./DHyqCC35.js";import"./CkGzrrY6.js";import"./VCNQH0xW.js";import"./BDSW-ypD.js";import"./B1QmaLQs.js";import"./D7B7LOx5.js";import"./C2uo4fds.js";const xe={name:"BabyRecord",components:{TitleMenu:te,BabyIntro:Pe,BabyCreateForm:Ie,BabyProgress:_e,IndicatorSelect:Te,QAList:oe,TimesSelect:ae,SolvePrioritySelect:we,BabyReportResult:ke},setup(){const T=pe(),o=Re(),K=localStorage.getItem("userData"),{MID:t,Token:B,MAID:D,Mobile:v}=K?JSON.parse(K):{};(!t||!B||!D||!v)&&T.push("/"),Ne(()=>{o.fetchGrowth()});const N=I(!1),M=I(!1),S=I(!1),y=I([{name:"",gender:"",birthDate:null}]),d=I(null),x=r(()=>o.babyAPIData.length>0),i=r(()=>{const e=o.selectedChildID;return o.childRecords[e]}),j=r(()=>{var e,a;return((a=(e=i.value)==null?void 0:e.growthRec)==null?void 0:a.ChildAnsAllType)||null}),h=r(()=>{var e;return((e=d.value)==null?void 0:e.currentPage)||1}),A=r(()=>{var e;return((e=d.value)==null?void 0:e.totalPages)||1}),Q=r(()=>{var e;return(e=d.value)==null?void 0:e.isPageFilled}),u=I(1),w=7,P=r(()=>{var e;return((e=i.value)==null?void 0:e.childTimesQues)||[]}),n=r(()=>P.value.length?Math.ceil(P.value.length/w):1),z=r(()=>(u.value-1)*w),H=r(()=>{const e=z.value,a=e+w;return P.value.slice(e,a)}),Y=r(()=>H.value.every(e=>e.selectScore!==""));function ne(){u.value>1&&u.value--}const se=r(()=>u.value<n.value?`ä¸‹ä¸€é  (${u.value}/${n.value})`:`å®Œæˆ (${u.value}/${n.value})`);async function re(){var e,a;if(!Y.value){alert("è«‹å…ˆå¡«å®Œæœ¬é æ¬¡æ•¸");return}if(u.value<n.value)u.value++;else{const s=o.selectedChildID,k=((a=(e=i.value.growthRec)==null?void 0:e.CIDChildAnsLast)==null?void 0:a.AID)||"",O={MID:t,MAID:D,Token:B,Mobile:v,CID:s,AID:k,ChildAnsTimes:i.value.childTimesQues.map(C=>({QueSeq:C.id,QueTimesAns:C.selectScore}))};try{const C=await L.post("https://23700999.com:8081/HMA/API_ChildAnsTimesSave.jsp",O);if(C.data.Result!=="OK"){alert("æ¬¡æ•¸ç­”æ¡ˆé€å‡ºå¤±æ•—ï¼š"+C.data.Message);return}const f={MID:t,MAID:D,Token:B,Mobile:v,CID:s,AID:k},R=await L.post("https://23700999.com:8081/HMA/API_GrowthSolve.jsp",f);R.data.Result==="OK"?(alert("æ¬¡æ•¸ç­”æ¡ˆå·²æˆåŠŸé€å‡ºä¸¦å–å¾—åˆ†æçµæœï¼"),Array.isArray(R.data.ChildAns)&&(o.childRecords[s].childTimesQues=R.data.ChildAns.map(m=>({id:m.QueSeq,question:m.Question,selectScore:"",answers:[m.AnswerName_0,m.AnswerName_1,m.AnswerName_2,m.AnswerName_3],Type:m.Type,TypeName:m.TypeName,selected:!1}))),i.value.flowStage="priority"):alert("å–å¾—åˆ†æçµæœå¤±æ•—ï¼š"+R.data.Message)}catch(C){console.error("é€å‡ºæˆ–å–å¾—åˆ†æç™¼ç”ŸéŒ¯èª¤",C),alert("ä¼ºæœå™¨éŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦ï¼")}}}function le(){var e;(e=d.value)==null||e.goPrevPage()}async function ie(){if(!d.value.isPageFilled){alert("è«‹å…ˆå¡«å®Œé¡Œç›®");return}d.value.currentPage<d.value.totalPages?d.value.goNextPage():await d.value.submitAllAnswers()}const ce=r(()=>h.value<A.value?`ä¸‹ä¸€é  (${h.value}/${A.value})`:`ä¸‹ä¸€æ­¥ (${h.value}/${A.value})`),de=r(()=>!Q.value),ue=r(()=>h.value>1);async function me(){o.selectedChildID&&(i.value.flowStage="times")}const be=r(()=>{var a;if(!x.value)return S.value?"é€å‡ºå¯¶è²":"å‰å¾€æª¢æ¸¬";const e=(a=i.value)==null?void 0:a.flowStage;return e==="indicator"?"å‰å¾€æª¢æ¸¬":e==="times"?"æ¬¡æ•¸å¡«å¯«ä¸­":"ä¸‹ä¸€æ­¥"}),V=r(()=>{var e;return((e=i.value)==null?void 0:e.flowStage)==="times"});async function ye(){var a;const e=(a=i.value)==null?void 0:a.flowStage;if(e==="times"){if(!U.value){alert("è«‹å…ˆå¡«å¯«æ‰€æœ‰æ¬¡æ•¸å•é¡Œ");return}console.log("âœ… æ¬¡æ•¸å¡«å¯«å®Œæˆï¼Œæº–å‚™é€å‡ºæˆ–é€²å…¥ä¸‹ä¸€éšæ®µ");return}if(!x.value)S.value?J():S.value=!0;else if(e==="indicator"){const s=i.value.selectedAnsTypes;if(!s||s.size===0){alert("è«‹è‡³å°‘é¸æ“‡ä¸€å€‹å¤§é …ç›®ä»¥ç¹¼çºŒ");return}await o.fetchChildQuestions(o.selectedChildID)}else e==="times"&&alert("ç¾åœ¨æ˜¯æ¬¡æ•¸éšæ®µï¼Œæ­£åœ¨å¡«å¯«ä¸­...")}function Ce(){y.value.push({name:"",gender:"",birthDate:null})}function ve(e){y.value.length>1&&y.value.splice(e,1)}function J(){for(const e of y.value)if(!e.name||!e.gender||!e.birthDate){alert("è«‹å®Œæ•´å¡«å¯«æ‰€æœ‰å¯¶è²è³‡æ–™");return}N.value=!0,M.value=!0}function q(){N.value=!1,M.value=!1}async function he(){try{if(y.value.length===0){alert("è«‹è‡³å°‘æ–°å¢ä¸€ç­†å¯¶è²è³‡æ–™");return}for(const s of y.value)if(!s.name||!s.gender||!s.birthDate){alert("è«‹å®Œæ•´å¡«å¯«æ‰€æœ‰å¯¶è²è³‡æ–™ï¼");return}const e={MID:t,Token:B,MAID:D,Mobile:v,Child:y.value.map(s=>({Name:s.name,Sex:s.gender==="male"?"1":"2",BirthDay:E(s.birthDate)}))};console.log("ğŸ“¤ API_ChildSave è«‹æ±‚",e);const a=await L.post("https://23700999.com:8081/HMA/API_ChildSave.jsp",e);console.log("ğŸ“© API_ChildSave å›æ‡‰",a.data),a.data.Result==="OK"?(alert("âœ… æ–°å¢å¯¶è²æˆåŠŸï¼"),q(),await o.fetchGrowth(),S.value=!1):alert("âŒ æ–°å¢å¯¶è²å¤±æ•—ï¼š"+a.data.Message)}catch(e){console.error("ğŸš¨ submitBabyData éŒ¯èª¤",e),alert("âŒ ä¼ºæœå™¨éŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦ï¼")}}function E(e){if(!e)return"";const a=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),k=String(e.getDate()).padStart(2,"0");return`${a}${s}${k}`}function fe(e){o.selectedChildID=e,o.fetchGrowthRecord(e)}function ge(e){if(!e.ChildAns||!Array.isArray(e.ChildAns)){console.error("âŒ API å›æ‡‰æ ¼å¼éŒ¯èª¤ï¼Œæ²’æœ‰ ChildAns é™£åˆ—",e);return}o.childRecords[o.selectedChildID].childTimesQues=e.ChildAns.map(a=>({id:a.QueSeq,question:a.Question,selectScore:"",answers:[a.AnswerName_0,a.AnswerName_1,a.AnswerName_2,a.AnswerName_3],Type:a.Type,TypeName:a.TypeName})),o.childRecords[o.selectedChildID].flowStage="times",console.log("âœ… å·²åˆ‡æ›åˆ°æ¬¡æ•¸é ï¼Œé¡Œç›®:",o.childRecords[o.selectedChildID].childTimesQues)}const U=r(()=>{var e;return((e=i.value)==null?void 0:e.flowStage)==="times"?(i.value.childTimesQues||[]).every(s=>s.selectScore!==""):!0}),Be=r(()=>({backgroundColor:V.value?"#bdbdbd":"#74bc1f"})),F=I(0);function De(e){F.value=e}const Se=r(()=>({backgroundColor:F.value>0?"#74bc1f":"#bdbdbd"}));async function Ae(){var O,C;if(F.value===0){alert("è«‹è‡³å°‘é¸æ“‡ä¸€é …æœ€æƒ³è§£æ±ºçš„å•é¡Œï¼");return}const e=o.selectedChildID,a=o.childRecords[e],s=((C=(O=a.growthRec)==null?void 0:O.CIDChildAnsLast)==null?void 0:C.AID)||"",k={MID:t,MAID:D,Token:B,Mobile:v,CID:e,AID:s,ChildAnsSolve:[...a.selectedPriority].map(f=>({QueSeq:f}))};try{const f=await L.post("https://23700999.com:8081/HMA/API_ChildAnsSolveSave.jsp",k);if(f.data.Result!=="OK"){alert("API_ChildAnsSolveSave å¤±æ•—ï¼š"+f.data.Message);return}alert("æœ€æƒ³è§£æ±ºçš„å•é¡Œå·²é€å‡ºï¼");const R={MID:t,MAID:D,Token:B,Mobile:v,CID:e,AID:s},m=await L.post("https://23700999.com:8081/HMA/API_GrowthCompare.jsp",R);if(m.data.Result!=="OK"){alert("API_GrowthCompare å¤±æ•—ï¼š"+m.data.Message);return}o.childRecords[e].reportData=m.data,a.flowStage="result"}catch(f){console.error("onPrioritySubmit error:",f),alert("ä¼ºæœå™¨éŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦ï¼")}}return{babyStore:o,showBabyCover:N,showBabyAlert:M,showAddBabyForm:S,babyInfos:y,qaListRef:d,hasChild:x,curChildData:i,ansTypes:j,currentPage:h,totalPages:A,isPageFilled:Q,nextButtonLabel:ce,isDisableNextBtn:de,hasTwoButtons:ue,onPrevPageClick:le,onNextPageClick:ie,submitChildAnswers:me,commonButtonLabel:be,onCommonButtonClick:ye,isDisableCommonBtn:V,addBabyInfo:Ce,removeBaby:ve,checkAndShowBabyAlert:J,closeBabyAlert:q,submitBabyData:he,formatDateToYYYYMMDD:E,onClickChild:fe,onGoTimes:ge,isTimesAllFilled:U,commonButtonStyle:Be,timesCurrentPage:u,timesTotalPages:n,timesStartIndex:z,timesDisplayedQuestions:H,isTimesPageFilled:Y,timesQuestions:P,timesNextButtonLabel:se,onTimesPrevPage:ne,onTimesNextClick:re,selectedPriorityCount:F,onPrioritySelectionChanged:De,priorityButtonStyle:Se,onPrioritySubmit:Ae}}},Qe={class:"babyRecord"},Ge={key:0,class:"babyCover"},Le={key:1,class:"babyAlert"},Fe={class:"babyAlertBtnGroup"},Oe={class:"babyRerordBtnGroup"},Ke=["disabled"],je={key:0},ze={class:"babyRerordBtnGroup"},He=["disabled"],Ye={key:1},Ve=["disabled"],Je={key:2},qe=["disabled"],Ee={key:3},Ue={class:"babyRerordBtnGroup"},We=["disabled"],Xe={key:4};function Ze(T,o,K,t,B,D){var h,A,Q,u,w,P;const v=te,N=p("BabyIntro"),M=p("BabyCreateForm"),S=p("BabyProgress"),y=p("IndicatorSelect"),d=oe,x=ae,i=p("SolvePrioritySelect"),j=p("BabyReportResult");return c(),b("div",Qe,[_(v,{Text:"å¥åº·ç´€éŒ„",link:"/user"}),t.showBabyCover?(c(),b("div",Ge)):G("",!0),t.showBabyAlert?(c(),b("div",Le,[o[10]||(o[10]=l("h5",null,[W(" å¯¶è²åŸºæœ¬è³‡æ–™"),l("br"),W(" ç¢ºèªå¡«å¯«æ­£ç¢º? ")],-1)),l("div",Fe,[l("button",{class:"babyAlertBtn babyAlertBtnNot",onClick:o[0]||(o[0]=(...n)=>t.closeBabyAlert&&t.closeBabyAlert(...n))}," ä¸ç¢ºå®š "),l("button",{class:"babyAlertBtn babyAlertBtnRight",onClick:o[1]||(o[1]=(...n)=>t.submitBabyData&&t.submitBabyData(...n))}," ç¢ºå®š ")])])):G("",!0),t.hasChild?(c(),b(X,{key:3},[_(S,{babyList:t.babyStore.babyAPIData,selectedChildID:t.babyStore.selectedChildID,onSelectChild:t.onClickChild},null,8,["babyList","selectedChildID","onSelectChild"]),((h=t.curChildData)==null?void 0:h.flowStage)==="indicator"?(c(),b("div",je,[_(y,{ansTypes:t.ansTypes,curChildData:t.curChildData},null,8,["ansTypes","curChildData"]),l("div",ze,[l("button",{class:"babyRerordCommonBtn",disabled:t.isDisableCommonBtn,onClick:o[3]||(o[3]=(...n)=>t.onCommonButtonClick&&t.onCommonButtonClick(...n))},g(t.commonButtonLabel),9,He)])])):((A=t.curChildData)==null?void 0:A.flowStage)==="qa"?(c(),b("div",Ye,[o[11]||(o[11]=l("p",null,"ä»¥ä¸‹å•é¡Œçš„å›°æ“¾ç¨‹åº¦",-1)),_(d,{ref:"qaListRef",questions:t.curChildData.childQuestions,MID:T.MID,MAID:T.MAID,Token:T.Token,Mobile:T.Mobile,CID:t.babyStore.selectedChildID,currentPage:t.curChildData.currentPage,onUpdatePage:o[4]||(o[4]=n=>t.curChildData.currentPage=n),onGoTimes:t.onGoTimes},null,8,["questions","MID","MAID","Token","Mobile","CID","currentPage","onGoTimes"]),l("div",{class:ee(["babyRerordBtnGroup",{"double-btn":t.hasTwoButtons}])},[t.currentPage>1?(c(),b("button",{key:0,class:"babyRerordCommonBtn babyRerordPrevBtn",onClick:o[5]||(o[5]=(...n)=>t.onPrevPageClick&&t.onPrevPageClick(...n))}," ä¸Šä¸€é  ("+g(t.currentPage)+"/"+g(t.totalPages)+") ",1)):G("",!0),l("button",{class:"babyRerordCommonBtn",disabled:t.isDisableNextBtn,onClick:o[6]||(o[6]=(...n)=>t.onNextPageClick&&t.onNextPageClick(...n))},g(t.nextButtonLabel),9,Ve)],2)])):((Q=t.curChildData)==null?void 0:Q.flowStage)==="times"?(c(),b("div",Je,[o[12]||(o[12]=l("h3",null,"ä»¥ä¸‹å•é¡Œä¸Šé€±ç™¼ç”Ÿå¹¾æ¬¡",-1)),_(x,{timesQuestions:t.timesDisplayedQuestions,indexOnThisPage:t.timesStartIndex},null,8,["timesQuestions","indexOnThisPage"]),l("div",{class:ee(["babyRerordBtnGroup",{"double-btn":t.timesCurrentPage>1}])},[t.timesCurrentPage>1?(c(),b("button",{key:0,class:"babyRerordCommonBtn babyRerordPrevBtn",onClick:o[7]||(o[7]=(...n)=>t.onTimesPrevPage&&t.onTimesPrevPage(...n))}," ä¸Šä¸€é  ("+g(t.timesCurrentPage)+"/"+g(t.timesTotalPages)+") ",1)):G("",!0),l("button",{class:"babyRerordCommonBtn",disabled:!t.isTimesPageFilled,onClick:o[8]||(o[8]=(...n)=>t.onTimesNextClick&&t.onTimesNextClick(...n))},g(t.timesNextButtonLabel),9,qe)],2)])):((u=t.curChildData)==null?void 0:u.flowStage)==="priority"?(c(),b("div",Ee,[o[13]||(o[13]=l("h3",null," ä¸‹åˆ—ç‚ºæ‚¨ç›®å‰è¦ºå¾—å›°æ“¾çš„ç—‡ç‹€ï¼Œè«‹å¾ä¸­é¸æ“‡æœ€å¤š10å€‹ç›®å‰æœ€æƒ³è§£æ±ºçš„ç—‡ç‹€ ",-1)),_(i,{symptoms:t.curChildData.childTimesQues,onSelectionChanged:t.onPrioritySelectionChanged},null,8,["symptoms","onSelectionChanged"]),l("div",Ue,[l("button",{class:"babyRerordCommonBtn",disabled:t.selectedPriorityCount===0,style:$(t.priorityButtonStyle),onClick:o[9]||(o[9]=(...n)=>t.onPrioritySubmit&&t.onPrioritySubmit(...n))}," çœ‹å ±å‘Š ",12,We)])])):((w=t.curChildData)==null?void 0:w.flowStage)==="result"?(c(),b("div",Xe,[_(j,{reportData:(P=t.curChildData)==null?void 0:P.reportData},null,8,["reportData"])])):G("",!0)],64)):(c(),b(X,{key:2},[t.showAddBabyForm?(c(),Z(M,{key:1,babyInfos:t.babyInfos,onAddBaby:t.addBabyInfo,onRemoveBaby:t.removeBaby},null,8,["babyInfos","onAddBaby","onRemoveBaby"])):(c(),Z(N,{key:0})),l("div",Oe,[l("button",{class:"babyRerordCommonBtn",disabled:t.isDisableCommonBtn,style:$(t.commonButtonStyle),onClick:o[2]||(o[2]=(...n)=>t.onCommonButtonClick&&t.onCommonButtonClick(...n))},g(t.commonButtonLabel),13,Ke)])],64))])}const ut=Me(xe,[["render",Ze]]);export{ut as default};
