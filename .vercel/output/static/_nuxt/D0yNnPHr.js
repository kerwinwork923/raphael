import{P as N}from"./B1QmaLQs.js";import{f as T,c as Q,s as b}from"./D7B7LOx5.js";import{_ as E}from"./DlAUqK2U.js";import{i as C,t as u,v as f,x as A,y as m,K as P,L as j,U as J,_ as D,z as H,B as L,N as O,Y as _}from"./D70xjexz.js";import{a as d}from"./CCb-kr4I.js";import{u as w}from"./t-MFjoUR.js";const B={class:"resultList"},$={class:"titleGroup"},R={key:0,class:"pGroup"},F={key:0,class:"upIcon"},V={key:1,class:"downIcon"},G={key:2,class:"titleScoreUp"},q={key:3,class:"titleScoreDown"},W={class:"resultTagGroup"},Z={key:0,class:"nextGroup"},z={__name:"SymptomResult",props:{symptomName:String,symptomDifference:String,symptomSolve:Array,symptomRatio:String,symptomPreRatio:String,symptomDesc:String,symptomPreDesc:String,theLatestHistory:Object,theLatestHistoryPre:Object,sex:String},setup(t){const e=t,o=C(()=>e.symptomDifference?Number(e.symptomDifference.replace("%","")):0);function i(c){if(!c)return 0;const r=parseFloat(c.replace("%",""));return isNaN(r)?0:r}return(c,r)=>{var s,a,S;return u(),f("div",B,[A("div",$,[A("h3",null,m(t.symptomName),1),(s=t.theLatestHistoryPre)!=null&&s.CheckTime?(u(),f("div",R,[o.value>0?(u(),f("p",F,"▲")):o.value<0?(u(),f("p",V,"▼")):P("",!0),o.value>0?(u(),f("div",G,m(t.symptomDifference),1)):o.value<0?(u(),f("div",q,m(t.symptomDifference),1)):P("",!0)])):P("",!0)]),A("div",W,[(u(!0),f(j,null,J(t.symptomSolve||[],n=>(u(),f("div",{class:"resultTag",key:n},m(n),1))),128))]),A("h5",null,"(本次)"+m(D(T)(t.theLatestHistory.CheckTime||"")),1),H(N,{score:i(t.symptomRatio),emojiSrc:D(Q)(i(t.symptomRatio))},null,8,["score","emojiSrc"]),A("h4",null,[r[0]||(r[0]=L(" 嚴重程度 : ")),A("span",{style:O({color:D(b)(i(t.symptomRatio),t.sex)})},m(t.symptomRatio)+"("+m(t.symptomDesc)+") ",5)]),(a=t.theLatestHistoryPre)!=null&&a.CheckTime?(u(),f("div",Z,[A("h5",null,"(前次)"+m(D(T)(((S=t.theLatestHistoryPre)==null?void 0:S.CheckTime)||"")),1),H(N,{score:i(t.symptomPreRatio),emojiSrc:D(Q)(i(t.symptomPreRatio))},null,8,["score","emojiSrc"]),A("h4",null,[r[1]||(r[1]=L(" 嚴重程度 : ")),A("span",{style:O({color:D(b)(i(t.symptomPreRatio),t.sex)})},m(t.symptomPreRatio)+"("+m(t.symptomPreDesc)+") ",5)])])):P("",!0)])}}},st=E(z,[["__scopeId","data-v-09c4ce98"]]),ot=_("weeklyQA",{state:()=>({weeklyQA:[],version:"tracking",fullQuestions:[],filteredQuestions:[],currentStep:1,totalStep:0,timesStep:1,totalTimesStep:0,questionsPerPage:7,selectQuestionPerPage:7,nowState:"",preDisabled:!0,nextDisabled:!1,theLatestHistory:{},theLatestData:{},theLatestHistoryPre:{},theLatestDataPreData:{},diffDays:"",diffenenceObj:{},History:{}}),getters:{sortedByScore:t=>[...t.weeklyQA].filter(e=>e.selectScore>0).sort((e,o)=>o.selectScore-e.selectScore),nextText:t=>{if(t.nowState==="first")return"開始檢測";if(t.nowState==="second")return"開始檢測";if(t.nowState==="score")return t.currentStep+1>t.totalStep?"下一步":`下一頁(${t.currentStep+1}/${t.totalStep})`;if(t.nowState==="times")return t.timesStep+1>t.totalTimesStep?"下一步":`下一頁(${t.timesStep+1}/${t.totalTimesStep})`;if(t.nowState==="choose")return"看報告"},preText:t=>{if(t.nowState==="score")return t.currentStep<=1?"上一步":`上一頁 (${t.currentStep}/${t.totalStep})`;if(t.nowState==="times")return t.timesStep<2?"上一步":`上一頁(${t.timesStep}/${t.totalTimesStep})`;if(t.nowState==="choose")return"上一步"}},actions:{setVersion(t){this.version=t,this.updateWeeklyQA()},updateWeeklyQA(){this.weeklyQA=this.version==="tracking"?this.filteredQuestions:this.fullQuestions,this.totalStep=Math.ceil(this.weeklyQA.length/this.questionsPerPage),this.currentStep=1},async getQues(){const t=w();t.startLoading();const e=localStorage.getItem("userData"),{MID:o,Token:i,MAID:c,Mobile:r}=e?JSON.parse(e):{};try{const s=await d.post("https://23700999.com:8081/HMA/API_ANSOnlineGetQues.jsp",{MID:o,Token:i,MAID:c,Mobile:r});if(s.status===200){const{QesCategoryArray:a,QesCategoryNameArray:S,QuesArray:n,QuesNeedAnswerArray:g}=s.data,l=n.map((p,h)=>({id:h+1,question:p,category:S[a[h]]||"",selectScore:0})),I=g.map(p=>{const h=parseInt(p,10)-1;return h>=0&&h<l.length?l[h]:null}).filter(Boolean);this.fullQuestions=l,this.filteredQuestions=I,this.updateWeeklyQA()}}catch(s){console.error("Error fetching questions:",s),t.setError(s)}finally{t.stopLoading()}},async API_ANSOnlineQSaveAns(){const t=w();t.startLoading();const e=localStorage.getItem("userData"),{MID:o,Token:i,MAID:c,Mobile:r,Name:s,Birthday:a,Mail:S,Zone:n,Address:g,Sex:l}=e?JSON.parse(e):{},I=a||"",p=S||"",h=n||"";let v=new Map;this.weeklyQA.forEach((y,M)=>{const k=y.score!==void 0?y.score:0;v.set(`key${M+1}`,String(k))});const x=JSON.stringify(Object.fromEntries(v));try{const y=await d.post("https://23700999.com:8081/HMA/API_ANSOnlineQSaveAns.jsp",{MID:String(o),Token:String(i),MAID:String(c),Mobile:String(r),name:String(s),rbirth:String(I),Email:String(p),Area:String(h),Address:String(g||""),Sex:String(l),AnsMap:x});if(y.status===200){console.log("API_ANSOnlineQSaveAns response:",y.data);const M=y.data.AID;if(M){const k={...JSON.parse(e),AID:M};localStorage.setItem("userData",JSON.stringify(k))}}}catch(y){console.error("Error while saving answers:",y),t.setError(y)}finally{t.stopLoading()}},async API_ANSOnlineTimesSaveTimes(){const t=w();t.startLoading();const e=localStorage.getItem("userData"),{MID:o,Token:i,MAID:c,Mobile:r,Name:s,Sex:a,AID:S}=e?JSON.parse(e):{};let n=new Map;this.sortedByScore.forEach(l=>{l.times<0&&(l.times=0),n.set(`key${l.id+1}`,String(l.times))});const g=JSON.stringify(Array.from(n.entries()));try{(await d.post("https://23700999.com:8081/HMA/API_ANSOnlineTimesSaveTimes.jsp",{MID:String(o),Token:String(i),MAID:String(c),Mobile:String(r),AID:String(S),AnsTimesMap:g})).status}catch(l){console.error("Error while saving times:",l),t.setError(l)}finally{t.stopLoading()}},async API_ANSOnlineSolveSaveSolve(){const t=w();t.startLoading();const e=localStorage.getItem("userData"),{MID:o,Token:i,MAID:c,Mobile:r,AID:s}=e?JSON.parse(e):{};let a=[];this.sortedByScore.forEach(n=>{n.active&&n.times>=0&&a.push(`key${n.id+1}`)});const S=JSON.stringify(a);try{(await d.post("https://23700999.com:8081/HMA/API_ANSOnlineSolveSaveSolve.jsp",{MID:String(o),Token:String(i),MAID:String(c),Mobile:String(r),AID:String(s),AnsSolveArray:S})).status}catch(n){console.error("Error while saving solve:",n),t.setError(n)}finally{t.stopLoading()}},async API_API_ANSFirstDetail(){var r;const t=localStorage.getItem("userData"),{MID:e,Token:o,MAID:i,Mobile:c}=t?JSON.parse(t):{};if(this.sortedByScore.length>0){console.log("sortedByScore 已有值，跳过 API 调用");return}try{const s=await d.post("https://23700999.com:8081/HMA/API_ANSFirstDetail.jsp",{MID:String(e),Token:String(o),MAID:String(i),Mobile:String(c),AID:""});if(s.status===200)if(this.History=(r=s.data)==null?void 0:r.History,s.data.AID!==""){if(this.theLatestHistory=s.data,this.theLatestData=s.data,s.data.History.length>0){this.theLatestHistoryPre=s.data.History[0],console.log(this.theLatestHistoryPre);const a=await d.post("https://23700999.com:8081/HMA/API_ANSFirstDetail.jsp",{MID:String(e),Token:String(o),MAID:String(i),Mobile:String(c),AID:String(s.data.History[0].preAID)});this.theLatestDataPreData=a.data}await this.checkTestDate(),await this.API_API_ANSSecond()}else if(s.data.History.length>0){this.theLatestHistory=s.data.History[0];const a=await d.post("https://23700999.com:8081/HMA/API_ANSFirstDetail.jsp",{MID:String(e),Token:String(o),MAID:String(i),Mobile:String(c),AID:String(s.data.History[0].preAID)});this.theLatestData=a.data,console.log(this.theLatestHistory),await this.checkTestDate()}else this.nowState="first",await this.getQues()}catch(s){throw console.error("Error while fetching questions:",s),s}},async checkTestDate(){if(this.theLatestHistory.CheckTime){const t=new Date,e=this.theLatestHistory.CheckTime,[o,i]=e.split(" "),[c,r,s]=o.split("/").map(Number),[a,S]=i.split(":").map(Number),n=new Date(c,r-1,s,a,S);if(!isNaN(n.getTime())){const g=t-n,l=Math.floor(g/(1e3*60*60*24)),I=Math.floor(g%(1e3*60*60*24)/(1e3*60*60)),p=6-l;let h=0;if(p>0?(l===0&&(h=6-I),this.diffDays=`${p}天`):p===0&&h>0&&(this.diffDays=`${h}小時`),l<6){this.nowState="result",await this.API_API_ANSSecond();return}else this.nowState="second",await this.getQues()}}else this.nowState="second",await this.getQues()},async API_API_ANSSecond(){var r,s;const t=localStorage.getItem("userData"),{MID:e,Token:o,MAID:i,Mobile:c}=t?JSON.parse(t):{};try{const a=await d.post("https://23700999.com:8081/HMA/API_ANSSecond.jsp",{MID:String(e),Token:String(o),MAID:String(i),Mobile:String(c),AID:String((r=this.theLatestData)==null?void 0:r.AID),preAID:String((s=this.theLatestHistoryPre)==null?void 0:s.preAID)});a.status===200&&(console.log(a.data),this.diffenenceObj={...a.data,C1Symptom:"精神系統",C2Symptom:"神經系統",C3Symptom:"血液循環系統",C4Symptom:"感官系統",C5Symptom:"心肺系統",C6Symptom:"過敏免疫系統",C7Symptom:"腸胃系統",C8Symptom:"泌尿生殖系統",C9Symptom:"血液循環系統"})}catch(a){throw console.error("Error while fetching questions:",a),a}},async handleNextStep(){if(w(),this.nowState==="first")try{this.nowState="score",this.currentStep=1,this.preDisabled=!0,this.nextDisabled=!1}catch(t){console.error("Error fetching questions:",t),alert("獲取題目失敗，請稍後重試。")}else if(this.nowState==="second")try{this.nowState="score",this.currentStep=1,this.preDisabled=!0,this.nextDisabled=!1}catch(t){console.error("Error fetching questions:",t),alert("獲取題目失敗，請稍後重試。")}else if(this.nowState==="score"){const t=(this.currentStep-1)*this.questionsPerPage,e=Math.min(t+this.questionsPerPage,this.weeklyQA.length);if(this.weeklyQA.slice(t,e).every(o=>o.score>0),this.currentStep<this.totalStep)this.currentStep+=1;else{if(this.weeklyQA.filter(i=>i.selectScore>0).length<1)return alert("選項項目不足，請至少選擇1題"),!1;this.weeklyQA.forEach(i=>{i.times===void 0&&(i.times=-1)}),this.nowState="times",this.totalTimesStep=Math.ceil(this.sortedByScore.length/this.questionsPerPage)}}else this.nowState==="times"?this.timesStep<this.totalTimesStep?this.timesStep+=1:this.nowState="choose":this.nowState==="choose"&&(await this.API_ANSOnlineQSaveAns(),await this.API_ANSOnlineTimesSaveTimes(),await this.API_ANSOnlineSolveSaveSolve(),location.reload());this.preDisabled=this.currentStep===1,this.nextDisabled=this.nowState==="score"?this.currentStep===this.totalStep:this.timesStep===this.totalTimesStep},handlePrevStep(){this.nowState==="times"&&this.timesStep>1?this.timesStep-=1:this.nowState==="score"&&this.currentStep>1&&(this.currentStep-=1),this.preDisabled=this.nowState==="score"&&this.currentStep===1,this.nextDisabled=!1},toggleActive(t){const e=this.weeklyQA.find(o=>o.id===t);e&&(e.active=!e.active)}}});export{st as _,ot as u};
