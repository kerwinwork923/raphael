import{r as l,o as $,G as L,v as h,x as b,y as e,z as d,N as V,V as x,a as E}from"./HfdH-K36.js";import{_ as M}from"./DlAUqK2U.js";const S={class:"pwa-test"},R={class:"test-section"},B={class:"test-section"},D={class:"controls"},N=["disabled"],T=["disabled"],U=["disabled"],j=["disabled"],z={class:"logs"},O={class:"log-content"},F={__name:"pwa-test",setup(G){const u=l(null),c=l(!1),p=l(!0),m=l("未開啟"),f=l("未錄影"),i=l(!1),r=l(!1),v=l([]);let n=null,o=null,w=[];const s=t=>{const a=new Date().toLocaleTimeString();v.value.unshift(`[${a}] ${t}`),v.value.length>20&&v.value.pop()},y=()=>{const{$pwaUtils:t}=E();t?c.value=t.isPWA():c.value=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone,s(`PWA 狀態檢查: ${c.value?"PWA 模式":"瀏覽器模式"}`)},k=()=>{p.value=!document.hidden,s(`頁面可見性變化: ${p.value?"可見":"隱藏"}`),document.hidden&&(s("頁面進入背景，自動停止相機和錄影"),_(),g())},A=async()=>{try{n=await navigator.mediaDevices.getUserMedia({video:{facingMode:"user"},audio:!0}),u.value.srcObject=n,i.value=!0,m.value="已開啟",s("相機開啟成功")}catch(t){s(`相機開啟失敗: ${t.message}`)}},_=()=>{n&&(n.getTracks().forEach(t=>t.stop()),n=null),u.value&&(u.value.srcObject=null),i.value=!1,m.value="已關閉",s("相機已關閉")},P=()=>{if(!n){s("無法開始錄影：相機未開啟");return}w=[],o=new MediaRecorder(n),o.ondataavailable=t=>{t.data.size>0&&w.push(t.data)},o.onstop=()=>{s("錄影已停止"),f.value="已停止",r.value=!1},o.start(),r.value=!0,f.value="錄影中",s("開始錄影")},g=()=>{o&&o.state!=="inactive"&&(o.stop(),s("手動停止錄影"))};return $(()=>{s("PWA 測試頁面載入"),y(),document.addEventListener("visibilitychange",k),window.addEventListener("pwa-background",t=>{s(`收到 PWA 背景事件: ${t.detail.timestamp}`)})}),L(()=>{document.removeEventListener("visibilitychange",k),_(),g(),s("頁面卸載，清理資源")}),(t,a)=>(b(),h("div",S,[a[3]||(a[3]=e("h1",null,"PWA 錄影關閉測試",-1)),e("div",R,[a[0]||(a[0]=e("h2",null,"狀態檢查",-1)),e("p",null,"PWA 模式: "+d(c.value?"是":"否"),1),e("p",null,"頁面可見性: "+d(p.value?"可見":"隱藏"),1),e("p",null,"相機狀態: "+d(m.value),1),e("p",null,"錄影狀態: "+d(f.value),1)]),e("div",B,[a[1]||(a[1]=e("h2",null,"相機測試",-1)),e("video",{ref_key:"testVideo",ref:u,autoplay:"",muted:"",playsinline:""},null,512),e("div",D,[e("button",{onClick:A,disabled:i.value},"開啟相機",8,N),e("button",{onClick:_,disabled:!i.value},"關閉相機",8,T),e("button",{onClick:P,disabled:!i.value||r.value},"開始錄影",8,U),e("button",{onClick:g,disabled:!r.value},"停止錄影",8,j)])]),a[4]||(a[4]=e("div",{class:"test-section"},[e("h2",null,"PWA 背景測試"),e("p",null,"請切換到其他應用程式或按 Home 鍵，然後返回此頁面"),e("p",null,"預期行為：相機和錄影應該自動停止")],-1)),e("div",z,[a[2]||(a[2]=e("h3",null,"日誌",-1)),e("div",O,[(b(!0),h(V,null,x(v.value,(W,C)=>(b(),h("div",{key:C,class:"log-item"},d(W),1))),128))])])]))}},q=M(F,[["__scopeId","data-v-2705ac2f"]]);export{q as default};
