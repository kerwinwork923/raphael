import{_ as oe}from"./W3k4iq7y.js";import{_ as ae,a as se,b as he}from"./DNvPBKjv.js";import{_ as ne}from"./DGlBoWLk.js";import{_ as le}from"./1SqYRxzD.js";import{M as re,r as g,j as B,o as ce,v as f,x as c,y as t,z as T,J as Z,O as G,H as D,A as W,_ as ge,I as Q,K as X,N as Y,V as K}from"./HfdH-K36.js";import{a as ie}from"./xsH4HHeE.js";import{s as pe}from"./x_rD_Ya3.js";import{_ as de}from"./DlAUqK2U.js";import{u as _e}from"./Bf7E4ooc.js";import{u as ee}from"./BUsOIeYI.js";import{_ as te}from"./DCGXGCbS.js";import{_ as Ce}from"./fh2N3Yhm.js";import"./DNAPM-2u.js";import"./B0rTVoH9.js";const ye={class:"progress-container"},De={class:"content"},Ie={class:"flex"},Ne=["disabled"],Te={__name:"TimeRing0616",props:{totalTime:{type:Number,default:3600},productName:{type:String,default:""}},setup(s){const a=s,N=re(),e={BEFORE:"before",RUNNING:"running"},v=g(e.BEFORE),i=g(a.totalTime*1e3),d=g(!1),h=g(""),C=g(!1);let u=null,p=0;const I=B(()=>{switch(v.value){case e.BEFORE:return"開始紀錄";case e.RUNNING:return"重新紀錄";default:return"未知狀態"}}),n=B(()=>({backgroundColor:"#74BC1F",color:"#fff"})),w=B(()=>{const o=a.totalTime*1e3-i.value,m=Math.min(o/(a.totalTime*1e3)*100,100);return{background:`conic-gradient(#74BC1F 0% ${m}%, #ffffff ${m}% 100%)`,transition:"background 0.1s linear"}}),H=B(()=>{const o=Math.floor(i.value/1e3),m=Math.floor(o/3600),y=Math.floor(o%3600/60),A=o%60;return`${String(m).padStart(2,"0")}:${String(y).padStart(2,"0")}:${String(A).padStart(2,"0")}`}),O=JSON.parse(localStorage.getItem("userData")||"{}"),{MID:M="",Token:R="",MAID:k="",Mobile:S=""}=O;(!M||!R||!k||!S)&&(console.error("用戶資料不完整，跳回登入"),N.push("/"));async function x(o,m){try{const{data:y}=await ie.post(o,m);return y}catch(y){return console.error(`[API失敗] ${o}`,y),null}}async function j(){const o=await x("https://23700999.com:8081/HMA/API_UseStart.jsp",{MID:M,Token:R,MAID:k,Mobile:S,ProductName:a.productName});return!o||!o.UID?(console.warn("useStartAPI => 無法建立 UID"),null):o}async function E(){h.value&&await x("https://23700999.com:8081/HMA/API_UseEnd.jsp",{MID:M,Token:R,MAID:k,Mobile:S,UID:h.value})}async function q(){h.value&&await x("https://23700999.com:8081/HMA/API_DeleteStart.jsp",{MID:M,Token:R,MAID:k,Mobile:S,UID:h.value,ProductName:a.productName})}async function J(){return x("https://23700999.com:8081/HMA/API_MID_ProductName_UIDInfo.jsp",{MID:M,Token:R,MAID:k,Mobile:S,ProductName:a.productName})}function l(){console.log("開始倒數 => 剩餘秒數:",i.value/1e3),d.value=!0,p=Date.now(),u&&clearInterval(u),u=pe(async()=>{const o=Date.now(),m=o-p;p=o,i.value=Math.max(i.value-m,0),i.value<=0&&(clearInterval(u),u=null,d.value=!1,await E(),_(),N.go(0))},1e3)}async function r(){if(!C.value){C.value=!0;try{switch(console.log("按鈕點擊 => 狀態:",v.value),v.value){case e.BEFORE:{const o=await j();o!=null&&o.UID&&(h.value=o.UID,v.value=e.RUNNING,l());break}case e.RUNNING:{confirm("確定要重新檢測嗎？這會清除本次倒數記錄。")&&(await q(),_());break}default:console.warn("未知狀態:",v.value)}}finally{C.value=!1}}}function _(){u&&(clearInterval(u),u=null),v.value=e.BEFORE,i.value=a.totalTime*1e3,d.value=!1,h.value="",console.log("已重置 => 回到 BEFORE 狀態")}ce(async()=>{try{const o=await J();if(o!=null&&o.UID&&(h.value=o.UID,o.StartTime)){const m=U(o.StartTime),y=Date.now()-m.getTime(),A=a.totalTime*1e3-y;A>0?(i.value=A,v.value=e.RUNNING,l()):(await E(),_())}}catch(o){console.error("onMounted 初始化失敗:",o)}});function U(o){return!o||o.length<14?new Date:new Date(`${o.slice(0,4)}-${o.slice(4,6)}-${o.slice(6,8)}T${o.slice(8,10)}:${o.slice(10,12)}:${o.slice(12,14)}`)}return(o,m)=>(c(),f("div",ye,[t("div",{class:"progress-border",style:Z(w.value)},[t("div",De,T(H.value),1)],4),t("div",Ie,[t("button",{style:Z(n.value),onClick:r,disabled:C.value},T(I.value),13,Ne)])]))}},we=de(Te,[["__scopeId","data-v-bf05d40e"]]);function L(s){if(!s||s.length<14)return null;const a=Number(s.slice(0,4)),N=Number(s.slice(4,6))-1,e=Number(s.slice(6,8)),v=Number(s.slice(8,10)),i=Number(s.slice(10,12)),d=Number(s.slice(12,14));return new Date(a,N,e,v,i,d)}function Me(s){if(!s)return"";if(s.includes("/")||s.length<12)return s;const a=Number(s.slice(0,4)),N=Number(s.slice(4,6))-1,e=Number(s.slice(6,8)),v=Number(s.slice(8,10)),i=Number(s.slice(10,12)),d=new Date(a,N,e,v,i);if(isNaN(d.getTime()))return s;const h=d.getMonth()+1,C=d.getDate(),u=String(d.getHours()).padStart(2,"0"),p=String(d.getMinutes()).padStart(2,"0");return`${h}/${C} ${u}:${p}`}const Re={name:"UsageHistoryView",components:{TitleMenu:le,TimeRing:we,TimeRing2:se,DSPRSelect:ne,HRVAlertForUse:ae,RaphaelLoading:oe,useSeo:ee},setup(){ee({title:"",description:"NeuroPlus神經調節家提供專業的自律神經檢測服務，運用FDA認證AI技術，透過人臉辨識快速分析HRV數據，幫助您了解自律神經狀態。",url:"https://neuroplus.com.tw"});const s=re();_e();const a=decodeURIComponent(s.currentRoute.value.params.clothType||"");["三效深眠衣","雙效紅光活力衣","全效調節衣","居家治療儀"].includes(a)||s.push("/usageHistory");const e=g(!1),v=g(a),i=g([]),d=g("00:00:00"),h=g([]),C=g(new Date().getFullYear()),u=g(new Date().getMonth()+1),p=g(!1),I=g(!1),n=B(()=>{const l=new Date().getFullYear(),r=[];for(let _=2024;_<=l;_++)r.push(_);return r}),w=Array.from({length:12},(l,r)=>r+1).reverse();function H(){p.value=!p.value,I.value=!1}function O(){I.value=!I.value,p.value=!1}function M(l){C.value=l,p.value=!1}function R(l){u.value=l,I.value=!1}async function k(){var l;try{e.value=!0;const r=localStorage.getItem("userData");if(!r){s.push("/");return}const{MID:_,Token:U,MAID:o,Mobile:m}=JSON.parse(r),y=await ie.post("https://23700999.com:8081/HMA/API_UseStart_Data.jsp",{MID:_,Token:U,MAID:o,Mobile:m});if(y.status===200&&((l=y.data)!=null&&l.UseRecord)){const V=y.data.UseRecord.filter(b=>b.ProductName===a);if(i.value=V,V.length>0){const b=V[V.length-1],F=L(b.oriStartTime),$=L(b.oriEndTime);if(F&&$&&$>F){const z=Math.floor(($-F)/1e3),me=String(Math.floor(z/3600)).padStart(2,"0"),fe=String(Math.floor(z%3600/60)).padStart(2,"0"),ve=String(z%60).padStart(2,"0");d.value=`${me}:${fe}:${ve}`}}const ue=new Date,P=new Date;P.setHours(5,0,0,0),ue<P&&P.setDate(P.getDate()-1),h.value=V.filter(b=>new Date(b.EndTime.replace(/\//g,"-"))>=P)}}catch(r){console.error("getUseRecord error:",r)}finally{e.value=!1}}function S(l){const r=L(l.oriStartTime),_=L(l.oriEndTime);if(!r||!_||_<=r)return 0;const U=Math.round((_-r)/6e4),o=Math.floor(U/60),m=U%60;return o>0?`${o}小時${m}分鐘`:`${m}分鐘`}const x=B(()=>i.value.filter(l=>{const r=L(l.oriStartTime);return!r||isNaN(r.getTime())?!1:r.getFullYear()===C.value&&r.getMonth()+1===u.value}));function j(l){s.push(`/usageHRVResult/${l.UID}`)}function E(l){s.push(`/healthData/${l}`)}function q(){}function J(){}return ce(()=>{k()}),{loading:e,productName:a,usageCardState:v,hasDetectTime:d,todayUseRecord:h,selectedYear:C,selectedMonth:u,yearBoxVisible:p,monthBoxVisible:I,displayYears:n,months:w,toggleYearBox:H,toggleMonthBox:O,selectYear:M,selectMonth:R,useData:i,filteredUseList:x,calcUsedMinutes:S,formatTimestamp3:Me,handleDetectClick:j,handleWatchClick:E,handleCountdownComplete:q,handleHRVCheck:J}}},ke={class:"usageWrap"},Se={key:3,class:"usageInfoGroup"},xe={key:4,class:"usageInfoGroup"},Ue={key:5,class:"usageInfoGroup"},be={key:6,class:"usageInfoGroup"},Be={class:"usageRecord"},He={class:"detectSelectGroup"},Ae={class:"yearSelectGroup"},Ve={class:"yearBox"},Pe=["onClick"],Le={class:"monthSelectGroup"},Ee={class:"monthBox"},Fe=["onClick"],Ge={class:"integrationGroup"},Ye={class:"detect"},Oe={class:"timeGroup"},je={class:"timeTextGroup"},qe={class:"time"},Je={class:"timeInfoText"},$e={class:"infoGroup"},ze=["onClick"],We=["onClick"],Ke={key:0,class:"notDetectData"};function Ze(s,a,N,e,v,i){const d=oe,h=ae,C=ne,u=le,p=se,I=he;return c(),f(Y,null,[e.loading?(c(),G(d,{key:0})):D("",!0),W(h,{showCloseButton:!0}),W(C,{showCloseButton:!1}),t("div",ke,[W(u,{Text:"穿衣紀錄",link:"/UsageHistory"}),e.productName==="三效深眠衣"||e.productName==="全效調節衣"?(c(),G(p,{key:0,productName:e.productName,hasDetectRecord:!1,todayUseRecord:e.todayUseRecord,hasDetectTime:e.hasDetectTime},null,8,["productName","todayUseRecord","hasDetectTime"])):D("",!0),e.productName==="居家治療儀"?(c(),G(I,{key:1,totalTime:3e3,"product-name":e.productName,hasTodayRecord:!1,onCountdownComplete:e.handleCountdownComplete,onRequireHRVCheck:e.handleHRVCheck},null,8,["product-name","onCountdownComplete","onRequireHRVCheck"])):D("",!0),e.productName==="雙效紅光活力衣"?(c(),G(I,{key:2,totalTime:5400,"product-name":e.productName,hasTodayRecord:!1,onCountdownComplete:e.handleCountdownComplete,onRequireHRVCheck:e.handleHRVCheck},null,8,["product-name","onCountdownComplete","onRequireHRVCheck"])):D("",!0),e.usageCardState==="雙效紅光活力衣"?(c(),f("div",Se,a[2]||(a[2]=[ge('<div class="usageInfoCard" data-v-30263c3f><h3 data-v-30263c3f>電量提示燈使用說明</h3><div class="item" data-v-30263c3f><span class="greenLight" data-v-30263c3f>•綠燈恆亮</span><div class="text" data-v-30263c3f>正常電量</div></div><div class="item" data-v-30263c3f><span class="greenLight" data-v-30263c3f>•綠燈閃爍</span><div class="text" data-v-30263c3f>充電中，需充滿4小時</div></div><div class="item" data-v-30263c3f><span class="redLight" data-v-30263c3f>•紅燈恆亮</span><div class="text" data-v-30263c3f>電量剩餘25% (治療完需充電)</div></div><div class="item" data-v-30263c3f><span class="redLight" data-v-30263c3f>•紅燈閃爍</span><div class="text" data-v-30263c3f>電量剩餘5% (不計治療次數)</div></div></div><div class="usageInfoCard" data-v-30263c3f><h3 data-v-30263c3f>提示音說明</h3><div class="item" data-v-30263c3f><span class="greenLight" data-v-30263c3f>•開始</span><div class="text" data-v-30263c3f>1短聲</div></div><div class="item" data-v-30263c3f><span class="redLight" data-v-30263c3f>•結束</span><div class="text" data-v-30263c3f>長音間隔1分鐘</div></div><div class="item" data-v-30263c3f><span class="orangeLight" data-v-30263c3f>•合約到期/次數用完</span><div class="text" data-v-30263c3f>長音間隔1分鐘，紅綠燈交替閃爍</div></div></div>',2)]))):D("",!0),e.usageCardState==="三效深眠衣"?(c(),f("div",xe,a[3]||(a[3]=[t("div",{class:"usageInfoCard"},[t("h3",null,"量身訂製"),t("p",null,"依照您的健康狀況製作客製化調節貼片位置。")],-1),t("div",{class:"usageInfoCard"},[t("h3",null,"持續調節"),t("p",null,"將三效深眠衣取代睡衣，每日穿著，持續調節自律神經生理機能。")],-1),t("div",{class:"usageInfoCard"},[t("h3",null,"洗滌維護"),t("p",null,"可以直接手洗、或放置洗衣袋隨一般衣物清洗(勿加漂白水)。")],-1)]))):D("",!0),e.usageCardState==="居家治療儀"?(c(),f("div",Ue,a[4]||(a[4]=[t("div",{class:"usageInfoCard"},[t("h3",null,"安全模式啟動"),t("p",null," 如果治療過程中遇到問題，設備會進入安全模式，使用者可以按下「解除」鍵，排除問題後繼續使用。 ")],-1),t("div",{class:"usageInfoCard"},[t("h3",null,"貼片脫落提示"),t("p",null," 當設備提示貼片可能脫落時，應根據示意圖檢查貼片位置，並在確認貼好後按下「解除」鍵繼續治療。 ")],-1)]))):D("",!0),e.usageCardState==="全效調節衣"?(c(),f("div",be,a[5]||(a[5]=[t("div",{class:"usageInfoCard"},[t("h3",null,"非侵入性治療"),t("p",null," 這款全效調節衣使用的是物理性治療，不涉及任何藥物，適合那些想要避免藥物副作用的患者。它依賴於專利技術的貼片，通過波頻影響神經系統 ")],-1),t("div",{class:"usageInfoCard"},[t("h3",null,"針對自律神經問題設計"),t("p",null," 全效調節衣專為改善自律神經失調而設計，適用於失眠、焦慮、情緒不穩定等問題，也能幫助增強免疫系統 ")],-1),t("div",{class:"usageInfoCard"},[t("h3",null,"適合居家使用"),t("p",null," 全效調節衣是一款設計簡單、方便的保健產品，適合在家中進行日常使用，無需到診所即可完成自律神經的調節 ")],-1)]))):D("",!0),t("div",Be,[t("div",He,[t("div",Ae,[a[6]||(a[6]=t("img",{src:te,alt:"年份篩選"},null,-1)),t("div",{class:"monthText",onClick:a[0]||(a[0]=(...n)=>e.toggleYearBox&&e.toggleYearBox(...n))},T(e.selectedYear)+"年 ",1),Q(t("div",Ve,[(c(!0),f(Y,null,K(e.displayYears,n=>(c(),f("div",{class:"year",key:n,onClick:w=>e.selectYear(n)},T(n),9,Pe))),128))],512),[[X,e.yearBoxVisible]])]),t("div",Le,[a[7]||(a[7]=t("img",{src:te,alt:"月份篩選"},null,-1)),t("div",{class:"monthText",onClick:a[1]||(a[1]=(...n)=>e.toggleMonthBox&&e.toggleMonthBox(...n))},T(e.selectedMonth)+"月份 ",1),Q(t("div",Ee,[(c(!0),f(Y,null,K(e.months,n=>(c(),f("div",{class:"month",key:n,onClick:w=>e.selectMonth(n)},T(n)+"月 ",9,Fe))),128))],512),[[X,e.monthBoxVisible]])])]),t("div",Ge,[(c(!0),f(Y,null,K(e.filteredUseList,(n,w)=>(c(),f("div",{class:"detectItem",key:w},[t("div",Ye,[t("div",Oe,[a[8]||(a[8]=t("div",{class:"timeIcon",style:{cursor:"pointer"}},[t("img",{src:Ce,alt:"查看健康數據"})],-1)),t("div",je,[t("div",qe,T(e.formatTimestamp3(n.oriStartTime)),1),t("div",Je," 總共使用 "+T(e.calcUsedMinutes(n)),1)])]),t("div",$e,[n.FlagState==="completed"?(c(),f("div",{key:0,class:"resultText",style:{cursor:"pointer"},onClick:H=>e.handleDetectClick(n)}," 分析結果 ",8,ze)):D("",!0),n.FlagState==="completed"?(c(),f("svg",{key:1,xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",style:{cursor:"pointer"},onClick:H=>e.handleDetectClick(n)},a[9]||(a[9]=[t("path",{d:"M5.99159 3.37719L11.4726 8.99994L5.99159 14.6227C5.89346 14.7232 5.83853 14.858 5.83853 14.9984C5.83853 15.1389 5.89346 15.2737 5.99159 15.3742C6.03925 15.4228 6.09613 15.4615 6.15891 15.4879C6.2217 15.5142 6.28911 15.5278 6.35721 15.5278C6.42531 15.5278 6.49273 15.5142 6.55551 15.4879C6.61829 15.4615 6.67518 15.4228 6.72284 15.3742L12.5548 9.39257C12.6572 9.28752 12.7145 9.14664 12.7145 8.99994C12.7145 8.85325 12.6572 8.71236 12.5548 8.60732L6.72396 2.62569C6.67627 2.57671 6.61924 2.53777 6.55625 2.51119C6.49326 2.4846 6.42558 2.4709 6.35721 2.4709C6.28884 2.4709 6.22116 2.4846 6.15817 2.51119C6.09518 2.53777 6.03816 2.57671 5.99046 2.62569C5.89234 2.72615 5.8374 2.86101 5.8374 3.00144C5.8374 3.14187 5.89234 3.27673 5.99046 3.37719Z",fill:"#666666"},null,-1)]),8,We)):D("",!0)])])]))),128)),e.filteredUseList.length===0?(c(),f("div",Ke," 無檢測資料 ")):D("",!0)])])])],64)}const mt=de(Re,[["render",Ze],["__scopeId","data-v-30263c3f"]]);export{mt as default};
