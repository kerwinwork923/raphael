import{r as y,v as P,H as R,x as I,y as o,I as u,a4 as S}from"./HfdH-K36.js";import{u as v}from"./Bf7E4ooc.js";import{a as h}from"./xsH4HHeE.js";import{_ as b}from"./DNAPM-2u.js";import{_ as w}from"./DlAUqK2U.js";const x={props:{showCloseButton:{type:Boolean,default:!0}},setup(){const a=v(),e=y(""),i=()=>{a.showDSPRSelect=!1},s=async()=>{const n=["normal","prehypertension","hypertension"];if(e.value&&n.includes(e.value)){const t=JSON.parse(localStorage.getItem("userData"))||{};if(t.DSPR=e.value,!D(t)){alert("會員資料格式有誤，請修改您的資料！");return}t.Sex=="2"&&(t.Sex="0");const l={age:r(t.Birthday),bp_group:t.DSPR,bp_mode:"ternary",facing_mode:"user",height:parseInt(t.Height),sex:parseInt(t.Sex),weight:parseInt(t.Weight),time:parseInt(t.HRVCalTime)||2};try{if((await h.post("https://23700999.com:8081/HMA/API_AA5.jsp",{...t})).status===200){sessionStorage.setItem("data",JSON.stringify(l)),localStorage.setItem("userData",JSON.stringify(t)),i();const p=a.detectUID,m=a.detectFlag,c=a.detectForm;let f="/vital/scan.html";m&&(f+=`?UID=${p}&flag=${m}&form=${c}`),window.location.href=f}else alert("伺服器回應失敗，請稍後再試。")}catch(d){console.error("API 儲存失敗：",d),alert("資料儲存失敗，請稍後再試。")}}else alert("請選擇一個有效的血壓範圍！")},D=n=>{const t=l=>Number.isInteger(parseInt(l,10));return t(n.Height)&&parseInt(n.Height)>0&&t(n.Weight)&&parseInt(n.Weight)>0&&g(n.Birthday)&&(n.Sex==="1"||n.Sex==="2")},g=n=>{const t=n.split("/");return t.length===3&&parseInt(t[0])>0&&parseInt(t[1])>=1&&parseInt(t[1])<=12&&parseInt(t[2])>=1&&parseInt(t[2])<=31},r=n=>{const[t,l,d]=n.split("/").map(Number),p=new Date(t+1911,l-1,d),m=Date.now()-p.getTime(),c=new Date(m);return Math.abs(c.getUTCFullYear()-1970)};return{store:a,closeComponent:i,submitData:s,selectedDSPR:e}}},B={key:0,class:"modal"},C={class:"DSPRSelect"},H={class:"inputGroup"},U={class:"inputGroup"},V={class:"inputGroup"};function _(a,e,i,s,D,g){return s.store.showDSPRSelect?(I(),P("div",B,[e[10]||(e[10]=o("div",{class:"cover"},null,-1)),o("div",C,[i.showCloseButton?(I(),P("img",{key:0,src:b,class:"closeBtn",alt:"",onClick:e[0]||(e[0]=(...r)=>s.closeComponent&&s.closeComponent(...r))})):R("",!0),e[8]||(e[8]=o("h3",null,"請選擇您的血壓",-1)),e[9]||(e[9]=o("hr",null,null,-1)),o("div",H,[u(o("input",{type:"radio",name:"DSPR",id:"DSPR1",value:"normal","onUpdate:modelValue":e[1]||(e[1]=r=>s.selectedDSPR=r)},null,512),[[S,s.selectedDSPR]]),e[5]||(e[5]=o("label",{for:"DSPR1"},"正常(120mmHg)",-1))]),o("div",U,[u(o("input",{type:"radio",name:"DSPR",id:"DSPR2",value:"prehypertension","onUpdate:modelValue":e[2]||(e[2]=r=>s.selectedDSPR=r)},null,512),[[S,s.selectedDSPR]]),e[6]||(e[6]=o("label",{for:"DSPR2"},"高血壓前期(120~139mmHg)",-1))]),o("div",V,[u(o("input",{type:"radio",name:"DSPR",id:"DSPR3",value:"hypertension","onUpdate:modelValue":e[3]||(e[3]=r=>s.selectedDSPR=r)},null,512),[[S,s.selectedDSPR]]),e[7]||(e[7]=o("label",{for:"DSPR3"},"高血壓(>=140mmHg)",-1))]),o("div",{class:"selectSendBtn",onClick:e[4]||(e[4]=(...r)=>s.submitData&&s.submitData(...r))},"送出")])])):R("",!0)}const G=w(x,[["render",_]]);export{G as _};
