import{u as Q,r as v,j as N,o as O,O as x,v as u,x as c,A as B,y as a,H as V,N as $,V as G,I as y,a2 as C,z as i}from"./HfdH-K36.js";import{_ as w}from"./Cel_gecP.js";import{_ as R}from"./Y-KACby9.js";import{C as F}from"./zbPE8Z49.js";import{_ as H}from"./W3k4iq7y.js";import{u as z}from"./O0ivr2ua.js";import{u as _}from"./BdfeuyLY.js";import{_ as j}from"./DlAUqK2U.js";const q={key:1,class:"cartListWrap"},E={class:"cartListContentWrap"},J={key:0,class:"noCartList"},K=["onUpdate:modelValue"],U={class:"cartContentGroup"},W=["src","alt"],Y={class:"cartContentGroupText"},Z={class:"addCartAlertOptionGroup"},X={class:"addCartAlertOptionGroupInput"},tt=["onClick","disabled"],et={class:"qtyNum"},ot=["onClick","disabled"],at=["onClick"],st={key:0,class:"cartListFooter"},lt={class:"cartListFooterContent1"},rt={class:"cartListFooterContent2"},nt={__name:"cartList",setup(ct){const f=Q(),h=z(),r=JSON.parse(localStorage.getItem("userData")),s=v([]),d=v(!1),n=v(!0),I=async()=>{var e,o;try{n.value=!0;const{data:t}=await _("https://23700999.com:8081/HMA/api/fr/maGetCart",{method:"POST",body:{MID:r.MID,Token:r.Token,MAID:r.MAID,Mobile:r.Mobile,Lang:"zhtw"}},"$tNQ7BEjAYf");((e=t.value)==null?void 0:e.Result)==="OK"&&((o=t.value)!=null&&o.RetMaCart)&&(s.value=t.value.RetMaCart.map(l=>({...l,selected:!1})))}catch(t){console.error("獲取購物車列表失敗：",t)}finally{n.value=!1}},m=async(e,o)=>{var t;try{n.value=!0;const{data:l}=await _("https://23700999.com:8081/HMA/api/fr/maCart",{method:"POST",body:{MID:r.MID,Token:r.Token,MAID:r.MAID,Mobile:r.Mobile,Lang:"zhtw",Cart:[{ProductID:e,Qty:o.toString()}]}},"$7ZGMGfJ5Jm");if(((t=l.value)==null?void 0:t.Result)==="OK"){const p=s.value.find(S=>S.ProductID===e);p&&(p.Qty=o,p.Amount=(parseInt(p.Price)*o).toString())}}catch(l){console.error("更新購物車失敗：",l)}finally{n.value=!1}},k=async e=>{var o;try{n.value=!0;const{data:t}=await _("https://23700999.com:8081/HMA/api/fr/maCartDelete",{method:"POST",body:{MID:r.MID,Token:r.Token,MAID:r.MAID,Mobile:r.Mobile,Lang:"zhtw",ProductID:[e]}},"$3LlyQjiV2W");((o=t.value)==null?void 0:o.Result)==="OK"&&(s.value=s.value.filter(l=>l.ProductID!==e))}catch(t){console.error("刪除商品失敗：",t)}finally{n.value=!1}},g=e=>{e.Qty>1&&m(e.ProductID,parseInt(e.Qty)-1)},M=e=>{e.Qty<100&&m(e.ProductID,parseInt(e.Qty)+1)},D=e=>{confirm("確定要刪除此商品嗎？")&&k(e)},b=()=>{f.push("/cart")},A=()=>{const e=s.value.filter(o=>o.selected).length;d.value=e===s.value.length&&s.value.length>0},L=()=>{s.value.forEach(e=>{e.selected=d.value})},P=()=>{const e=s.value.filter(t=>t.selected);if(e.length===0){alert("請選擇要購買的商品");return}h.setSelectedCartItems(e);const o=s.value.filter(t=>t.selected).reduce((t,l)=>t+parseInt(l.Amount),0);h.setSelectedTotalAmount(o),f.push("/cart/pay"),console.log("跳轉到結帳頁面",e),console.log("總金額:",o)},T=N(()=>s.value.filter(e=>e.selected).reduce((e,o)=>e+parseInt(o.Amount),0).toLocaleString());return O(()=>{I()}),(e,o)=>n.value?(c(),x(H,{key:0})):(c(),u("div",q,[B(F,{title:"購物車",showCart:!0,backPath:"/cart"}),a("div",E,[s.value.length===0?(c(),u("div",J,[o[1]||(o[1]=a("img",{src:w,alt:"購物車"},null,-1)),o[2]||(o[2]=a("h3",null,"購物車空空的",-1)),a("button",{onClick:b},"再逛逛")])):(c(!0),u($,{key:1},G(s.value,t=>(c(),u("div",{class:"cartListContent",key:t.ProductID},[y(a("input",{type:"checkbox","onUpdate:modelValue":l=>t.selected=l,onChange:A},null,40,K),[[C,t.selected]]),a("div",U,[a("img",{src:t.Picture,alt:t.ProductName},null,8,W),a("div",Y,[a("h3",null,i(t.ProductName),1),a("h6",null,"NT$"+i(t.Price),1),a("small",null,"數量: "+i(t.Qty),1)]),a("div",Z,[a("div",X,[a("button",{class:"qtyBtn",onClick:l=>g(t),disabled:t.Qty<=1}," - ",8,tt),a("span",et,i(t.Qty),1),a("button",{class:"qtyBtn",onClick:l=>M(t),disabled:t.Qty>=100}," + ",8,ot)])])]),a("div",{class:"deleteBtn",onClick:l=>D(t.ProductID)},o[3]||(o[3]=[a("img",{src:R,alt:"刪除"},null,-1)]),8,at)]))),128))]),s.value.length>0?(c(),u("div",st,[a("div",lt,[y(a("input",{type:"checkbox","onUpdate:modelValue":o[0]||(o[0]=t=>d.value=t),onChange:L},null,544),[[C,d.value]]),o[4]||(o[4]=a("label",{for:""},"全選",-1))]),a("div",rt,[a("h5",null,"總計 NT$"+i(T.value),1),a("button",{onClick:P},"去買單")])])):V("",!0)]))}},mt=j(nt,[["__scopeId","data-v-f298f425"]]);export{mt as default};
