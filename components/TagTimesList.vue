<template>
  <div class="tagTimesList" ref="tagTimesList">
    <div
      class="timesList"
      v-for="(question, index) in paginatedQuestions"
      :key="question.id"
    >
      <h3>{{ startIndex + index + 1 }}. {{ question.question }}</h3>
      <select
        @change="(event) => updateTimes(question.id, event.target.value)"
        class="timesList"
        v-model="question.times"
      >
        <option value="-1">0</option>
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3~4</option>
        <option value="6">>5</option>
      </select>
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="16"
        height="17"
        viewBox="0 0 16 17"
        fill="none"
      >
        <mask id="path-1-inside-1_9840_178092" fill="white">
          <path
            d="M12.9978 5.99252L7.99983 10.8645L3.00183 5.99252C2.91253 5.9053 2.79266 5.85647 2.66783 5.85647C2.543 5.85647 2.42313 5.9053 2.33383 5.99252C2.29059 6.03489 2.25624 6.08545 2.23279 6.14126C2.20934 6.19706 2.19727 6.25699 2.19727 6.31752C2.19727 6.37805 2.20934 6.43798 2.23279 6.49378C2.25624 6.54959 2.29059 6.60016 2.33383 6.64252L7.65083 11.8265C7.74421 11.9175 7.86944 11.9685 7.99983 11.9685C8.13023 11.9685 8.25546 11.9175 8.34883 11.8265L13.6658 6.64352C13.7094 6.60113 13.744 6.55044 13.7676 6.49444C13.7912 6.43845 13.8034 6.3783 13.8034 6.31752C13.8034 6.25675 13.7912 6.19659 13.7676 6.1406C13.744 6.08461 13.7094 6.03392 13.6658 5.99152C13.5765 5.9043 13.4567 5.85547 13.3318 5.85547C13.207 5.85547 13.0871 5.9043 12.9978 5.99152V5.99252Z"
          />
        </mask>
        <path
          d="M12.9978 5.99252L7.99983 10.8645L3.00183 5.99252C2.91253 5.9053 2.79266 5.85647 2.66783 5.85647C2.543 5.85647 2.42313 5.9053 2.33383 5.99252C2.29059 6.03489 2.25624 6.08545 2.23279 6.14126C2.20934 6.19706 2.19727 6.25699 2.19727 6.31752C2.19727 6.37805 2.20934 6.43798 2.23279 6.49378C2.25624 6.54959 2.29059 6.60016 2.33383 6.64252L7.65083 11.8265C7.74421 11.9175 7.86944 11.9685 7.99983 11.9685C8.13023 11.9685 8.25546 11.9175 8.34883 11.8265L13.6658 6.64352C13.7094 6.60113 13.744 6.55044 13.7676 6.49444C13.7912 6.43845 13.8034 6.3783 13.8034 6.31752C13.8034 6.25675 13.7912 6.19659 13.7676 6.1406C13.744 6.08461 13.7094 6.03392 13.6658 5.99152C13.5765 5.9043 13.4567 5.85547 13.3318 5.85547C13.207 5.85547 13.0871 5.9043 12.9978 5.99152V5.99252Z"
          fill="#1E1E1E"
        />
        <path
          d="M12.9978 5.99252L13.6959 6.7086L13.9978 6.41423V5.99252H12.9978ZM7.99983 10.8645L7.30181 11.5806L7.99983 12.261L8.69786 11.5806L7.99983 10.8645ZM3.00183 5.99252L2.30309 6.70789L2.30381 6.7086L3.00183 5.99252ZM2.66783 5.85647V4.85647V5.85647ZM2.33383 5.99252L1.63509 5.27715L1.63398 5.27824L2.33383 5.99252ZM2.19727 6.31752H3.19727H2.19727ZM2.33383 6.64252L1.63398 7.35681L1.63574 7.35853L2.33383 6.64252ZM7.65083 11.8265L6.95274 12.5425L6.95283 12.5426L7.65083 11.8265ZM8.34883 11.8265L9.04683 12.5426L9.04686 12.5426L8.34883 11.8265ZM13.6658 6.64352L12.9682 5.92704L12.9678 5.92745L13.6658 6.64352ZM13.6658 5.99152L12.9671 6.70689L12.9682 6.708L13.6658 5.99152ZM13.3318 5.85547V6.85547V5.85547ZM12.9978 5.99152L12.2991 5.27615L11.9978 5.5704V5.99152H12.9978ZM12.2998 5.27645L7.30181 10.1484L8.69786 11.5806L13.6959 6.7086L12.2998 5.27645ZM8.69786 10.1484L3.69986 5.27645L2.30381 6.7086L7.30181 11.5806L8.69786 10.1484ZM3.70058 5.27715C3.42447 5.00746 3.05381 4.85647 2.66783 4.85647V6.85647C2.53151 6.85647 2.4006 6.80314 2.30309 6.70789L3.70058 5.27715ZM2.66783 4.85647C2.28186 4.85647 1.9112 5.00746 1.63509 5.27715L3.03258 6.70789C2.93506 6.80314 2.80415 6.85647 2.66783 6.85647V4.85647ZM1.63398 5.27824C1.49571 5.41371 1.38587 5.5754 1.31088 5.75387L3.15471 6.52865C3.12662 6.5955 3.08547 6.65607 3.03369 6.70681L1.63398 5.27824ZM1.31088 5.75387C1.23589 5.93232 1.19727 6.12395 1.19727 6.31752H3.19727C3.19727 6.39003 3.1828 6.4618 3.15471 6.52865L1.31088 5.75387ZM1.19727 6.31752C1.19727 6.51109 1.23589 6.70272 1.31088 6.88118L3.15471 6.10639C3.1828 6.17324 3.19727 6.24502 3.19727 6.31752H1.19727ZM1.31088 6.88118C1.38587 7.05964 1.49571 7.22134 1.63398 7.35681L3.03369 5.92824C3.08548 5.97898 3.12662 6.03955 3.15471 6.10639L1.31088 6.88118ZM1.63574 7.35853L6.95274 12.5425L8.34893 11.1105L3.03193 5.92652L1.63574 7.35853ZM6.95283 12.5426C7.23295 12.8157 7.60865 12.9685 7.99983 12.9685V10.9685C8.13023 10.9685 8.25546 11.0194 8.34883 11.1104L6.95283 12.5426ZM7.99983 12.9685C8.39101 12.9685 8.76671 12.8157 9.04683 12.5426L7.65083 11.1104C7.7442 11.0194 7.86944 10.9685 7.99983 10.9685V12.9685ZM9.04686 12.5426L14.3639 7.35959L12.9678 5.92745L7.65081 11.1104L9.04686 12.5426ZM14.3634 7.36001C14.5027 7.22443 14.6134 7.06233 14.6889 6.88329L12.8463 6.1056C12.8746 6.03854 12.9161 5.97782 12.9682 5.92704L14.3634 7.36001ZM14.6889 6.88329C14.7645 6.70423 14.8034 6.51186 14.8034 6.31752H12.8034C12.8034 6.24473 12.818 6.17268 12.8463 6.1056L14.6889 6.88329ZM14.8034 6.31752C14.8034 6.12319 14.7645 5.93081 14.6889 5.75176L12.8463 6.52944C12.818 6.46237 12.8034 6.39031 12.8034 6.31752H14.8034ZM14.6889 5.75176C14.6134 5.57271 14.5027 5.41061 14.3634 5.27504L12.9682 6.708C12.9161 6.65722 12.8746 6.59651 12.8463 6.52944L14.6889 5.75176ZM14.3646 5.27615C14.0885 5.00645 13.7178 4.85547 13.3318 4.85547V6.85547C13.1955 6.85547 13.0646 6.80214 12.9671 6.70689L14.3646 5.27615ZM13.3318 4.85547C12.9459 4.85547 12.5752 5.00645 12.2991 5.27615L13.6966 6.70689C13.5991 6.80214 13.4682 6.85547 13.3318 6.85547V4.85547ZM11.9978 5.99152V5.99252H13.9978V5.99152H11.9978Z"
          fill="#74BC1F"
          mask="url(#path-1-inside-1_9840_178092)"
        />
      </svg>
    </div>
  </div>
</template>

<script>
import { computed, ref, watch, onMounted } from "vue";
import { useWeeklyRecord } from "@/stores/weeklyQA";

export default {
  setup() {
    const store = useWeeklyRecord();
    const tagTimesList = ref(null); // 定義 tagTimesList

    const currentPage = computed(() => store.timesStep);
    const questionsPerPage = store.selectQuestionPerPage;

    const paginatedQuestions = computed(() => {
      const start = (currentPage.value - 1) * questionsPerPage;
      const end = currentPage.value * questionsPerPage;
      return store.sortedByScore.slice(start, end);
    });

    const startIndex = computed(
      () => (currentPage.value - 1) * questionsPerPage
    );

    const updateTimes = (id, times) => {
      const question = store.weeklyQA.find((q) => q.id === id);
      if (question) {
        question.times = Number(times);
      }
    };

    const scrollToTop = () => {
      if (tagTimesList.value) {
        tagTimesList.value.scrollTop = 0; // 滾動到頂部
      }
    };

    watch(currentPage, () => {
      scrollToTop(); // 當頁面切換時觸發滾動
    });

    onMounted(() => {
      scrollToTop(); // 組件掛載後觸發滾動
    });

    return {
      paginatedQuestions,
      updateTimes,
      startIndex,
      tagTimesList, // 將 tagTimesList 返回
    };
  },
};
</script>

<style lang="scss" scoped>
.tagTimesList {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
  height: calc(100vh - 269px);
  overflow-y: auto;
  @include scrollbarStyle();

  & > .timesList {
    background-color: #fff;
    border-radius: 12px;
    padding: 0.75rem;
    position: relative;
    svg {
      position: absolute;
      right: 1rem;
      top: 57.5%;
      pointer-events: none;
    }
  }
  
  h3 {
    font-size: 20px;
    font-weight: 500;
    color: #1e1e1e;
    letter-spacing: 0.15px;
    line-height: 32.36px;
  }

  .hashTag {
    color: #666;
    font-size: 14px;
    letter-spacing: 0.1px;
    margin-top: 0.5rem;
  }

  select {
    background-color: #fff;
    appearance: none;
    cursor: pointer;
    width: 100%;
    height: 2.5rem;
    border: none;
    border-bottom: 1px solid #eeeeee;
    font-size: 16px;
    color: #74bc1f;
    padding: 0 8px;

    &:focus {
      outline: none;
    }
  }
}
</style>
