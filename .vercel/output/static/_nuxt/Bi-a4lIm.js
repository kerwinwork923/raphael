import{E as I,M as _,r as y,o as T,v as u,x as i,A as g,y as e,z as o,N as D,V as P}from"./HfdH-K36.js";import{C as S}from"./zbPE8Z49.js";import{u as h}from"./BdfeuyLY.js";import{_ as N}from"./DlAUqK2U.js";const k={class:"checkoutSuccessWrap"},B={class:"contentWrap"},x={key:0,class:"loadingBox"},A={key:1,class:"errorBox"},M={class:"infoBox"},R={class:"infoBox"},L={class:"infoBox productBox"},b=["src","alt"],w={class:"productInfo"},O={class:"quantity"},E={class:"summary"},Q={class:"summaryRow"},C={class:"summaryRow total"},$={class:"infoBox orderDetailsBox"},q={class:"detailRow"},z={class:"copyable"},V={class:"detailRow"},F={class:"detailRow"},K={class:"detailRow"},W={__name:"checkoutSuccess",setup(H){I();const p=_(),t=y({}),c=y(!0),n=y(null),v=JSON.parse(localStorage.getItem("userData")),f=async()=>{var s,a;const m=localStorage.getItem("checkoutSALEID");if(!m){console.error("未找到 SALEID"),n.value="未找到訂單資訊",c.value=!1,setTimeout(()=>{p.push("/orderQuery")},2e3);return}try{c.value=!0,n.value=null;const{data:r}=await h("https://23700999.com:8081/HMA/api/fr/maSaleSingle",{method:"POST",body:{MID:v.MID,Token:v.Token,MAID:v.MAID,Mobile:v.Mobile,Lang:"zhtw",SALEID:m}},"$t0hZgA1Kqq");if(r.value&&r.value.Result==="OK"){const l=r.value.Sale;t.value={DeliverType:l.DeliverTypeName,RName:l.RName,RMobile:l.RMobile,Address:l.Address,ProductList:l.ItemList.map(d=>({ProductID:d.ProductID,ProductName:d.ProductName,Price:parseInt(d.Price).toLocaleString(),Qty:d.Qty,DPicture:d.DPicture})),freight:l.freight,TotalAmount:parseInt(l.TotalAmount).toLocaleString(),OrderNo:l.SID,PayType:l.PayTypeName,OrderTime:l.CheckTime,InvoiceType:l.InvoiceIDName},console.log("訂單詳情獲取成功:",t.value),localStorage.removeItem("checkoutSALEID")}else console.error("獲取訂單詳情失敗:",(s=r.value)==null?void 0:s.Message),n.value=((a=r.value)==null?void 0:a.Message)||"獲取訂單詳情失敗",setTimeout(()=>{p.push("/orderQuery")},3e3)}catch(r){console.error("獲取訂單詳情時發生錯誤:",r),n.value="獲取訂單詳情時發生錯誤",setTimeout(()=>{p.push("/orderQuery")},3e3)}finally{c.value=!1}};return T(()=>{f()}),(m,s)=>(i(),u("div",k,[g(S,{title:"付款詳情",backPath:"/cart"}),e("div",B,[c.value?(i(),u("div",x,s[0]||(s[0]=[e("div",{class:"loadingSpinner"},null,-1),e("p",null,"載入訂單詳情中...",-1)]))):n.value?(i(),u("div",A,[e("p",null,o(n.value),1),s[1]||(s[1]=e("p",{class:"redirectMsg"},"即將跳轉到訂單查詢頁面...",-1)),e("button",{onClick:f,class:"retryBtn"},"重新載入")])):(i(),u(D,{key:2},[s[11]||(s[11]=e("div",{class:"infoBox thankYouBox"}," 感謝您的購買，請繼續填寫個人化資訊，以便我們開始製作衣服! ",-1)),e("div",M,[s[2]||(s[2]=e("h4",null,"寄送方式",-1)),e("p",null,o(t.value.DeliverType),1)]),e("div",R,[s[3]||(s[3]=e("h4",null,"收件資訊",-1)),e("p",null,o(t.value.RName)+"．"+o(t.value.RMobile),1),e("p",null,o(t.value.Address),1)]),e("div",L,[(i(!0),u(D,null,P(t.value.ProductList,a=>(i(),u("div",{key:a.ProductID,class:"productItem"},[e("img",{src:a.DPicture,alt:a.ProductName},null,8,b),e("div",w,[e("h4",null,o(a.ProductName),1),e("h5",null,"NT$"+o(a.Price),1),s[4]||(s[4]=e("button",{class:"personalizeBtn"},"請完成個人化資訊填寫 >",-1))]),e("span",O,"x"+o(a.Qty),1)]))),128)),e("div",E,[e("div",Q,[s[5]||(s[5]=e("span",null,"運費",-1)),e("span",null,"NT$"+o(t.value.freight),1)]),e("div",C,[s[6]||(s[6]=e("span",null,"訂單總金額",-1)),e("span",null,"NT$"+o(t.value.TotalAmount),1)])])]),e("div",$,[e("div",q,[s[7]||(s[7]=e("span",null,"訂單編號",-1)),e("span",z,o(t.value.OrderNo),1)]),e("div",V,[s[8]||(s[8]=e("span",null,"付款方式",-1)),e("span",null,o(t.value.PayType),1)]),e("div",F,[s[9]||(s[9]=e("span",null,"訂單成立時間",-1)),e("span",null,o(t.value.OrderTime),1)]),e("div",K,[s[10]||(s[10]=e("span",null,"發票類型",-1)),e("span",null,o(t.value.InvoiceType),1)])]),s[12]||(s[12]=e("div",{class:"infoBox"},null,-1))],64))])]))}},G=N(W,[["__scopeId","data-v-a345fe31"]]);export{G as default};
